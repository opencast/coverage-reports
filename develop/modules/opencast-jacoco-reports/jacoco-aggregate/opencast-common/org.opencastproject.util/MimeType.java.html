<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>MimeType.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-common</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.util</a> &gt; <span class="el_source">MimeType.java</span></div><h1>MimeType.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */


package org.opencastproject.util;

import static org.opencastproject.util.EqualsUtil.eqObj;
import static org.opencastproject.util.data.Collections.list;
import static org.opencastproject.util.data.Monadics.mlist;
import static org.opencastproject.util.data.Option.none;

import org.opencastproject.util.data.Collections;
import org.opencastproject.util.data.Function;
import org.opencastproject.util.data.Option;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.Serializable;
import java.util.List;

import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.bind.annotation.XmlType;
import javax.xml.bind.annotation.adapters.XmlAdapter;
import javax.xml.bind.annotation.adapters.XmlJavaTypeAdapter;

/**
 * This class implements the mime type. Note that mime types should not be instantiated directly but be retreived from
 * the mime type registry {@link MimeTypes}.
 */
@XmlAccessorType(XmlAccessType.NONE)
@XmlType(name = &quot;mimetype&quot;, namespace = &quot;http://mediapackage.opencastproject.org&quot;)
@XmlJavaTypeAdapter(MimeType.Adapter.class)
public final class MimeType implements Comparable&lt;MimeType&gt;, Serializable {
<span class="fc" id="L54">  private static final Logger logger = LoggerFactory.getLogger(MimeType.class);</span>

  /** Serial version UID */
  private static final long serialVersionUID = -2895494708659187394L;

  /** String representation of type */
  private final String type;

  /** String representation of subtype */
  private final String subtype;

  /** Alternate representations for type/subtype */
  private final List&lt;MimeType&gt; equivalents;

  /** List of suffixes, the first is the main one. */
  private final List&lt;String&gt; suffixes;

  /** Main description */
  private final Option&lt;String&gt; description;

  /** The mime type flavor */
  private final Option&lt;String&gt; flavor;

  /** The mime type flavor description */
  private final Option&lt;String&gt; flavorDescription;

  /**
   * Creates a new mime type with the given type and subtype.
   *
   * @param type
   *          the major type
   * @param subtype
   *          minor type
   */
  private MimeType(String type, String subtype, List&lt;String&gt; suffixes,
                  List&lt;MimeType&gt; equivalents,
                  Option&lt;String&gt; description,
<span class="fc" id="L91">                  Option&lt;String&gt; flavor, Option&lt;String&gt; flavorDescription) {</span>
<span class="fc" id="L92">    this.type = type;</span>
<span class="fc" id="L93">    this.subtype = subtype;</span>
<span class="fc" id="L94">    this.suffixes = suffixes;</span>
<span class="fc" id="L95">    this.equivalents = equivalents;</span>
<span class="fc" id="L96">    this.description = description;</span>
<span class="fc" id="L97">    this.flavor = flavor;</span>
<span class="fc" id="L98">    this.flavorDescription = flavorDescription;</span>
<span class="fc" id="L99">  }</span>

  public static MimeType mimeType(String type, String subtype, List&lt;String&gt; suffixes,
                                  List&lt;MimeType&gt; equivalents,
                                  Option&lt;String&gt; description,
                                  Option&lt;String&gt; flavor, Option&lt;String&gt; flavorDescription) {
<span class="fc" id="L105">    return new MimeType(type, subtype, suffixes, equivalents, description, flavor, flavorDescription);</span>
  }

  public static MimeType mimeType(String type, String subtype, String suffix) {
<span class="nc" id="L109">    return new MimeType(type, subtype, list(suffix), Collections.&lt;MimeType&gt;nil(), none(&quot;&quot;), none(&quot;&quot;), none(&quot;&quot;));</span>
  }

  public static MimeType mimeType(String type, String subtype) {
<span class="fc" id="L113">    return new MimeType(type, subtype, Collections.&lt;String&gt;nil(), Collections.&lt;MimeType&gt;nil(), none(&quot;&quot;), none(&quot;&quot;), none(&quot;&quot;));</span>
  }

  /**
   * Returns the major type of this mimetype.
   * &lt;p&gt;
   * For example, if the mimetype is ISO Motion JPEG 2000 which is represented as &lt;code&gt;video/mj2&lt;/code&gt;, this method
   * will return &lt;code&gt;video&lt;/code&gt;.
   *
   * @return the type
   */
  public String getType() {
<span class="fc" id="L125">    return type;</span>
  }

  /**
   * Returns the minor type of this mimetype.
   * &lt;p&gt;
   * For example, if the mimetype is ISO Motion JPEG 2000 which is represented as &lt;code&gt;video/mj2&lt;/code&gt;, this method
   * will return &lt;code&gt;mj2&lt;/code&gt;.
   *
   * @return the subtype
   */
  public String getSubtype() {
<span class="fc" id="L137">    return subtype;</span>
  }

  /**
   * Returns the main suffix for this mime type, that identifies files containing data of this flavor.
   * &lt;p&gt;
   * For example, files with the suffix &lt;code&gt;mj2&lt;/code&gt; will contain data of type &lt;code&gt;video/mj2&lt;/code&gt;.
   *
   * @return the file suffix
   */
  public Option&lt;String&gt; getSuffix() {
<span class="nc" id="L148">    return mlist(suffixes).headOpt();</span>
  }

  /**
   * Returns the registered suffixes for this mime type, that identify files containing data of this flavor. Note that
   * the list includes the main suffix returned by &lt;code&gt;getSuffix()&lt;/code&gt;.
   * &lt;p&gt;
   * For example, files containing ISO Motion JPEG 2000 may have file suffixes &lt;code&gt;mj2&lt;/code&gt; and &lt;code&gt;mjp2&lt;/code&gt;.
   *
   * @return the registered file suffixes
   */
  public String[] getSuffixes() {
<span class="fc" id="L160">    return suffixes.toArray(new String[suffixes.size()]);</span>
  }

  /**
   * Returns &lt;code&gt;true&lt;/code&gt; if the mimetype supports the specified suffix.
   *
   * @return &lt;code&gt;true&lt;/code&gt; if the suffix is supported
   */
  public boolean supportsSuffix(String suffix) {
<span class="fc" id="L169">    return suffixes.contains(suffix.toLowerCase());</span>
  }

  /**
   * Returns the mime type description.
   *
   * @return the description
   */
  public Option&lt;String&gt; getDescription() {
<span class="nc" id="L178">    return this.description;</span>
  }

  /**
   * Returns the flavor of this mime type.
   * &lt;p&gt;
   * A flavor is a hint on a specialized variant of a general mime type. For example, a dublin core file will have a
   * mime type of &lt;code&gt;text/xml&lt;/code&gt;. Adding a flavor of &lt;code&gt;mpeg-7&lt;/code&gt; gives an additional hint on the file
   * contents.
   *
   * @return the file's flavor
   */
  public Option&lt;String&gt; getFlavor() {
<span class="nc" id="L191">    return flavor;</span>
  }

  /**
   * Returns the flavor description.
   *
   * @return the flavor description
   */
  public Option&lt;String&gt; getFlavorDescription() {
<span class="nc" id="L200">    return flavorDescription;</span>
  }

  /**
   * Returns &lt;code&gt;true&lt;/code&gt; if the file has the given flavor associated.
   *
   * @return &lt;code&gt;true&lt;/code&gt; if the file has that flavor
   */
  public boolean hasFlavor(String flavor) {
<span class="nc bnc" id="L209" title="All 2 branches missed.">    if (flavor == null)</span>
<span class="nc" id="L210">      return false;</span>
<span class="nc" id="L211">    return flavor.equalsIgnoreCase(flavor);</span>
  }

  /**
   * Returns the MimeType as a string of the form &lt;code&gt;type/subtype&lt;/code&gt;
   * @deprecated use {@link #toString()} instead
   */
  public String asString() {
<span class="nc" id="L219">    return toString();</span>
  }

  /** Two mime types are considered equal if type and subtype are equal. */
  public boolean eq(MimeType other) {
<span class="fc" id="L224">    return eq(other.getType(), other.getSubtype());</span>
  }

  /** Two mime types are considered equal if type and subtype are equal. */
  public boolean eq(String type, String subtype) {
<span class="pc bpc" id="L229" title="2 of 4 branches missed.">    return this.type.equalsIgnoreCase(type) &amp;&amp; this.subtype.equalsIgnoreCase(subtype);</span>
  }

  /** {@link #eq(org.opencastproject.util.MimeType)} as a function. */
  // CHECKSTYLE:OFF
<span class="fc" id="L234">  public final Function&lt;MimeType, Boolean&gt; eq = new Function&lt;MimeType, Boolean&gt;() {</span>
    @Override public Boolean apply(MimeType other) {
<span class="nc" id="L236">      return eq(other);</span>
    }
  };
  // CHECKSTYLE:ON

  /**
   * Returns &lt;code&gt;true&lt;/code&gt; if this mime type is an equivalent for the specified type and subtype.
   * &lt;p&gt;
   * For example, a gzipped file may have both of these mime types defined, &lt;code&gt;application/x-compressed&lt;/code&gt; or
   * &lt;code&gt;application/x-gzip&lt;/code&gt;.
   *
   * @return &lt;code&gt;true&lt;/code&gt; if this mime type is equal
   */
  public boolean isEquivalentTo(String type, String subtype) {
<span class="nc bnc" id="L250" title="All 4 branches missed.">    return eq(type, subtype) || mlist(equivalents).exists(eq);</span>
  }

  /**
   * @see java.lang.Comparable#compareTo(java.lang.Object)
   */
  public int compareTo(MimeType m) {
<span class="nc" id="L257">    return toString().compareTo(m.toString());</span>
  }

  /**
   * Returns the MimeType as a string of the form &lt;code&gt;type/subtype&lt;/code&gt;
   */
  @Override
  public String toString() {
<span class="fc" id="L265">    return type + &quot;/&quot; + subtype;</span>
  }

  @Override
  public int hashCode() {
<span class="fc" id="L270">    return EqualsUtil.hash(type, subtype);</span>
  }

  @Override
  public boolean equals(Object that) {
<span class="pc bpc" id="L275" title="2 of 6 branches missed.">    return (this == that) || (that instanceof MimeType &amp;&amp; eqFields((MimeType) that));</span>
  }

  private boolean eqFields(MimeType that) {
<span class="pc bpc" id="L279" title="1 of 2 branches missed.">    return eqObj(this.type, that.type)</span>
<span class="pc bpc" id="L280" title="1 of 2 branches missed.">            &amp;&amp; eqObj(this.subtype, that.subtype);</span>
  }

<span class="fc" id="L283">  static class Adapter extends XmlAdapter&lt;String, MimeType&gt; {</span>
    @Override
    public String marshal(MimeType mimeType) throws Exception {
<span class="fc" id="L286">      return mimeType.type + &quot;/&quot; + mimeType.subtype;</span>
    }

    @Override
    public MimeType unmarshal(String str) throws Exception {
      try {
<span class="fc" id="L292">        return MimeTypes.parseMimeType(str);</span>
<span class="nc" id="L293">      } catch (Exception e) {</span>
<span class="nc" id="L294">        logger.info(&quot;unable to parse mimetype {}&quot;, str);</span>
<span class="nc" id="L295">        return null;</span>
      }
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>