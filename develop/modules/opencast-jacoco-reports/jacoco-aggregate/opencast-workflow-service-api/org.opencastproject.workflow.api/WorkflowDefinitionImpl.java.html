<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>WorkflowDefinitionImpl.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-workflow-service-api</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.workflow.api</a> &gt; <span class="el_source">WorkflowDefinitionImpl.java</span></div><h1>WorkflowDefinitionImpl.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.workflow.api;

import org.apache.commons.lang3.StringUtils;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.HashSet;
import java.util.List;
import java.util.Set;
import java.util.SortedSet;
import java.util.TreeSet;

import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlElementWrapper;
import javax.xml.bind.annotation.XmlID;
import javax.xml.bind.annotation.XmlRootElement;
import javax.xml.bind.annotation.XmlType;
import javax.xml.bind.annotation.adapters.XmlAdapter;

/**
 * A JAXB-annotated implementation of {@link WorkflowDefinition}
 */
@XmlType(name = &quot;definition&quot;, namespace = &quot;http://workflow.opencastproject.org&quot;)
@XmlRootElement(name = &quot;definition&quot;, namespace = &quot;http://workflow.opencastproject.org&quot;)
@XmlAccessorType(XmlAccessType.FIELD)
public class WorkflowDefinitionImpl implements WorkflowDefinition {

  /**
   * Constructor to be used by JAXB only.
   */
<span class="fc" id="L55">  public WorkflowDefinitionImpl() {</span>
<span class="fc" id="L56">  }</span>

  @XmlID
  @XmlElement(name = &quot;id&quot;)
  private String id;

  @XmlElement(name = &quot;title&quot;)
  private String title;

  @XmlElement(name = &quot;organization&quot;)
  private String organization;

<span class="fc" id="L68">  @XmlElementWrapper(name = &quot;tags&quot;)</span>
  @XmlElement(name = &quot;tag&quot;)
  protected SortedSet&lt;String&gt; tags = new TreeSet&lt;&gt;();

<span class="fc" id="L72">  @XmlElementWrapper(name = &quot;roles&quot;)</span>
  @XmlElement(name = &quot;role&quot;)
  protected SortedSet&lt;String&gt; roles = new TreeSet&lt;&gt;();

  @XmlElement(name = &quot;description&quot;)
  private String description;

<span class="fc" id="L79">  @XmlElement(name = &quot;displayOrder&quot;)</span>
  private int displayOrder = 0;

  @XmlElement(name = &quot;configuration_panel&quot;)
  private String configurationPanel;

  @XmlElement(name = &quot;configuration_panel_json&quot;)
  private String configurationPanelJson;

  @XmlElement(name = &quot;operation&quot;)
  @XmlElementWrapper(name = &quot;operations&quot;)
  private List&lt;WorkflowOperationDefinition&gt; operations;

  @XmlElement(name = &quot;state-mapping&quot;)
  @XmlElementWrapper(name = &quot;state-mappings&quot;)
  private Set&lt;WorkflowStateMapping&gt; stateMappings;

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#getId()
   */
  public String getId() {
<span class="fc" id="L102">    return id;</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#setId(java.lang.String)
   */
  public void setId(String id) {
<span class="fc" id="L111">    this.id = id;</span>
<span class="fc" id="L112">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#getDescription()
   */
  public String getDescription() {
<span class="fc" id="L120">    return description;</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#setDescription(java.lang.String)
   */
  public void setDescription(String description) {
<span class="fc" id="L129">    this.description = description;</span>
<span class="fc" id="L130">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#getDisplayOrder()
   */
  public int getDisplayOrder() {
<span class="fc" id="L138">    return displayOrder;</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#setDisplayOrder(int)
   */
  public void setDisplayOrder(int displayOrder) {
<span class="fc" id="L147">    this.displayOrder = displayOrder;</span>
<span class="fc" id="L148">  }</span>

  /**
   * Sets the configuration panel for this workflow.
   *
   * @param panelXML
   *          the xml for the configuration panel
   */
  public void setConfigurationPanel(String panelXML) {
<span class="fc" id="L157">    this.configurationPanel = panelXML;</span>
<span class="fc" id="L158">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#getConfigurationPanel()
   */
  public String getConfigurationPanel() {
<span class="fc" id="L166">    return this.configurationPanel;</span>
  }

  /**
   * Sets the configuration panel for this workflow.
   *
   * @param panelJson
   *          the json for the configuration panel
   */
  public void setConfigurationPanelJson(String panelJson) {
<span class="fc" id="L176">    this.configurationPanelJson = panelJson;</span>
<span class="fc" id="L177">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#getConfigurationPanelJson()
   */
  public String getConfigurationPanelJson() {
<span class="fc" id="L185">    return this.configurationPanelJson;</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#getOperations()
   */
  public List&lt;WorkflowOperationDefinition&gt; getOperations() {
<span class="fc bfc" id="L194" title="All 2 branches covered.">    if (operations == null)</span>
<span class="fc" id="L195">      operations = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L196">    return operations;</span>
  }

  @Override
  public Set&lt;WorkflowStateMapping&gt; getStateMappings() {
<span class="nc bnc" id="L201" title="All 2 branches missed.">    if (stateMappings == null) {</span>
<span class="nc" id="L202">      stateMappings = new HashSet&lt;&gt;();</span>
    }
<span class="nc" id="L204">    return stateMappings;</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#get(int)
   */
  @Override
  public WorkflowOperationDefinition get(int position) throws IndexOutOfBoundsException {
<span class="nc bnc" id="L214" title="All 2 branches missed.">    if (operations == null)</span>
<span class="nc" id="L215">      operations = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L216" title="All 4 branches missed.">    if (position &lt; 0 || position &gt;= operations.size())</span>
<span class="nc" id="L217">      throw new IndexOutOfBoundsException();</span>
<span class="nc" id="L218">    return operations.get(position);</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#add(org.opencastproject.workflow.api.WorkflowOperationDefinition)
   */
  @Override
  public void add(WorkflowOperationDefinition operation) {
<span class="fc bfc" id="L228" title="All 2 branches covered.">    if (operations == null)</span>
<span class="fc" id="L229">      operations = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L230">    add(operation, this.operations.size());</span>
<span class="fc" id="L231">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#add(org.opencastproject.workflow.api.WorkflowOperationDefinition,
   *      int)
   */
  @Override
  public void add(WorkflowOperationDefinition operation, int position) {
<span class="pc bpc" id="L241" title="1 of 2 branches missed.">    if (operations == null)</span>
<span class="nc" id="L242">      operations = new ArrayList&lt;&gt;();</span>

<span class="pc bpc" id="L244" title="1 of 2 branches missed.">    if (operation == null)</span>
<span class="nc" id="L245">      throw new IllegalArgumentException(&quot;Workflow operation cannot be null&quot;);</span>
<span class="pc bpc" id="L246" title="2 of 4 branches missed.">    if (position &lt; 0 || position &gt; operations.size())</span>
<span class="nc" id="L247">      throw new IndexOutOfBoundsException();</span>

<span class="pc bpc" id="L249" title="1 of 2 branches missed.">    if (position == operations.size())</span>
<span class="fc" id="L250">      operations.add(operation);</span>
    else
<span class="nc" id="L252">      operations.add(position, operation);</span>
<span class="fc" id="L253">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.workflow.api.WorkflowDefinition#remove(int)
   */
  @Override
  public WorkflowOperationDefinition remove(int position) throws IndexOutOfBoundsException {
<span class="nc bnc" id="L262" title="All 2 branches missed.">    if (operations == null)</span>
<span class="nc" id="L263">      operations = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L264">    return operations.remove(position);</span>
  }

  /**
   * @see org.opencastproject.workflow.api.WorkflowDefinition#addTag(String)
   */
  @Override
  public void addTag(String tag) {
<span class="pc bpc" id="L272" title="1 of 2 branches missed.">    if (tag == null)</span>
<span class="nc" id="L273">      throw new IllegalArgumentException(&quot;Tag must not be null&quot;);</span>
<span class="fc" id="L274">    tags.add(tag);</span>
<span class="fc" id="L275">  }</span>

  /**
   * @see org.opencastproject.workflow.api.WorkflowDefinition#removeTag(String)
   */
  @Override
  public void removeTag(String tag) {
<span class="nc bnc" id="L282" title="All 2 branches missed.">    if (tag == null)</span>
<span class="nc" id="L283">      return;</span>
<span class="nc" id="L284">    tags.remove(tag);</span>
<span class="nc" id="L285">  }</span>

  /**
   * @see org.opencastproject.workflow.api.WorkflowDefinition#containsTag(String)
   */
  @Override
  public boolean containsTag(String tag) {
<span class="pc bpc" id="L292" title="2 of 4 branches missed.">    if (tag == null || tags == null)</span>
<span class="nc" id="L293">      return false;</span>
<span class="fc" id="L294">    return tags.contains(tag);</span>
  }

  /**
   * @see org.opencastproject.workflow.api.WorkflowDefinition#containsTag(Collection)
   */
  @Override
  public boolean containsTag(Collection&lt;String&gt; tags) {
<span class="fc bfc" id="L302" title="All 2 branches covered.">    if (tags.size() == 0)</span>
<span class="fc" id="L303">      return true;</span>
<span class="fc bfc" id="L304" title="All 2 branches covered.">    for (String tag : tags) {</span>
<span class="fc bfc" id="L305" title="All 2 branches covered.">      if (containsTag(tag))</span>
<span class="fc" id="L306">        return true;</span>
<span class="fc" id="L307">    }</span>
<span class="fc" id="L308">    return false;</span>
  }

  /**
   * @see org.opencastproject.workflow.api.WorkflowDefinition#getTags()
   */
  @Override
  public String[] getTags() {
<span class="fc" id="L316">    return tags.toArray(new String[0]);</span>
  }

  /**
   * @see org.opencastproject.workflow.api.WorkflowDefinition#clearTags()
   */
  @Override
  public void clearTags() {
<span class="nc bnc" id="L324" title="All 2 branches missed.">    if (tags != null)</span>
<span class="nc" id="L325">      tags.clear();</span>
<span class="nc" id="L326">  }</span>

  /**
   * Since we are posting workflow definitions as one post parameter in a multi-parameter post, we can not rely on
   * &quot;automatic&quot; JAXB deserialization. We therefore need to provide a static valueOf(String) method to transform an XML
   * string into a WorkflowDefinition.
   *
   * @param xmlString
   *          The xml describing the workflow
   * @return A {@link WorkflowDefinitionImpl} instance based on xmlString
   * @throws Exception
   *           If there is a problem marshalling the {@link WorkflowDefinitionImpl} from XML.
   */
  public static WorkflowDefinitionImpl valueOf(String xmlString) throws Exception {
<span class="nc" id="L340">    return (WorkflowDefinitionImpl) XmlWorkflowParser.parseWorkflowDefinition(xmlString);</span>
  }

  @Override
  public int compareTo(WorkflowDefinition workflowDefinition) {

<span class="nc bnc" id="L346" title="All 2 branches missed.">    if (workflowDefinition == null) {</span>
<span class="nc" id="L347">      throw new NullPointerException(&quot;WorkflowDefinition for comparison can't be null&quot;);</span>
    }

    // nullsafe comparison where null is lesser than non-null
    // workflows with null title probably aren't for displaying anyway
<span class="nc" id="L352">    return StringUtils.compareIgnoreCase(this.getTitle(), workflowDefinition.getTitle());</span>
  }

<span class="nc" id="L355">  static class Adapter extends XmlAdapter&lt;WorkflowDefinitionImpl, WorkflowDefinition&gt; {</span>
    public WorkflowDefinitionImpl marshal(WorkflowDefinition op) {
<span class="nc" id="L357">      return (WorkflowDefinitionImpl) op;</span>
    }

    public WorkflowDefinition unmarshal(WorkflowDefinitionImpl op) {
<span class="nc" id="L361">      return op;</span>
    }
  }

  /**
   * @return the title
   */
  public String getTitle() {
<span class="fc" id="L369">    return title;</span>
  }

  /**
   * @param title
   *          the title to set
   */
  public void setTitle(String title) {
<span class="fc" id="L377">    this.title = title;</span>
<span class="fc" id="L378">  }</span>

  @Override
  public String getOrganization() {
<span class="nc" id="L382">    return organization;</span>
  }

  @Override
  public Collection&lt;String&gt; getRoles() {
<span class="pc bpc" id="L387" title="1 of 2 branches missed.">    if (roles == null) {</span>
<span class="nc" id="L388">      return Collections.emptySet();</span>
    }
<span class="fc" id="L390">    return roles;</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see java.lang.Object#toString()
   */
  public String toString() {
<span class="nc bnc" id="L399" title="All 2 branches missed.">    if (organization != null) {</span>
<span class="nc" id="L400">      return &quot;Workflow definition {&quot; + id + &quot;/&quot; + organization + &quot;}&quot;;</span>
    }
<span class="nc" id="L402">    return &quot;Workflow definition {&quot; + id + &quot;}&quot;;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>