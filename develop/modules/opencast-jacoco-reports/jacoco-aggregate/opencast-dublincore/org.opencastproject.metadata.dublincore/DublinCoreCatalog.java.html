<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>DublinCoreCatalog.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-dublincore</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.metadata.dublincore</a> &gt; <span class="el_source">DublinCoreCatalog.java</span></div><h1>DublinCoreCatalog.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */
package org.opencastproject.metadata.dublincore;

import org.opencastproject.mediapackage.EName;
import org.opencastproject.mediapackage.MediaPackageElementFlavor;
import org.opencastproject.mediapackage.XMLCatalogImpl;
import org.opencastproject.metadata.api.MetadataCatalog;
import org.opencastproject.util.RequireUtil;
import org.opencastproject.util.XmlNamespaceContext;

import com.google.gson.annotations.JsonAdapter;

import org.apache.commons.collections4.Closure;
import org.apache.commons.collections4.CollectionUtils;
import org.apache.commons.collections4.Predicate;
import org.apache.commons.collections4.Transformer;
import org.w3c.dom.Document;
import org.xml.sax.Attributes;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.Set;
import java.util.function.Function;
import java.util.stream.Collectors;

import javax.annotation.Nonnull;
import javax.annotation.Nullable;
import javax.annotation.ParametersAreNonnullByDefault;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.TransformerException;

/**
 * Catalog for DublinCore structured metadata to be serialized as XML.
 * &lt;p&gt;
 * Attention: Encoding schemes are not preserved! See http://opencast.jira.com/browse/MH-8759
 */
@ParametersAreNonnullByDefault
@JsonAdapter(DublinCoreGsonAdapter.class)
public class DublinCoreCatalog extends XMLCatalogImpl implements DublinCore, MetadataCatalog, Cloneable {
  private static final long serialVersionUID = -4568663918115847488L;

  /** A flavor that matches any dublin core element */
<span class="fc" id="L68">  public static final MediaPackageElementFlavor ANY_DUBLINCORE = MediaPackageElementFlavor.parseFlavor(&quot;dublincore/*&quot;);</span>

  private EName rootTag;

  /** Create a new catalog. */
<span class="fc" id="L73">  DublinCoreCatalog() {</span>
<span class="fc" id="L74">  }</span>

  public void setRootTag(EName rootTag) {
<span class="fc" id="L77">    this.rootTag = rootTag;</span>
<span class="fc" id="L78">  }</span>

  @Nullable
  public EName getRootTag() {
<span class="fc" id="L82">    return rootTag;</span>
  }

  public void addBindings(XmlNamespaceContext ctx) {
<span class="fc" id="L86">    bindings = this.bindings.add(ctx);</span>
<span class="fc" id="L87">  }</span>

  @Override
  public String toString() {
<span class="nc bnc" id="L91" title="All 2 branches missed.">    return &quot;DublinCore&quot; + (getIdentifier() != null ? &quot;(&quot; + getIdentifier() + &quot;)&quot; : &quot;&quot;);</span>
  }

  @Override
  @SuppressWarnings(&quot;unchecked&quot;)
  public List&lt;String&gt; get(EName property, final String language) {
<span class="fc" id="L97">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L98">    RequireUtil.notNull(language, &quot;language&quot;);</span>
<span class="fc bfc" id="L99" title="All 2 branches covered.">    if (LANGUAGE_ANY.equals(language)) {</span>
<span class="fc" id="L100">      return (List&lt;String&gt;) CollectionUtils.collect(getValuesAsList(property), new Transformer() {</span>
        @Override
        public Object transform(Object o) {
<span class="fc" id="L103">          return ((CatalogEntry) o).getValue();</span>
        }
      });
    } else {
<span class="fc" id="L107">      final List&lt;String&gt; values = new ArrayList&lt;String&gt;();</span>
<span class="fc" id="L108">      final boolean langUndef = LANGUAGE_UNDEFINED.equals(language);</span>
<span class="fc" id="L109">      CollectionUtils.forAllDo(getValuesAsList(property), new Closure() {</span>
        @Override
        public void execute(Object o) {
<span class="fc" id="L112">          CatalogEntry c = (CatalogEntry) o;</span>
<span class="fc" id="L113">          String lang = c.getAttribute(XML_LANG_ATTR);</span>
<span class="fc bfc" id="L114" title="All 6 branches covered.">          if ((langUndef &amp;&amp; lang == null) || (language.equals(lang)))</span>
<span class="fc" id="L115">            values.add(c.getValue());</span>
<span class="fc" id="L116">        }</span>
      });
<span class="fc" id="L118">      return values;</span>
    }
  }

  @Override
  public List&lt;DublinCoreValue&gt; get(EName property) {
<span class="fc" id="L124">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L125">    return getValuesAsList(property).stream()</span>
<span class="fc" id="L126">            .map(this::toDublinCoreValue)</span>
<span class="fc" id="L127">            .collect(Collectors.toList());</span>
  }

  private DublinCoreValue toDublinCoreValue(CatalogEntry e) {
<span class="fc" id="L131">    final String langRaw = e.getAttribute(XML_LANG_ATTR);</span>
<span class="fc bfc" id="L132" title="All 2 branches covered.">    final String lang = langRaw != null ? langRaw : LANGUAGE_UNDEFINED;</span>
<span class="fc" id="L133">    final String typeRaw = e.getAttribute(XSI_TYPE_ATTR);</span>
<span class="fc bfc" id="L134" title="All 2 branches covered.">    if (typeRaw != null) {</span>
<span class="fc" id="L135">      return DublinCoreValue.mk(e.getValue(), lang, toEName(typeRaw));</span>
    } else {
<span class="fc" id="L137">      return DublinCoreValue.mk(e.getValue(), lang);</span>
    }
  }

<span class="fc" id="L141">  private final Function&lt;CatalogEntry, DublinCoreValue&gt; toDublinCoreValue = new Function&lt;CatalogEntry, DublinCoreValue&gt;() {</span>
    @Override
    public DublinCoreValue apply(CatalogEntry e) {
<span class="fc" id="L144">      return toDublinCoreValue(e);</span>
    }
  };

  @Override
  public Map&lt;EName, List&lt;DublinCoreValue&gt;&gt; getValues() {
<span class="fc" id="L150">    Map&lt;EName, List&lt;DublinCoreValue&gt;&gt; result = new HashMap&lt;&gt;();</span>

<span class="fc bfc" id="L152" title="All 2 branches covered.">    for (List&lt;CatalogEntry&gt; entries : data.values()) {</span>
<span class="pc bpc" id="L153" title="1 of 2 branches missed.">      if (!entries.isEmpty()) {</span>
<span class="fc" id="L154">        EName property = entries.get(0).getEName();</span>
<span class="fc" id="L155">        List&lt;DublinCoreValue&gt; values = entries.stream()</span>
<span class="fc" id="L156">            .map(toDublinCoreValue)</span>
<span class="fc" id="L157">            .collect(Collectors.toList());</span>
<span class="fc" id="L158">        result.put(property, values);</span>
      }
<span class="fc" id="L160">    }</span>

<span class="fc" id="L162">    return result;</span>
  }

  @Override public List&lt;DublinCoreValue&gt; getValuesFlat() {
<span class="fc" id="L166">    return data.values().stream()</span>
<span class="fc" id="L167">        .flatMap(List::stream)</span>
<span class="fc" id="L168">        .map(toDublinCoreValue)</span>
<span class="fc" id="L169">        .collect(Collectors.toList());</span>
  }

  @Override
  @Nullable
  public String getFirst(EName property, String language) {
<span class="fc" id="L175">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L176">    RequireUtil.notNull(language, &quot;language&quot;);</span>

<span class="fc" id="L178">    final CatalogEntry f = getFirstCatalogEntry(property, language);</span>
<span class="fc bfc" id="L179" title="All 2 branches covered.">    return f != null ? f.getValue() : null;</span>
  }

  @Override
  public String getFirst(EName property) {
<span class="fc" id="L184">    RequireUtil.notNull(property, &quot;property&quot;);</span>

<span class="fc" id="L186">    final CatalogEntry f = getFirstCatalogEntry(property, LANGUAGE_ANY);</span>
<span class="fc bfc" id="L187" title="All 2 branches covered.">    return f != null ? f.getValue() : null;</span>
  }

  @Override
  public DublinCoreValue getFirstVal(EName property) {
<span class="fc" id="L192">    final CatalogEntry f = getFirstCatalogEntry(property, LANGUAGE_ANY);</span>
<span class="fc bfc" id="L193" title="All 2 branches covered.">    return f != null ? toDublinCoreValue(f) : null;</span>
  }

  private CatalogEntry getFirstCatalogEntry(EName property, String language) {
<span class="fc" id="L197">    CatalogEntry entry = null;</span>
<span class="fc bfc" id="L198" title="All 3 branches covered.">    switch (language) {</span>
      case LANGUAGE_UNDEFINED:
<span class="fc" id="L200">        entry = getFirstLocalizedValue(property, null);</span>
<span class="fc" id="L201">        break;</span>
      case LANGUAGE_ANY:
<span class="fc bfc" id="L203" title="All 2 branches covered.">        for (CatalogEntry value : getValuesAsList(property)) {</span>
<span class="fc" id="L204">          entry = value;</span>
          // Prefer values without language information
<span class="fc bfc" id="L206" title="All 2 branches covered.">          if (!value.hasAttribute(XML_LANG_ATTR))</span>
<span class="fc" id="L207">            break;</span>
<span class="fc" id="L208">        }</span>
<span class="fc" id="L209">        break;</span>
      default:
<span class="fc" id="L211">        entry = getFirstLocalizedValue(property, language);</span>
        break;
    }
<span class="fc" id="L214">    return entry;</span>
  }

  @Override
  public String getAsText(EName property, String language, String delimiter) {
<span class="fc" id="L219">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L220">    RequireUtil.notNull(language, &quot;language&quot;);</span>
<span class="fc" id="L221">    RequireUtil.notNull(delimiter, &quot;delimiter&quot;);</span>
    final List&lt;CatalogEntry&gt; values;
<span class="pc bpc" id="L223" title="1 of 3 branches missed.">    switch (language) {</span>
      case LANGUAGE_UNDEFINED:
<span class="nc" id="L225">        values = getLocalizedValuesAsList(property, null);</span>
<span class="nc" id="L226">        break;</span>
      case LANGUAGE_ANY:
<span class="fc" id="L228">        values = getValuesAsList(property);</span>
<span class="fc" id="L229">        break;</span>
      default:
<span class="fc" id="L231">        values = getLocalizedValuesAsList(property, language);</span>
        break;
    }
<span class="pc bpc" id="L234" title="1 of 4 branches missed.">    return (values != null &amp;&amp; !values.isEmpty())</span>
<span class="fc" id="L235">        ? values.stream()</span>
<span class="fc" id="L236">          .map(CatalogEntry::toString)</span>
<span class="fc" id="L237">          .collect(Collectors.joining(delimiter))</span>
<span class="fc" id="L238">        : null;</span>
  }

  @Override
  public Set&lt;String&gt; getLanguages(EName property) {
<span class="fc" id="L243">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L244">    Set&lt;String&gt; languages = new HashSet&lt;String&gt;();</span>
<span class="fc bfc" id="L245" title="All 2 branches covered.">    for (CatalogEntry entry : getValuesAsList(property)) {</span>
<span class="fc" id="L246">      String language = entry.getAttribute(XML_LANG_ATTR);</span>
<span class="fc bfc" id="L247" title="All 2 branches covered.">      if (language != null)</span>
<span class="fc" id="L248">        languages.add(language);</span>
      else
<span class="fc" id="L250">        languages.add(LANGUAGE_UNDEFINED);</span>
<span class="fc" id="L251">    }</span>
<span class="fc" id="L252">    return languages;</span>
  }

  @Override
  public boolean hasMultipleValues(EName property, String language) {
<span class="fc" id="L257">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L258">    RequireUtil.notNull(language, &quot;language&quot;);</span>
<span class="fc" id="L259">    return hasMultiplePropertyValues(property, language);</span>
  }

  @Override
  public boolean hasMultipleValues(EName property) {
<span class="fc" id="L264">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L265">    return hasMultiplePropertyValues(property, LANGUAGE_ANY);</span>
  }

  private boolean hasMultiplePropertyValues(EName property, String language) {
<span class="fc bfc" id="L269" title="All 2 branches covered.">    if (LANGUAGE_ANY.equals(language)) {</span>
<span class="pc bpc" id="L270" title="1 of 2 branches missed.">      return getValuesAsList(property).size() &gt; 1;</span>
    } else {
<span class="fc" id="L272">      int counter = 0;</span>
<span class="pc bpc" id="L273" title="1 of 2 branches missed.">      for (CatalogEntry entry : getValuesAsList(property)) {</span>
<span class="fc bfc" id="L274" title="All 2 branches covered.">        if (equalLanguage(language, entry.getAttribute(XML_LANG_ATTR)))</span>
<span class="fc" id="L275">          counter++;</span>
<span class="fc bfc" id="L276" title="All 2 branches covered.">        if (counter &gt; 1)</span>
<span class="fc" id="L277">          return true;</span>
<span class="fc" id="L278">      }</span>
<span class="nc" id="L279">      return false;</span>
    }
  }

  @Override
  public boolean hasValue(EName property, String language) {
<span class="fc" id="L285">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L286">    RequireUtil.notNull(language, &quot;language&quot;);</span>
<span class="fc" id="L287">    return hasPropertyValue(property, language);</span>
  }

  @Override
  public boolean hasValue(EName property) {
<span class="fc" id="L292">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L293">    return hasPropertyValue(property, LANGUAGE_ANY);</span>
  }

  private boolean hasPropertyValue(EName property, final String language) {
<span class="fc bfc" id="L297" title="All 2 branches covered.">    if (LANGUAGE_ANY.equals(language)) {</span>
<span class="fc bfc" id="L298" title="All 2 branches covered.">      return getValuesAsList(property).size() &gt; 0;</span>
    } else {
<span class="pc bpc" id="L300" title="1 of 2 branches missed.">      return CollectionUtils.find(getValuesAsList(property), new Predicate() {</span>
        @Override
        public boolean evaluate(Object o) {
<span class="fc" id="L303">          return equalLanguage(((CatalogEntry) o).getAttribute(XML_LANG_ATTR), language);</span>
        }
      }) != null;
    }
  }

  @Override
  public void set(EName property, @Nullable String value, String language) {
<span class="fc" id="L311">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="pc bpc" id="L312" title="2 of 4 branches missed.">    if (language == null || LANGUAGE_ANY.equals(language))</span>
<span class="nc" id="L313">      throw new IllegalArgumentException(&quot;Language code may not be null or LANGUAGE_ANY&quot;);</span>
<span class="fc" id="L314">    setValue(property, value, language, null);</span>
<span class="fc" id="L315">  }</span>

  @Override
  public void set(EName property, String value) {
<span class="fc" id="L319">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L320">    setValue(property, value, LANGUAGE_UNDEFINED, null);</span>
<span class="fc" id="L321">  }</span>

  @Override
  public void set(EName property, @Nullable DublinCoreValue value) {
<span class="fc" id="L325">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="pc bpc" id="L326" title="1 of 2 branches missed.">    if (value != null) {</span>
<span class="fc" id="L327">      setValue(property, value.getValue(), value.getLanguage(), value.getEncodingScheme().orElse(null));</span>
    } else {
<span class="nc" id="L329">      removeValue(property, LANGUAGE_ANY);</span>
    }
<span class="fc" id="L331">  }</span>

  @Override
  public void set(EName property, List&lt;DublinCoreValue&gt; values) {
<span class="fc" id="L335">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L336">    RequireUtil.notNull(values, &quot;values&quot;);</span>
<span class="fc" id="L337">    removeValue(property, LANGUAGE_ANY);</span>
<span class="fc bfc" id="L338" title="All 2 branches covered.">    for (DublinCoreValue v : values) {</span>
<span class="fc" id="L339">      add(property, v);</span>
<span class="fc" id="L340">    }</span>
<span class="fc" id="L341">  }</span>

  private void setValue(EName property, @Nullable String value, String language, @Nullable EName encodingScheme) {
<span class="fc bfc" id="L344" title="All 2 branches covered.">    if (value == null) {</span>
      // No value, remove the whole element
<span class="fc" id="L346">      removeValue(property, language);</span>
    } else {
<span class="fc bfc" id="L348" title="All 2 branches covered.">      String lang = !LANGUAGE_UNDEFINED.equals(language) ? language : null;</span>
<span class="fc" id="L349">      removeLocalizedValues(property, lang);</span>
<span class="fc" id="L350">      add(property, value, language, encodingScheme);</span>
    }
<span class="fc" id="L352">  }</span>

  @Override
  public void add(EName property, String value) {
<span class="fc" id="L356">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L357">    RequireUtil.notNull(value, &quot;value&quot;);</span>

<span class="fc" id="L359">    add(property, value, LANGUAGE_UNDEFINED, null);</span>
<span class="fc" id="L360">  }</span>

  @Override
  public void add(EName property, String value, String language) {
<span class="fc" id="L364">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L365">    RequireUtil.notNull(value, &quot;value&quot;);</span>
<span class="pc bpc" id="L366" title="2 of 4 branches missed.">    if (language == null || LANGUAGE_ANY.equals(language))</span>
<span class="nc" id="L367">      throw new IllegalArgumentException(&quot;Language code may not be null or LANGUAGE_ANY&quot;);</span>

<span class="fc" id="L369">    add(property, value, language, null);</span>
<span class="fc" id="L370">  }</span>

  @Override
  public void add(EName property, DublinCoreValue value) {
<span class="fc" id="L374">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L375">    RequireUtil.notNull(value, &quot;value&quot;);</span>

<span class="fc" id="L377">    add(property, value.getValue(), value.getLanguage(), value.getEncodingScheme().orElse(null));</span>
<span class="fc" id="L378">  }</span>

  void add(EName property, String value, String language, @Nullable EName encodingScheme) {
    // Ignore empty rootTag element
<span class="pc bpc" id="L382" title="1 of 4 branches missed.">    if (LANGUAGE_UNDEFINED.equals(language) &amp;&amp; !property.equals(rootTag)) {</span>
<span class="fc bfc" id="L383" title="All 2 branches covered.">      if (encodingScheme == null) {</span>
<span class="fc" id="L384">        addElement(property, value);</span>
      } else {
<span class="fc" id="L386">        addTypedElement(property, value, encodingScheme);</span>
      }
    } else {
      // Language defined
<span class="pc bpc" id="L390" title="1 of 2 branches missed.">      if (encodingScheme == null) {</span>
<span class="fc" id="L391">        addLocalizedElement(property, value, language);</span>
      } else {
<span class="nc" id="L393">        addTypedLocalizedElement(property, value, language, encodingScheme);</span>
      }
    }
<span class="fc" id="L396">  }</span>

  @Override
  public void remove(EName property, String language) {
<span class="fc" id="L400">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L401">    RequireUtil.notNull(language, &quot;language&quot;);</span>
<span class="fc" id="L402">    removeValue(property, language);</span>
<span class="fc" id="L403">  }</span>

  @Override
  public void remove(EName property) {
<span class="fc" id="L407">    RequireUtil.notNull(property, &quot;property&quot;);</span>
<span class="fc" id="L408">    removeValue(property, LANGUAGE_ANY);</span>
<span class="fc" id="L409">  }</span>

  private void removeValue(EName property, String language) {
<span class="fc bfc" id="L412" title="All 3 branches covered.">    switch (language) {</span>
      case LANGUAGE_ANY:
<span class="fc" id="L414">        removeElement(property);</span>
<span class="fc" id="L415">        break;</span>
      case LANGUAGE_UNDEFINED:
<span class="fc" id="L417">        removeLocalizedValues(property, null);</span>
<span class="fc" id="L418">        break;</span>
      default:
<span class="fc" id="L420">        removeLocalizedValues(property, language);</span>
        break;
    }
<span class="fc" id="L423">  }</span>

  @Override
  public void clear() {
<span class="nc" id="L427">    super.clear();</span>
<span class="nc" id="L428">  }</span>

  @Override
  public Object clone() {
<span class="fc" id="L432">    DublinCoreCatalog clone = new DublinCoreCatalog();</span>
<span class="fc" id="L433">    clone.setIdentifier(getIdentifier());</span>
<span class="fc" id="L434">    clone.setFlavor(getFlavor());</span>
<span class="fc" id="L435">    clone.setSize(getSize());</span>
<span class="fc" id="L436">    clone.setChecksum(getChecksum());</span>
<span class="fc" id="L437">    clone.bindings = bindings; // safe, since XmlNamespaceContext is immutable</span>
<span class="fc" id="L438">    clone.rootTag = rootTag;</span>
<span class="fc bfc" id="L439" title="All 2 branches covered.">    for (Map.Entry&lt;EName, List&lt;CatalogEntry&gt;&gt; entry : data.entrySet()) {</span>
<span class="fc" id="L440">      EName elmName = entry.getKey();</span>
<span class="fc" id="L441">      EName elmNameCopy = new EName(elmName.getNamespaceURI(), elmName.getLocalName());</span>
<span class="fc" id="L442">      List&lt;CatalogEntry&gt; elmsCopy = new ArrayList&lt;CatalogEntry&gt;();</span>
<span class="fc bfc" id="L443" title="All 2 branches covered.">      for (CatalogEntry catalogEntry : entry.getValue()) {</span>
<span class="fc" id="L444">        elmsCopy.add(new CatalogEntry(catalogEntry.getEName(), catalogEntry.getValue(), catalogEntry.getAttributes()));</span>
<span class="fc" id="L445">      }</span>
<span class="fc" id="L446">      clone.data.put(elmNameCopy, elmsCopy);</span>
<span class="fc" id="L447">    }</span>
<span class="fc" id="L448">    return clone;</span>
  }

  @Override
  public Set&lt;EName&gt; getProperties() {
<span class="fc" id="L453">    return Collections.unmodifiableSet(data.keySet());</span>
  }

  boolean equalLanguage(String a, String b) {
<span class="fc bfc" id="L457" title="All 6 branches covered.">    return (a == null &amp;&amp; Objects.equals(b, LANGUAGE_UNDEFINED))</span>
<span class="pc bpc" id="L458" title="1 of 2 branches missed.">        || (b == null &amp;&amp; Objects.equals(a, LANGUAGE_UNDEFINED))</span>
<span class="pc bpc" id="L459" title="1 of 2 branches missed.">        || Objects.equals(a, LANGUAGE_ANY)</span>
<span class="pc bpc" id="L460" title="1 of 4 branches missed.">        || Objects.equals(b, LANGUAGE_ANY)</span>
<span class="fc bfc" id="L461" title="All 2 branches covered.">        || (a != null &amp;&amp; Objects.equals(a, b));</span>
  }

  // make public
  @Override public EName toEName(String qName) {
<span class="fc" id="L466">    return super.toEName(qName);</span>
  }

  // make public
  @Nonnull @Override public String toQName(EName eName) {
<span class="fc" id="L471">    return super.toQName(eName);</span>
  }

  // make public
  @Override public void addElement(EName element, String value, Attributes attributes) {
    // Ignore empty root element
<span class="fc bfc" id="L477" title="All 2 branches covered.">    if (! rootTag.equals(element)) {</span>
<span class="fc" id="L478">      super.addElement(element, value, attributes);</span>
    }
<span class="fc" id="L480">  }</span>

  // make public
  @Override public CatalogEntry[] getValues(EName element) {
<span class="fc" id="L484">    return super.getValues(element);</span>
  }

  // make public
  @Override public List&lt;CatalogEntry&gt; getEntriesSorted() {
<span class="fc" id="L489">    return super.getEntriesSorted();</span>
  }

  /**
   * Saves the dublin core metadata container to a dom.
   *
   * @throws ParserConfigurationException
   *           if the xml parser environment is not correctly configured
   * @throws TransformerException
   *           if serialization of the metadata document fails
   * @throws IOException
   *           if an error with catalog serialization occurs
   */
  @Override
  public Document toXml() throws ParserConfigurationException, TransformerException, IOException {
<span class="fc" id="L504">    return DublinCoreXmlFormat.writeDocument(this);</span>
  }

  @Override
  public String toJson() throws IOException {
<span class="fc" id="L509">    return DublinCoreJsonFormat.writeJsonObject(this).toJSONString();</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>