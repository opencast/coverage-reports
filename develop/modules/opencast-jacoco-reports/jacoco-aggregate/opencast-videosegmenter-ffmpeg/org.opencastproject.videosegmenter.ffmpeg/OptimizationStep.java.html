<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>OptimizationStep.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-videosegmenter-ffmpeg</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.videosegmenter.ffmpeg</a> &gt; <span class="el_source">OptimizationStep.java</span></div><h1>OptimizationStep.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.videosegmenter.ffmpeg;

import org.opencastproject.metadata.mpeg7.Mpeg7Catalog;
import org.opencastproject.metadata.mpeg7.Segment;

import java.util.LinkedList;

/**
 * An optimization step is one step in the optimization of the number of segments.
 * This class stores parameters of such an optimization step and calculates error and
 * absolute error of optimization
 *
 */
public class OptimizationStep implements Comparable&lt;OptimizationStep&gt; {

  private float changesThreshold;
  private float error;
  private float errorAbs;
  private int segmentNum;
  private int prefNum;
  private Mpeg7Catalog mpeg7;
  private LinkedList&lt;Segment&gt; segments;

  /**
   * creates a new optimization step with given parameters
   *
   * @param changesThreshold
   * @param segNum
   * @param prefNum
   * @param mpeg7
   * @param segments unfiltered list of segments
   */
  public OptimizationStep(float changesThreshold, int segNum, int prefNum, Mpeg7Catalog mpeg7,
<span class="fc" id="L55">          LinkedList&lt;Segment&gt; segments) {</span>
<span class="fc" id="L56">    this.changesThreshold = changesThreshold;</span>
<span class="fc" id="L57">    this.segmentNum = segNum;</span>
<span class="fc" id="L58">    this.prefNum = prefNum;</span>
<span class="fc" id="L59">    this.mpeg7 = mpeg7;</span>
<span class="fc" id="L60">    this.segments = segments;</span>
<span class="fc" id="L61">    calcErrors();</span>
<span class="fc" id="L62">  }</span>

  /**
   *  creates a new optimization step with default values
   */
<span class="fc" id="L67">  public OptimizationStep() {</span>
<span class="fc" id="L68">    changesThreshold = 0.0f;</span>
<span class="fc" id="L69">    segmentNum = 1;</span>
<span class="fc" id="L70">    prefNum = 1;</span>
<span class="fc" id="L71">    mpeg7 = null;</span>
<span class="fc" id="L72">    segments = null;</span>
<span class="fc" id="L73">    calcErrors();</span>
<span class="fc" id="L74">  }</span>

  /**
   * calculate error of optimization and absolute error of optimization
   */
  private void calcErrors() {
<span class="fc" id="L80">    error = (float)(segmentNum - prefNum) / (float)prefNum;</span>
<span class="fc" id="L81">    errorAbs = Math.abs(error);</span>
<span class="fc" id="L82">  }</span>

  /**
   * get changesThreshold
   *
   * @return changesThreshold
   */
  public float getChangesThreshold() {
<span class="nc" id="L90">    return changesThreshold;</span>
  }

  /**
   * get error of optimization
   *
   * @return error error of optimization
   */
  public float getError() {
<span class="fc" id="L99">    return error;</span>
  }

  /**
   * get absolute error
   *
   * @return errorAbs absolute error
   */
  public float getErrorAbs() {
<span class="fc" id="L108">    return errorAbs;</span>
  }

  /**
   * get number of segments
   *
   * @return segmentNum number of segments
   */
  public int getSegmentNum() {
<span class="nc" id="L117">    return segmentNum;</span>
  }

  /**
   * set number of segments
   *
   * @param segNum number of segments
   */
  public void setSegmentNumAndRecalcErrors(int segNum) {
<span class="fc" id="L126">    segmentNum = segNum;</span>
<span class="fc" id="L127">    calcErrors();</span>
<span class="fc" id="L128">  }</span>

  /**
   * get Mpeg7Catalog with segments
   *
   * @return mpeg7 Mpeg7Catalog with segments
   */
  public Mpeg7Catalog getMpeg7() {
<span class="nc" id="L136">    return mpeg7;</span>
  }

  /**
   * get list of segments
   *
   * @return segments  list of segments
   */
  public LinkedList&lt;Segment&gt; getSegments() {
<span class="fc" id="L145">    return segments;</span>
  }

  /**
   * calculates absolute error from given number of segments and preferred
   * number of segments
   *
   * @param segmentNum number of segments
   * @param prefNum preferred number of segments
   * @return
   */
  public static float calculateErrorAbs(int segmentNum, int prefNum) {
<span class="fc" id="L157">    return Math.abs((float)(segmentNum - prefNum) / (float)prefNum);</span>
  }

/**
 * With this method a list of OptimizationSteps can be sorted such that the smallest
 * positive error is the first element of the list and the smallest negative
 * error is the last element of the list
 *
 * @param o the OptimizationStep to be compared.
 * @return a negative integer or a positive integer as this OptimizationStep should be placed to the left or right of
 * the specified OptimizationStep or zero if their errors are equal.
 */
  @Override
  public int compareTo(OptimizationStep o) {
<span class="fc bfc" id="L171" title="All 2 branches covered.">    if (error == o.getError()) {</span>
<span class="fc" id="L172">      return 0;</span>
    }
    // positive
<span class="fc bfc" id="L175" title="All 2 branches covered.">    if (error &gt;= 0) {</span>
      // if other error is negative put to the left of it
<span class="fc bfc" id="L177" title="All 2 branches covered.">      if (o.getError() &lt; 0) {</span>
<span class="fc" id="L178">        return -1;</span>
      } else {
        // if other error is also positive, compare errors, so that smaller positive error will be left
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">        if (error &lt; o.getError()) {</span>
<span class="fc" id="L182">          return -1;</span>
        } else {
<span class="nc" id="L184">          return 1;</span>
        }
      }
    // negative
    } else {
      // if other error is positive put to the right of it
<span class="fc bfc" id="L190" title="All 2 branches covered.">      if (o.getError() &gt;= 0) {</span>
<span class="fc" id="L191">        return 1;</span>
      } else {
        // if other error is also negative, compare errors, so that smaller negative error will be right
<span class="pc bpc" id="L194" title="1 of 2 branches missed.">        if (error &lt; o.getError()) {</span>
<span class="fc" id="L195">          return -1;</span>
        } else {
<span class="nc" id="L197">          return 1;</span>
        }
      }
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>