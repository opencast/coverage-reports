<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>SeriesEntity.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-series-service-impl</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.series.impl.persistence</a> &gt; <span class="el_source">SeriesEntity.java</span></div><h1>SeriesEntity.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.series.impl.persistence;

import org.opencastproject.security.api.User;

import java.util.Collections;
import java.util.Date;
import java.util.Map;
import java.util.TreeMap;

import javax.persistence.Access;
import javax.persistence.AccessType;
import javax.persistence.AttributeOverride;
import javax.persistence.AttributeOverrides;
import javax.persistence.CollectionTable;
import javax.persistence.Column;
import javax.persistence.ElementCollection;
import javax.persistence.Embedded;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.IdClass;
import javax.persistence.Index;
import javax.persistence.JoinColumn;
import javax.persistence.Lob;
import javax.persistence.MapKeyColumn;
import javax.persistence.NamedQueries;
import javax.persistence.NamedQuery;
import javax.persistence.Table;
import javax.persistence.Temporal;
import javax.persistence.TemporalType;
import javax.persistence.UniqueConstraint;

/**
 * Enitity object for storing series in persistence storage. Series ID is stored as primary key, DUBLIN_CORE field is
 * used to store serialized Dublin core and ACCESS_CONTROL field is used to store information about access control
 * rules.
 *
 */
@Entity(name = &quot;SeriesEntity&quot;)
@IdClass(SeriesEntityId.class)
@Access(AccessType.FIELD)
@Table(name = &quot;oc_series&quot;,
    indexes = {
        @Index(name = &quot;IX_oc_series_modified_date&quot;, columnList = (&quot;modified_date&quot;)),
    }
)
@NamedQueries({
    @NamedQuery(
        name = &quot;Series.findAll&quot;,
        query = &quot;select s from SeriesEntity s where s.deletionDate is null&quot;
    ),
    @NamedQuery(
        name = &quot;Series.getCount&quot;,
        query = &quot;select COUNT(s) from SeriesEntity s where s.deletionDate is null&quot;
    ),
    @NamedQuery(
        name = &quot;seriesById&quot;,
        query = &quot;select s from SeriesEntity as s where s.seriesId=:seriesId and s.organization=:organization&quot;
    ),
    @NamedQuery(
        name = &quot;Series.getAllModifiedSince&quot;,
        query = &quot;select s from SeriesEntity as s &quot;
            + &quot;where s.modifiedDate &gt;= :since and s.organization=:organization &quot;
            + &quot;order by s.modifiedDate asc&quot;
    ),
    @NamedQuery(
        name = &quot;Series.getAllModifiedInRange&quot;,
        query = &quot;select s from SeriesEntity as s &quot;
            + &quot;where s.modifiedDate &gt;= :from and s.modifiedDate &lt; :to and s.organization=:organization &quot;
            + &quot;order by s.modifiedDate asc&quot;
    ),
})
public class SeriesEntity {

  /** Series ID, primary key */
  @Id
  @GeneratedValue(strategy = GenerationType.AUTO)
  @Column(name = &quot;id&quot;, length = 128)
  protected String seriesId;

  /** Series ID, primary key */
  @Id
  @Column(name = &quot;organization&quot;, length = 128)
  protected String organization;

  /** Serialized Dublin core */
  @Lob
  @Column(name = &quot;dublin_core&quot;, length = 65535)
  protected String dublinCoreXML;

  /** Serialized access control */
  @Lob
  @Column(name = &quot;access_control&quot;, length = 65535)
  protected String accessControl;

<span class="fc" id="L118">  @Column(name = &quot;modified_date&quot;, nullable = false)</span>
  @Temporal(TemporalType.TIMESTAMP)
  protected Date modifiedDate = new Date();

<span class="fc" id="L122">  @Column(name = &quot;deletion_date&quot;)</span>
  @Temporal(TemporalType.TIMESTAMP)
  protected Date deletionDate = null;

  @Lob
  @ElementCollection(targetClass = String.class)
  @MapKeyColumn(name = &quot;name&quot;, nullable = false)
  @Column(name = &quot;\&quot;value\&quot;&quot;, length = 65535)
  @CollectionTable(name = &quot;oc_series_property&quot;, uniqueConstraints = {
      @UniqueConstraint(name = &quot;UNQ_series_properties&quot;, columnNames = {&quot;series&quot;, &quot;organization&quot;, &quot;name&quot;})
      }, joinColumns = {
          @JoinColumn(name = &quot;series&quot;, referencedColumnName = &quot;id&quot;, nullable = false),
          @JoinColumn(name = &quot;organization&quot;, referencedColumnName = &quot;organization&quot;, nullable = false) })
  protected Map&lt;String, String&gt; properties;

  @ElementCollection
  @MapKeyColumn(name = &quot;type&quot;, length = 128, nullable = false)
  @Column(name = &quot;data&quot;)
  @CollectionTable(name = &quot;oc_series_elements&quot;, uniqueConstraints = {
      @UniqueConstraint(name = &quot;UNQ_series_elements&quot;, columnNames = {&quot;series&quot;, &quot;organization&quot;, &quot;type&quot;})
      }, joinColumns = {
      @JoinColumn(name = &quot;series&quot;, referencedColumnName = &quot;id&quot;, nullable = false),
      @JoinColumn(name = &quot;organization&quot;, referencedColumnName = &quot;organization&quot;, nullable = false) })
  protected Map&lt;String, byte[]&gt; elements;

  @Embedded
  @AttributeOverrides({
      @AttributeOverride(name = &quot;username&quot;,
          column = @Column(name = &quot;creator_username&quot;, length = 128, nullable = false)
      ),
      @AttributeOverride(name = &quot;name&quot;,
          column = @Column(name = &quot;creator_name&quot;)
      ),
  })
  protected SeriesCreatorEntity creator;

  /**
   * Default constructor without any import.
   */
<span class="fc" id="L161">  protected SeriesEntity() {</span>
<span class="fc" id="L162">  }</span>

  /**
   * Returns series ID.
   *
   * @return series ID
   */
  public String getSeriesId() {
<span class="nc" id="L170">    return seriesId;</span>
  }

  /**
   * Sets series ID. ID length limit is 128 characters.
   *
   * @param seriesId
   */
  public void setSeriesId(String seriesId) {
<span class="pc bpc" id="L179" title="1 of 2 branches missed.">    if (seriesId == null) {</span>
<span class="nc" id="L180">      throw new IllegalArgumentException(&quot;Series id can't be null&quot;);</span>
    }
<span class="pc bpc" id="L182" title="1 of 2 branches missed.">    if (seriesId.length() &gt; 128) {</span>
<span class="nc" id="L183">      throw new IllegalArgumentException(&quot;Series id can't be longer than 128 characters&quot;);</span>
    }
<span class="fc" id="L185">    this.seriesId = seriesId;</span>
<span class="fc" id="L186">  }</span>

  /**
   * Returns serialized Dublin core.
   *
   * @return serialized Dublin core
   */
  public String getDublinCoreXML() {
<span class="fc" id="L194">    return dublinCoreXML;</span>
  }

  /**
   * Sets serialized Dublin core.
   *
   * @param dublinCoreXML
   *          serialized Dublin core
   */
  public void setSeries(String dublinCoreXML) {
<span class="fc" id="L204">    this.dublinCoreXML = dublinCoreXML;</span>
<span class="fc" id="L205">  }</span>

  /**
   * Returns serialized access control
   *
   * @return serialized access control
   */
  public String getAccessControl() {
<span class="fc" id="L213">    return accessControl;</span>
  }

  /**
   * Sets serialized access control.
   *
   * @param accessControl
   *          serialized access control
   */
  public void setAccessControl(String accessControl) {
<span class="fc" id="L223">    this.accessControl = accessControl;</span>
<span class="fc" id="L224">  }</span>

  /**
   * @return the organization
   */
  public String getOrganization() {
<span class="nc" id="L230">    return organization;</span>
  }

  /**
   * @param organization
   *          the organization to set
   */
  public void setOrganization(String organization) {
<span class="fc" id="L238">    this.organization = organization;</span>
<span class="fc" id="L239">  }</span>

  public Date getModifiedDate() {
<span class="nc" id="L242">    return this.modifiedDate;</span>
  }

  public void setModifiedDate(Date date) {
<span class="fc" id="L246">    this.modifiedDate = date;</span>
<span class="fc" id="L247">  }</span>

  public Date getDeletionDate() {
<span class="nc" id="L250">    return this.deletionDate;</span>
  }

  public void setDeletionDate(Date date) {
<span class="fc" id="L254">    this.deletionDate = date;</span>
<span class="fc" id="L255">  }</span>

  public boolean isDeleted() {
<span class="fc bfc" id="L258" title="All 2 branches covered.">    return this.deletionDate != null;</span>
  }

  public Map&lt;String, String&gt; getProperties() {
<span class="nc" id="L262">    return new TreeMap&lt;String, String&gt;(properties);</span>
  }

  public void setProperties(Map&lt;String, String&gt; properties) {
<span class="nc" id="L266">    this.properties = properties;</span>
<span class="nc" id="L267">  }</span>

  public Map&lt;String, byte[]&gt; getElements() {
<span class="fc" id="L270">    return Collections.unmodifiableMap(elements);</span>
  }

  public void addElement(String type, byte[] data) {
<span class="fc" id="L274">    elements.put(type, data);</span>
<span class="fc" id="L275">  }</span>

  public void removeElement(String type) {
<span class="fc" id="L278">    elements.remove(type);</span>
<span class="fc" id="L279">  }</span>

  public String getCreatorName() {
<span class="nc bnc" id="L282" title="All 2 branches missed.">    return creator != null ? creator.name() : null;</span>
  }

  public void setCreator(User user) {
<span class="fc" id="L286">    this.creator = new SeriesCreatorEntity(user);</span>
<span class="fc" id="L287">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>