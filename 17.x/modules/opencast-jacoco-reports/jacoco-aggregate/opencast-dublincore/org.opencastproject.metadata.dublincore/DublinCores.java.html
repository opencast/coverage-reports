<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>DublinCores.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-dublincore</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.metadata.dublincore</a> &gt; <span class="el_source">DublinCores.java</span></div><h1>DublinCores.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.metadata.dublincore;

import static javax.xml.XMLConstants.W3C_XML_SCHEMA_INSTANCE_NS_URI;
import static org.opencastproject.mediapackage.XMLCatalogImpl.XSI_NS_PREFIX;
import static org.opencastproject.metadata.dublincore.DublinCore.ELEMENTS_1_1_NS_PREFIX;
import static org.opencastproject.metadata.dublincore.DublinCore.ELEMENTS_1_1_NS_URI;
import static org.opencastproject.metadata.dublincore.DublinCore.TERMS_NS_PREFIX;
import static org.opencastproject.metadata.dublincore.DublinCore.TERMS_NS_URI;

import org.opencastproject.mediapackage.EName;
import org.opencastproject.mediapackage.MediaPackageElementFlavor;
import org.opencastproject.mediapackage.MediaPackageElements;
import org.opencastproject.metadata.dublincore.OpencastDctermsDublinCore.Episode;
import org.opencastproject.metadata.dublincore.OpencastDctermsDublinCore.Series;
import org.opencastproject.util.XmlNamespaceBinding;
import org.opencastproject.util.XmlNamespaceContext;

import org.apache.commons.io.IOUtils;

import java.io.IOException;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;

import javax.annotation.Nonnull;
import javax.annotation.ParametersAreNonnullByDefault;
import javax.xml.XMLConstants;

/**
 * Factory for metadata catalogs following the DublinCore standard.
 */
@ParametersAreNonnullByDefault
public final class DublinCores {
  /**
   * Namespace name of Dublin Core metadata generated by Opencast. By default this namespace is the default namespace
   * of xml documents generated by this class.
   */
  public static final String OC_DC_CATALOG_NS_URI = &quot;http://www.opencastproject.org/xsd/1.0/dublincore/&quot;;

  /** The dc root element of Opencast DublinCore catalogs. */
<span class="fc" id="L61">  public static final EName OC_DC_CATALOG_ROOT_ELEMENT = new EName(OC_DC_CATALOG_NS_URI, &quot;dublincore&quot;);</span>

  /** Namespace URI for Opencast properties. */
  public static final String OC_PROPERTY_NS_URI = &quot;http://www.opencastproject.org/matterhorn/&quot;;

  /** Prefix for Opencast properties. */
  public static final String OC_PROPERTY_NS_PREFIX = &quot;oc&quot;;

  /**
   * Opencast property: The timezone of the agent specified to be scheduled with an event. IE: &quot;America/Chicago&quot;
   */
<span class="fc" id="L72">  public static final EName OC_PROPERTY_AGENT_TIMEZONE = new EName(OC_PROPERTY_NS_URI, &quot;agentTimezone&quot;);</span>

  /**
   * This is a string defining a recurrence pattern as specified in RFC 2445. See &lt;a
   * href=&quot;http://tools.ietf.org/html/rfc2445#section-4.8.5.4&quot;&gt;http://tools.ietf.org/html/rfc2445#section-4.8.5.4&lt;/a&gt;
   */
<span class="fc" id="L78">  public static final EName OC_PROPERTY_RECURRENCE = new EName(OC_PROPERTY_NS_URI, &quot;recurrence&quot;);</span>
<span class="fc" id="L79">  public static final EName OC_PROPERTY_ANNOTATION = new EName(OC_PROPERTY_NS_URI, &quot;annotation&quot;);</span>
<span class="fc" id="L80">  public static final EName OC_PROPERTY_ADVERTISED = new EName(OC_PROPERTY_NS_URI, &quot;advertised&quot;);</span>
<span class="fc" id="L81">  public static final EName OC_PROPERTY_PROMOTED = new EName(OC_PROPERTY_NS_URI, &quot;promoted&quot;);</span>
<span class="fc" id="L82">  public static final EName OC_PROPERTY_DURATION = new EName(OC_PROPERTY_NS_URI, &quot;duration&quot;);</span>

  private DublinCores() {
  }

  /**
   * Create a new Opencast DublinCore metadata catalog for episodes.
   * &lt;ul&gt;
   * &lt;li&gt;Set flavor to {@link org.opencastproject.mediapackage.MediaPackageElements#EPISODE}.
   * &lt;li&gt;Register all necessary namespaces and set the root tag to {@link #OC_DC_CATALOG_ROOT_ELEMENT}.
   * &lt;li&gt;The catalog does not have an {@linkplain DublinCoreCatalog#getIdentifier() identifier} and the
   *   {@link DublinCore#PROPERTY_IDENTIFIER identifier} property is not set.
   * &lt;/ul&gt;
   *
   * @deprecated use {@link #mkOpencastEpisode()} instead
   */
  @Nonnull
  @Deprecated
  public static Episode mkOpencast() {
<span class="fc" id="L101">    return mkOpencastEpisode();</span>
  }

  /**
   * Create a new Opencast DublinCore metadata catalog for episodes.
   * &lt;ul&gt;
   * &lt;li&gt;Set flavor to {@link org.opencastproject.mediapackage.MediaPackageElements#EPISODE}.
   * &lt;li&gt;Register all necessary namespaces and set the root tag to {@link #OC_DC_CATALOG_ROOT_ELEMENT}.
   * &lt;li&gt;The catalog does not have an {@linkplain DublinCoreCatalog#getIdentifier() identifier} and the
   *   {@link DublinCore#PROPERTY_IDENTIFIER identifier} property is not set.
   * &lt;/ul&gt;
   */
  @Nonnull
  public static Episode mkOpencastEpisode() {
<span class="fc" id="L115">    return new Episode(mkOpencast(MediaPackageElements.EPISODE));</span>
  }

  /**
   * Create an Opencast episode DublinCore accessor for a {@link DublinCoreCatalog}.
   * Read and write operations access and modify the wrapped catalog.
   */
  @Nonnull
  public static Episode mkOpencastEpisode(DublinCoreCatalog dc) {
<span class="fc" id="L124">    return new Episode(dc);</span>
  }

  /**
   * Create a new Opencast DublinCore metadata catalog for series.
   * &lt;ul&gt;
   * &lt;li&gt;Set flavor to {@link org.opencastproject.mediapackage.MediaPackageElements#SERIES}.
   * &lt;li&gt;Register all necessary namespaces and set the root tag to {@link #OC_DC_CATALOG_ROOT_ELEMENT}.
   * &lt;li&gt;The catalog does not have an {@linkplain DublinCoreCatalog#getIdentifier() identifier} and the
   *   {@link DublinCore#PROPERTY_IDENTIFIER identifier} property is not set.
   * &lt;/ul&gt;
   */
  @Nonnull
  public static Series mkOpencastSeries() {
<span class="fc" id="L138">    return new Series(mkOpencast(MediaPackageElements.SERIES));</span>
  }

  /**
   * Create a new empty catalog suitable to take properties from the standard DublinCore
   * namespaces {@link DublinCore#ELEMENTS_1_1_NS_URI} and {@link DublinCore#TERMS_NS_URI}.
   * &lt;p&gt;
   * Please note that neither a flavor nor a root tag is set.
   */
  @Nonnull
  public static DublinCoreCatalog mkStandard() {
<span class="fc" id="L149">    final DublinCoreCatalog dc = new DublinCoreCatalog();</span>
<span class="fc" id="L150">    dc.addBindings(XmlNamespaceContext.mk(</span>
<span class="fc" id="L151">            XmlNamespaceBinding.mk(ELEMENTS_1_1_NS_PREFIX, ELEMENTS_1_1_NS_URI),</span>
<span class="fc" id="L152">            XmlNamespaceBinding.mk(TERMS_NS_PREFIX, TERMS_NS_URI)));</span>
<span class="fc" id="L153">    return dc;</span>
  }

  /** Create a new empty catalog with no special namespace registered, no root tag and no flavor. */
  @Nonnull
  public static DublinCoreCatalog mkSimple() {
<span class="fc" id="L159">    return new DublinCoreCatalog();</span>
  }

  /**
   * Read a DublinCore catalog from a stream containing either JSON or XML. The method is
   * capable of detecting the used format.
   * &lt;p&gt;
   * The reader is not capable of determining the catalog's flavor.
   * &lt;p&gt;
   * &lt;strong&gt;Implementation note:&lt;/strong&gt; In order to detect the format the whole stream is read into memory first.
   */
  @Nonnull
  public static DublinCoreCatalog read(InputStream in) {
    final String ser;
    try {
<span class="fc" id="L174">      ser = IOUtils.toString(in, StandardCharsets.UTF_8);</span>
<span class="nc" id="L175">    } catch (IOException e) {</span>
<span class="nc" id="L176">      throw new RuntimeException(&quot;Unable to read DublinCore from stream&quot;, e);</span>
<span class="fc" id="L177">    }</span>
<span class="fc bfc" id="L178" title="All 2 branches covered.">    if (DublinCoreJsonFormat.isJson(ser)) {</span>
      try {
<span class="fc" id="L180">        return DublinCoreJsonFormat.read(ser);</span>
<span class="nc" id="L181">      } catch (Exception e) {</span>
<span class="nc" id="L182">        throw new RuntimeException(&quot;Unable to read DublinCore catalog, JSON parsing failed.&quot;, e);</span>
      }
    } else {
      try {
<span class="fc" id="L186">        return DublinCoreXmlFormat.read(ser);</span>
<span class="nc" id="L187">      } catch (Exception e) {</span>
<span class="nc" id="L188">        throw new RuntimeException(&quot;Unable to read DublinCore catalog, XML parsing failed.&quot;, e);</span>
      }
    }
  }

  private static DublinCoreCatalog mkOpencast(MediaPackageElementFlavor flavor) {
<span class="fc" id="L194">    final DublinCoreCatalog dc = mkStandard();</span>
<span class="fc" id="L195">    dc.setFlavor(flavor);</span>
<span class="fc" id="L196">    dc.addBindings(XmlNamespaceContext.mk(</span>
            // Opencast property namespace
<span class="fc" id="L198">            XmlNamespaceBinding.mk(OC_PROPERTY_NS_PREFIX, OC_PROPERTY_NS_URI),</span>
            // Opencast root tag
<span class="fc" id="L200">            XmlNamespaceBinding.mk(XMLConstants.DEFAULT_NS_PREFIX, OC_DC_CATALOG_NS_URI)));</span>
            //XMLSchema-instance namespace xsi
<span class="fc" id="L202">            XmlNamespaceBinding.mk(XSI_NS_PREFIX, W3C_XML_SCHEMA_INSTANCE_NS_URI);</span>
<span class="fc" id="L203">    dc.setRootTag(OC_DC_CATALOG_ROOT_ELEMENT);</span>
<span class="fc" id="L204">    return dc;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>