<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>EventCommentDto.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-event-comment</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.event.comment.persistence</a> &gt; <span class="el_source">EventCommentDto.java</span></div><h1>EventCommentDto.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.event.comment.persistence;

import static org.opencastproject.util.RequireUtil.notNull;

import org.opencastproject.event.comment.EventComment;
import org.opencastproject.event.comment.EventCommentReply;
import org.opencastproject.security.api.OrganizationDirectoryService;
import org.opencastproject.security.api.User;
import org.opencastproject.security.api.UserDirectoryService;
import org.opencastproject.security.impl.jpa.JpaOrganization;
import org.opencastproject.security.impl.jpa.JpaUser;
import org.opencastproject.util.data.Option;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import javax.persistence.CascadeType;
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.FetchType;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.Index;
import javax.persistence.Lob;
import javax.persistence.NamedQueries;
import javax.persistence.NamedQuery;
import javax.persistence.OneToMany;
import javax.persistence.Table;
import javax.persistence.Temporal;
import javax.persistence.TemporalType;

@Entity(name = &quot;EventComment&quot;)
@Table(name = &quot;oc_event_comment&quot;, indexes = {
    @Index(name = &quot;IX_oc_event_comment_event&quot;, columnList = &quot;event, organization&quot;)
})
@NamedQueries({
    @NamedQuery(
        name = &quot;EventComment.countAll&quot;,
        query = &quot;SELECT COUNT(e) FROM EventComment e&quot;
    ),
    @NamedQuery(
        name = &quot;EventComment.findAll&quot;,
        query = &quot;SELECT e FROM EventComment e&quot;
    ),
    @NamedQuery(
        name = &quot;EventComment.findReasons&quot;,
        query = &quot;SELECT e.reason FROM EventComment e WHERE e.organization = :org GROUP BY e.reason&quot;
    ),
    @NamedQuery(
        name = &quot;EventComment.findByEvent&quot;,
        query = &quot;SELECT e FROM EventComment e &quot;
            + &quot;WHERE e.eventId = :eventId AND e.organization = :org ORDER BY e.creationDate&quot;
    ),
    @NamedQuery(
        name = &quot;EventComment.findByCommentId&quot;,
        query = &quot;SELECT e FROM EventComment e WHERE e.id = :commentId&quot;
    ),
    @NamedQuery(
        name = &quot;EventComment.findAllWIthOrg&quot;,
        query = &quot;SELECT e.organization, e.eventId FROM EventComment e ORDER BY e.organization ASC&quot;
    ),
    @NamedQuery(
        name = &quot;EventComment.clear&quot;,
        query = &quot;DELETE FROM EventComment e WHERE e.organization = :org&quot;
    ),
})
public class EventCommentDto {

  @Id
  @GeneratedValue
  @Column(name = &quot;id&quot;)
  private long id;

  @Column(name = &quot;organization&quot;, length = 128, nullable = false)
  private String organization;

  @Column(name = &quot;event&quot;, length = 128, nullable = false)
  private String eventId;

  @Lob
  @Column(name = &quot;text&quot;, nullable = false)
  private String text;

  @Column(name = &quot;creation_date&quot;, nullable = false)
  @Temporal(TemporalType.TIMESTAMP)
  private Date creationDate;

  @Column(name = &quot;modification_date&quot;, nullable = false)
  @Temporal(TemporalType.TIMESTAMP)
  private Date modificationDate;

  @Column(name = &quot;author&quot;, nullable = false)
  private String author;

  @Column(name = &quot;reason&quot;)
  private String reason;

<span class="fc" id="L120">  @Column(name = &quot;resolved_status&quot;, nullable = false)</span>
  private boolean resolvedStatus = false;

<span class="fc" id="L123">  @OneToMany(</span>
      targetEntity = EventCommentReplyDto.class,
      fetch = FetchType.LAZY,
      cascade = { CascadeType.REMOVE },
      mappedBy = &quot;eventComment&quot;,
      orphanRemoval = true
  )
  private List&lt;EventCommentReplyDto&gt; replies = new ArrayList&lt;EventCommentReplyDto&gt;();

  /**
   * Default constructor
   */
<span class="fc" id="L135">  public EventCommentDto() {</span>
<span class="fc" id="L136">  }</span>

  public static EventCommentDto from(EventComment comment) {
<span class="fc" id="L139">    EventCommentDto dto = new EventCommentDto();</span>

<span class="fc bfc" id="L141" title="All 2 branches covered.">    if (comment.getId().isSome()) {</span>
<span class="fc" id="L142">      dto.id = comment.getId().get().longValue();</span>
    }
<span class="fc" id="L144">    dto.organization = comment.getOrganization();</span>
<span class="fc" id="L145">    dto.eventId = comment.getEventId();</span>
<span class="fc" id="L146">    dto.text = comment.getText();</span>
<span class="fc" id="L147">    dto.creationDate = comment.getCreationDate();</span>
<span class="fc" id="L148">    dto.modificationDate = comment.getModificationDate();</span>
<span class="fc" id="L149">    dto.author = comment.getAuthor().getUsername();</span>
<span class="fc" id="L150">    dto.reason = comment.getReason();</span>
<span class="fc" id="L151">    dto.resolvedStatus = comment.isResolvedStatus();</span>

<span class="fc bfc" id="L153" title="All 2 branches covered.">    for (final EventCommentReply reply : comment.getReplies()) {</span>
<span class="fc" id="L154">      dto.addReply(EventCommentReplyDto.from(reply));</span>
<span class="fc" id="L155">    }</span>

<span class="fc" id="L157">    return dto;</span>
  }

  /**
   * Returns the id of this entity
   *
   * @return the id as long
   */
  public long getId() {
<span class="nc" id="L166">    return id;</span>
  }

  /**
   * Returns the event identifier
   *
   * @return the event identifier
   */
  public String getEventId() {
<span class="nc" id="L175">    return eventId;</span>
  }

  /**
   * Sets the event identifier
   *
   * @param eventId
   *          the event identifier
   */
  public void setEventId(String eventId) {
<span class="nc" id="L185">    this.eventId = eventId;</span>
<span class="nc" id="L186">  }</span>

  /**
   * Returns the organization
   *
   * @return the organization
   */
  public String getOrganization() {
<span class="nc" id="L194">    return organization;</span>
  }

  /**
   * Sets the organization
   *
   * @param organization
   *          the organization
   */
  public void setOrganization(String organization) {
<span class="nc" id="L204">    this.organization = organization;</span>
<span class="nc" id="L205">  }</span>

  /**
   * Sets the text
   *
   * @param text
   *          the text
   */
  public void setText(String text) {
<span class="nc" id="L214">    this.text = text;</span>
<span class="nc" id="L215">  }</span>

  /**
   * Returns the text
   *
   * @return the text
   */
  public String getText() {
<span class="nc" id="L223">    return text;</span>
  }

  /**
   * Sets the creation date
   *
   * @param creationDate
   *          the creation date
   */
  public void setCreationDate(Date creationDate) {
<span class="nc" id="L233">    this.creationDate = creationDate;</span>
<span class="nc" id="L234">  }</span>

  /**
   * Returns the creation date
   *
   * @return the creation date
   */
  public Date getCreationDate() {
<span class="nc" id="L242">    return creationDate;</span>
  }

  /**
   * Sets the modification date
   *
   * @param modificationDate
   *          the modification date
   */
  public void setModificationDate(Date modificationDate) {
<span class="nc" id="L252">    this.modificationDate = modificationDate;</span>
<span class="nc" id="L253">  }</span>

  /**
   * Returns the modification date
   *
   * @return the modification date
   */
  public Date getModificationDate() {
<span class="nc" id="L261">    return modificationDate;</span>
  }

  /**
   * Sets the author
   *
   * @param author
   *          the author
   */
  public void setAuthor(String author) {
<span class="nc" id="L271">    this.author = author;</span>
<span class="nc" id="L272">  }</span>

  /**
   * Returns the author
   *
   * @return the author
   */
  public String getAuthor() {
<span class="nc" id="L280">    return author;</span>
  }

  /**
   * Sets the reason
   *
   * @param reason
   *          the reason
   */
  public void setReason(String reason) {
<span class="nc" id="L290">    this.reason = reason;</span>
<span class="nc" id="L291">  }</span>

  /**
   * Returns the reason
   *
   * @return the reason
   */
  public String getReason() {
<span class="nc" id="L299">    return reason;</span>
  }

  /**
   * Sets whether the status is resolved
   *
   * @param resolvedStatus
   *          whether the status is resolved
   */
  public void setResolvedStatus(boolean resolvedStatus) {
<span class="nc" id="L309">    this.resolvedStatus = resolvedStatus;</span>
<span class="nc" id="L310">  }</span>

  /**
   * Returns whether the status is resolved
   *
   * @return whether the status is resolved
   */
  public boolean isResolvedStatus() {
<span class="nc" id="L318">    return resolvedStatus;</span>
  }

  /**
   * Sets a comment replies list.
   *
   * @param replies
   *          the replies list
   */
  public void setReplies(List&lt;EventCommentReplyDto&gt; replies) {
<span class="nc" id="L328">    this.replies = notNull(replies, &quot;replies&quot;);</span>
<span class="nc" id="L329">  }</span>

  /**
   * Returns the replies list
   *
   * @return the replies list
   */
  public List&lt;EventCommentReplyDto&gt; getReplies() {
<span class="nc" id="L337">    return replies;</span>
  }

  /**
   * Add a reply to the comment
   *
   * @param reply
   *          the reply to add to this comment
   *
   * @return true if this collection changed as a result of the call
   */
  public boolean addReply(EventCommentReplyDto reply) {
<span class="fc" id="L349">    notNull(reply, &quot;reply&quot;).setEventComment(this);</span>
<span class="fc" id="L350">    return replies.add(reply);</span>
  }

  /**
   * Remove a reply from the comment
   *
   * @param reply
   *          the reply to remove from this comment
   *
   * @return true if this collection changed as a result of the call
   */
  public boolean removeReply(EventCommentReplyDto reply) {
<span class="nc" id="L362">    return replies.remove(notNull(reply, &quot;reply&quot;));</span>
  }

  /**
   * Returns the business object of this comment
   *
   * @return the business object model of this comment
   */
  public EventComment toComment(UserDirectoryService userDirectoryService,
      OrganizationDirectoryService organizationDirectoryService) {
<span class="fc" id="L372">    User user = userDirectoryService.loadUser(author);</span>
<span class="pc bpc" id="L373" title="1 of 2 branches missed.">    if (user == null) {</span>
<span class="nc" id="L374">      JpaOrganization org = null;</span>
      try {
<span class="nc" id="L376">        org = (JpaOrganization) organizationDirectoryService.getOrganization(organization);</span>
<span class="nc" id="L377">      } catch (Exception ignore) { }</span>
<span class="nc" id="L378">      user = new JpaUser(author, null, org, author, &quot;ghost@localhost&quot;, &quot;ghost&quot;, false);</span>
    }
<span class="fc" id="L380">    EventComment comment = EventComment.create(Option.option(id), eventId, organization, text, user, reason,</span>
            resolvedStatus, creationDate, modificationDate);
<span class="fc bfc" id="L382" title="All 2 branches covered.">    for (EventCommentReplyDto reply : replies) {</span>
<span class="fc" id="L383">      comment.addReply(reply.toCommentReply(userDirectoryService));</span>
<span class="fc" id="L384">    }</span>
<span class="fc" id="L385">    return comment;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>