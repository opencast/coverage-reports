<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>HostRegistrationJpaImpl.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-common-jpa-impl</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.serviceregistry.impl.jpa</a> &gt; <span class="el_source">HostRegistrationJpaImpl.java</span></div><h1>HostRegistrationJpaImpl.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.serviceregistry.impl.jpa;

import org.opencastproject.serviceregistry.api.HostRegistration;

import javax.persistence.Access;
import javax.persistence.AccessType;
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.Index;
import javax.persistence.NamedQueries;
import javax.persistence.NamedQuery;
import javax.persistence.Table;
import javax.persistence.UniqueConstraint;

/**
 * A record of a host providing Opencast services.
 */
@Entity(name = &quot;HostRegistration&quot;)
@Access(AccessType.FIELD)
@Table(
    name = &quot;oc_host_registration&quot;,
    indexes = {
        @Index(name = &quot;IX_oc_host_registration_online&quot;, columnList = (&quot;online&quot;)),
        @Index(name = &quot;IX_oc_host_registration_active&quot;, columnList = (&quot;active&quot;)),
    },
    uniqueConstraints = @UniqueConstraint(columnNames = &quot;host&quot;)
)
@NamedQueries({
    @NamedQuery(
        name = &quot;HostRegistration.getMaxLoad&quot;,
        query = &quot;SELECT sum(hr.maxLoad) FROM HostRegistration hr where hr.active = true&quot;
    ),
    @NamedQuery(
        name = &quot;HostRegistration.getMaxLoadByHostName&quot;,
        query = &quot;SELECT hr.maxLoad FROM HostRegistration hr &quot;
            + &quot;where hr.baseUrl = :host and hr.active = true&quot;
    ),
    @NamedQuery(
        name = &quot;HostRegistration.byHostName&quot;,
        query = &quot;SELECT hr from HostRegistration hr where hr.baseUrl = :host&quot;
    ),
    @NamedQuery(
        name = &quot;HostRegistration.jobStatistics&quot;,
        query = &quot;select j.processorServiceRegistration.hostRegistration.id, j.status, count(j) &quot;
            + &quot;from Job j &quot;
            + &quot;where j.status in :status &quot;
            + &quot;group by j.processorServiceRegistration.hostRegistration.id, j.status&quot;
    ),
    @NamedQuery(
        name = &quot;HostRegistration.getAll&quot;,
        query = &quot;SELECT hr FROM HostRegistration hr where hr.active = true&quot;
    ),
})
public class HostRegistrationJpaImpl implements HostRegistration {

  @Id
  @Column(name = &quot;id&quot;)
  @GeneratedValue
  private Long id;

  @Column(name = &quot;host&quot;, nullable = false)
  private String baseUrl;

  @Column(name = &quot;address&quot;, nullable = false, length = 39)
  private String ipAddress;

  @Column(name = &quot;node_name&quot;)
  private String nodeName;

  @Column(name = &quot;memory&quot;, nullable = false)
  private long memory;

  @Column(name = &quot;cores&quot;, nullable = false)
  private int cores;

  /**
   * The maximum load this host can run.  This is not necessarily 1-to-1 with the number of jobs.
   */
  @Column(name = &quot;max_load&quot;, nullable = false)
  private float maxLoad;

<span class="fc" id="L105">  @Column(name = &quot;online&quot;, nullable = false)</span>
  private boolean online = true;

<span class="fc" id="L108">  @Column(name = &quot;active&quot;, nullable = false)</span>
  private boolean active = true;

<span class="fc" id="L111">  @Column(name = &quot;maintenance&quot;, nullable = false)</span>
  private boolean maintenanceMode = false;;

  /**
   * Creates a new host registration which is online
   */
<span class="fc" id="L117">  public HostRegistrationJpaImpl() {</span>
<span class="fc" id="L118">  }</span>

  public HostRegistrationJpaImpl(
      String baseUrl,
      String address,
      String nodeName,
      long memory,
      int cores,
      float maxLoad,
      boolean online,
      boolean maintenance
<span class="fc" id="L129">  ) {</span>
<span class="fc" id="L130">    this.baseUrl = baseUrl;</span>
<span class="fc" id="L131">    this.ipAddress = address;</span>
<span class="fc" id="L132">    this.nodeName = nodeName;</span>
<span class="fc" id="L133">    this.memory = memory;</span>
<span class="fc" id="L134">    this.cores = cores;</span>
<span class="fc" id="L135">    this.maxLoad = maxLoad;</span>
<span class="fc" id="L136">    this.online = online;</span>
<span class="fc" id="L137">    this.maintenanceMode = maintenance;</span>
<span class="fc" id="L138">    this.active = true;</span>
<span class="fc" id="L139">  }</span>

  @Override
  public Long getId() {
<span class="nc" id="L143">    return id;</span>
  }

  public void setId(Long id) {
<span class="nc" id="L147">    this.id = id;</span>
<span class="nc" id="L148">  }</span>

  @Override
  public String getBaseUrl() {
<span class="fc" id="L152">    return baseUrl;</span>
  }

  @Override
  public void setBaseUrl(String baseUrl) {
<span class="nc" id="L157">    this.baseUrl = baseUrl;</span>
<span class="nc" id="L158">  }</span>

  @Override
  public String getIpAddress() {
<span class="nc" id="L162">    return ipAddress;</span>
  }

  @Override
  public void setIpAddress(String address) {
<span class="fc" id="L167">    this.ipAddress = address;</span>
<span class="fc" id="L168">  }</span>

  @Override
  public String getNodeName() {
<span class="nc" id="L172">    return nodeName;</span>
  }

  @Override
  public void setNodeName(String nodeName) {
<span class="fc" id="L177">    this.nodeName = nodeName;</span>
<span class="fc" id="L178">  }</span>

  @Override
  public long getMemory() {
<span class="nc" id="L182">    return memory;</span>
  }

  @Override
  public void setMemory(long memory) {
<span class="fc" id="L187">    this.memory = memory;</span>
<span class="fc" id="L188">  }</span>

  @Override
  public int getCores() {
<span class="nc" id="L192">    return cores;</span>
  }

  @Override
  public void setCores(int cores) {
<span class="fc" id="L197">    this.cores = cores;</span>
<span class="fc" id="L198">  }</span>

  @Override
  public float getMaxLoad() {
<span class="fc" id="L202">    return maxLoad;</span>
  }

  @Override
  public void setMaxLoad(float maxLoad) {
<span class="fc" id="L207">    this.maxLoad = maxLoad;</span>
<span class="fc" id="L208">  }</span>

  @Override
  public boolean isOnline() {
<span class="fc" id="L212">    return online;</span>
  }

  @Override
  public void setOnline(boolean online) {
<span class="fc" id="L217">    this.online = online;</span>
<span class="fc" id="L218">  }</span>

  @Override
  public boolean isActive() {
<span class="fc" id="L222">    return active;</span>
  }

  @Override
  public void setActive(boolean active) {
<span class="fc" id="L227">    this.active = active;</span>
<span class="fc" id="L228">  }</span>

  @Override
  public boolean isMaintenanceMode() {
<span class="fc" id="L232">    return maintenanceMode;</span>
  }

  @Override
  public void setMaintenanceMode(boolean maintenanceMode) {
<span class="fc" id="L237">    this.maintenanceMode = maintenanceMode;</span>
<span class="fc" id="L238">  }</span>

  @Override
  public int hashCode() {
<span class="nc" id="L242">    return toString().hashCode();</span>
  }

  @Override
  public boolean equals(Object obj) {
<span class="pc bpc" id="L247" title="1 of 2 branches missed.">    if (!(obj instanceof HostRegistration)) {</span>
<span class="nc" id="L248">      return false;</span>
    }
<span class="fc" id="L250">    HostRegistration registration = (HostRegistration) obj;</span>
<span class="fc" id="L251">    return baseUrl.equals(registration.getBaseUrl());</span>
  }

  @Override
  public String toString() {
<span class="fc" id="L256">    return baseUrl;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>