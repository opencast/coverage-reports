<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>MediaTimePointImpl.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-mpeg7</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.metadata.mpeg7</a> &gt; <span class="el_source">MediaTimePointImpl.java</span></div><h1>MediaTimePointImpl.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */


package org.opencastproject.metadata.mpeg7;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;

import java.util.Calendar;
import java.util.Formatter;
import java.util.TimeZone;

/**
 * TODO: Comment me!
 */
public class MediaTimePointImpl implements MediaTimePoint {

  /** The reference time point */
<span class="fc" id="L39">  private MediaTimePoint referenceTimePoint = null;</span>

  /** Time delimiter */
  private static final String TimeSpecDelimiter = &quot;T&quot;;

  /** Fraction delimiter */
  private static final String FractionSpecDelimiter = &quot;F&quot;;

  /** Time separator */
  private static final String TimeSeparator = &quot;:&quot;;

  /** Date separator */
  private static final String DateSeparator = &quot;-&quot;;

  /** The year */
<span class="fc" id="L54">  protected int year = 0;</span>

  /** The month */
<span class="fc" id="L57">  protected int month = 0;</span>

  /** The day of month */
<span class="fc" id="L60">  protected int day = 0;</span>

  /** The number of hour */
<span class="fc" id="L63">  protected int hour = 0;</span>

  /** The nubmer of minutes */
<span class="fc" id="L66">  protected int minute = 0;</span>

  /** The number of seconds */
<span class="fc" id="L69">  protected int second = 0;</span>

  /** The fraction */
<span class="fc" id="L72">  protected int fractions = 0;</span>

  /** The number of fractions per second */
<span class="fc" id="L75">  protected int fractionsPerSecond = 0;</span>

  /** The time zone */
<span class="fc" id="L78">  protected String timeZone = &quot;+00:00&quot;;</span>

  /** Number of milliseconds per day */
  private static final long MS_PER_DAY = 86400000L;

  /** Number of milliseconds per hour */
  private static final long MS_PER_HOUR = 3600000L;

  /** Number of milliseconds per minute */
  private static final long MS_PER_MINUTE = 60000L;

  /** Number of milliseconds per second */
  private static final long MS_PER_SECOND = 1000L;

  /**
   * Creates a new media time point representing &lt;code&gt;T00:00:00:0F0&lt;/code&gt;
   */
<span class="fc" id="L95">  public MediaTimePointImpl() {</span>
<span class="fc" id="L96">    year = 0;</span>
<span class="fc" id="L97">    month = 0;</span>
<span class="fc" id="L98">    day = 0;</span>
<span class="fc" id="L99">    hour = 0;</span>
<span class="fc" id="L100">    minute = 0;</span>
<span class="fc" id="L101">    second = 0;</span>
<span class="fc" id="L102">    fractions = 0;</span>
<span class="fc" id="L103">    fractionsPerSecond = 0;</span>
<span class="fc" id="L104">  }</span>

  /**
   * Creates a new timepoint representing the given time.
   *
   * @param milliseconds
   *          the number of milliseconds
   */
<span class="fc" id="L112">  public MediaTimePointImpl(long milliseconds) {</span>
<span class="fc" id="L113">    Calendar calendar = Calendar.getInstance();</span>
<span class="fc" id="L114">    calendar.setTimeInMillis(milliseconds);</span>
<span class="fc" id="L115">    calendar.setTimeZone(TimeZone.getTimeZone(&quot;UCT&quot;));</span>
<span class="fc" id="L116">    second = calendar.get(Calendar.SECOND);</span>
<span class="fc" id="L117">    minute = calendar.get(Calendar.MINUTE);</span>
<span class="fc" id="L118">    hour = calendar.get(Calendar.HOUR_OF_DAY);</span>
<span class="fc" id="L119">    day = calendar.get(Calendar.DAY_OF_MONTH) - 1;</span>
<span class="fc" id="L120">    month = calendar.get(Calendar.MONTH);</span>
<span class="fc" id="L121">    year = calendar.get(Calendar.YEAR);</span>
<span class="fc" id="L122">    fractions = Math.round(milliseconds % 1000);</span>
<span class="fc" id="L123">    fractionsPerSecond = 1000;</span>
<span class="fc" id="L124">  }</span>

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaTimePoint
   */
  public int getDay() {
<span class="fc" id="L130">    return day;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaTimePoint#getHour()
   */
  public int getHour() {
<span class="fc" id="L137">    return hour;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaTimePoint#getMinutes()
   */
  public int getMinutes() {
<span class="fc" id="L144">    return minute;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaTimePoint#getMonth()
   */
  public int getMonth() {
<span class="nc" id="L151">    return month;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaTimePoint#getNFractions()
   */
  public int getNFractions() {
<span class="fc" id="L158">    return fractions;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaTimePoint#getSeconds()
   */
  public int getSeconds() {
<span class="fc" id="L165">    return second;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaTimePoint#getYear()
   */
  public int getYear() {
<span class="nc" id="L172">    return year;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaTimePoint#getFractionsPerSecond()
   */
  public int getFractionsPerSecond() {
<span class="fc" id="L179">    return fractionsPerSecond;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaTimePoint#getTimeInMilliseconds()
   */
  public long getTimeInMilliseconds() {
<span class="fc" id="L186">    long milliseconds = second * MS_PER_SECOND;</span>
<span class="fc" id="L187">    milliseconds += minute * MS_PER_MINUTE;</span>
<span class="fc" id="L188">    milliseconds += hour * MS_PER_HOUR;</span>
<span class="fc" id="L189">    milliseconds += day * MS_PER_DAY;</span>
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">    if (fractionsPerSecond &gt; 0)</span>
<span class="fc" id="L191">      milliseconds += (fractions * 1000L / fractionsPerSecond);</span>
<span class="fc" id="L192">    return milliseconds;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaTimePoint#isRelative()
   */
  public boolean isRelative() {
<span class="nc bnc" id="L199" title="All 2 branches missed.">    return referenceTimePoint != null;</span>
  }

  /**
   * Sets a reference time point which makes this time point relative to the given one.
   *
   * @param timePoint
   *          the reference time point
   */
  public void setReferenceTimePoint(MediaTimePoint timePoint) {
<span class="fc" id="L209">    this.referenceTimePoint = timePoint;</span>
<span class="fc" id="L210">  }</span>

  public void setFractionsPerSecond(int fractionsPerSecond) {
<span class="nc" id="L213">    this.fractionsPerSecond = fractionsPerSecond;</span>
<span class="nc" id="L214">  }</span>

  public String getTimeZone() {
<span class="nc" id="L217">    return timeZone;</span>
  }

  public void setTimeZone(String timeZone) {
<span class="nc" id="L221">    this.timeZone = timeZone;</span>
<span class="nc" id="L222">  }</span>

  public void setDay(int day) {
<span class="nc" id="L225">    this.day = day;</span>
<span class="nc" id="L226">  }</span>

  public void setHour(int hour) {
<span class="nc" id="L229">    this.hour = hour;</span>
<span class="nc" id="L230">  }</span>

  public void setMinutes(int minutes) {
<span class="nc" id="L233">    this.minute = minutes;</span>
<span class="nc" id="L234">  }</span>

  public void setMonth(int month) {
<span class="nc" id="L237">    this.month = month;</span>
<span class="nc" id="L238">  }</span>

  public void setFractions(int fractions) {
<span class="nc" id="L241">    this.fractions = fractions;</span>
<span class="nc" id="L242">  }</span>

  public void setSeconds(int seconds) {
<span class="nc" id="L245">    this.second = seconds;</span>
<span class="nc" id="L246">  }</span>

  public void setYear(int year) {
<span class="nc" id="L249">    this.year = year;</span>
<span class="nc" id="L250">  }</span>

  /**
   * Creates a timepoint representation from the given time point string.
   *
   * @param text
   *          the timepoint text representation
   * @return the the timepoint
   * @throws IllegalArgumentException
   *           if &lt;code&gt;text&lt;/code&gt; is malformed
   */
  public static MediaTimePointImpl parseTimePoint(String text) throws IllegalArgumentException {
<span class="fc" id="L262">    MediaTimePointImpl timePoint = new MediaTimePointImpl();</span>
<span class="fc" id="L263">    timePoint.parse(text);</span>
<span class="fc" id="L264">    return timePoint;</span>
  }

  /**
   * Parses a timepoint string.
   */
  private void parse(String text) throws IllegalArgumentException {
<span class="fc" id="L271">    String date = null;</span>
<span class="fc" id="L272">    String time = null;</span>
<span class="fc" id="L273">    String fractions = null;</span>
<span class="fc" id="L274">    date = text.substring(0, text.indexOf(TimeSpecDelimiter));</span>
<span class="fc" id="L275">    time = text.substring(text.indexOf(TimeSpecDelimiter) + 1, text.indexOf(TimeSpecDelimiter) + 9);</span>
<span class="fc" id="L276">    fractions = text.substring(text.indexOf(TimeSpecDelimiter) + time.length() + 2);</span>
<span class="pc bpc" id="L277" title="1 of 2 branches missed.">    if (fractions.contains(TimeSeparator)) {</span>
<span class="nc" id="L278">      timeZone = fractions.substring(fractions.length() - 6);</span>
<span class="nc" id="L279">      fractions = fractions.substring(0, fractions.length() - 7);</span>
    }
<span class="fc" id="L281">    parseDate(date);</span>
<span class="fc" id="L282">    parseTime(time);</span>
<span class="fc" id="L283">    parseFractions(fractions);</span>
<span class="fc" id="L284">  }</span>

  /**
   * Parses the date portion of a time point.
   *
   * @param date
   *          the date
   */
  protected void parseDate(String date) {
<span class="fc" id="L293">    int firstDateSeparator = date.indexOf(DateSeparator);</span>
<span class="fc" id="L294">    int lastDateSeparator = date.lastIndexOf(DateSeparator);</span>
<span class="fc bfc" id="L295" title="All 2 branches covered.">    if (firstDateSeparator &gt; -1) {</span>
<span class="fc" id="L296">      year = Integer.parseInt(date.substring(0, firstDateSeparator));</span>
<span class="fc" id="L297">      month = Short.parseShort(date.substring(firstDateSeparator + 1, lastDateSeparator));</span>
<span class="fc" id="L298">      day = Short.parseShort(date.substring(lastDateSeparator + 1));</span>
    } else {
<span class="fc" id="L300">      year = 0;</span>
<span class="fc" id="L301">      month = 0;</span>
<span class="fc" id="L302">      day = 0;</span>
    }
<span class="fc" id="L304">  }</span>

  /**
   * Parses the time portion of a time point
   *
   * @param time
   *          the time
   */
  protected void parseTime(String time) {
<span class="fc" id="L313">    int firstTimeSeparator = time.indexOf(TimeSeparator);</span>
<span class="fc" id="L314">    int lastTimeSeparator = time.lastIndexOf(TimeSeparator);</span>
<span class="pc bpc" id="L315" title="1 of 2 branches missed.">    if (firstTimeSeparator &gt; -1) {</span>
<span class="fc" id="L316">      hour = Short.parseShort(time.substring(0, firstTimeSeparator));</span>
<span class="fc" id="L317">      minute = Short.parseShort(time.substring(firstTimeSeparator + 1, lastTimeSeparator));</span>
<span class="fc" id="L318">      second = Short.parseShort(time.substring(lastTimeSeparator + 1));</span>
    }
<span class="fc" id="L320">  }</span>

  /**
   * Parses the fractions of a time point.
   *
   * @param fractions
   *          the fractions
   */
  private void parseFractions(String fractions) {
<span class="fc" id="L329">    this.fractions = Integer.parseInt(fractions.substring(0, fractions.indexOf(FractionSpecDelimiter)));</span>
<span class="fc" id="L330">    this.fractionsPerSecond = Integer.parseInt(fractions.substring(fractions.indexOf(FractionSpecDelimiter) + 1));</span>
<span class="fc" id="L331">  }</span>

  /**
   * @see java.lang.Object#toString()
   */
  @Override
  public String toString() {
<span class="fc" id="L338">    Formatter f = new Formatter();</span>
<span class="fc" id="L339">    String result = null;</span>
<span class="pc bpc" id="L340" title="1 of 4 branches missed.">    if (referenceTimePoint == null &amp;&amp; year != 0) {</span>
<span class="fc" id="L341">      result = f.format(&quot;%04d-%02d-%02dT%02d:%02d:%02d:%dF%d&quot;, year, month, day, hour, minute, second, fractions,</span>
<span class="fc" id="L342">              fractionsPerSecond).toString();</span>
    } else {
<span class="fc" id="L344">      result = f.format(&quot;T%02d:%02d:%02d:%dF%d&quot;, hour, minute, second, fractions, fractionsPerSecond).toString();</span>
    }
<span class="fc" id="L346">    f.close();</span>
<span class="fc" id="L347">    return result;</span>
  }

  /**
   * @see org.opencastproject.mediapackage.XmlElement#toXml(org.w3c.dom.Document)
   */
  public Node toXml(Document document) {
<span class="fc" id="L354">    Element node = null;</span>
<span class="pc bpc" id="L355" title="1 of 2 branches missed.">    if (referenceTimePoint != null)</span>
<span class="nc" id="L356">      node = document.createElement(&quot;MediaRelTimePoint&quot;);</span>
    else
<span class="fc" id="L358">      node = document.createElement(&quot;MediaTimePoint&quot;);</span>
<span class="fc" id="L359">    node.setTextContent(toString());</span>
<span class="fc" id="L360">    return node;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>