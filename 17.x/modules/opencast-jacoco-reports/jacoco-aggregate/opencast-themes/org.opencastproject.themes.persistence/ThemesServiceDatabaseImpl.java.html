<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>ThemesServiceDatabaseImpl.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-themes</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.themes.persistence</a> &gt; <span class="el_source">ThemesServiceDatabaseImpl.java</span></div><h1>ThemesServiceDatabaseImpl.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.themes.persistence;

import static org.opencastproject.db.Queries.namedQuery;

import org.opencastproject.db.DBSession;
import org.opencastproject.db.DBSessionFactory;
import org.opencastproject.elasticsearch.api.SearchIndexException;
import org.opencastproject.elasticsearch.index.ElasticsearchIndex;
import org.opencastproject.elasticsearch.index.objects.theme.IndexTheme;
import org.opencastproject.elasticsearch.index.rebuild.AbstractIndexProducer;
import org.opencastproject.elasticsearch.index.rebuild.IndexProducer;
import org.opencastproject.elasticsearch.index.rebuild.IndexRebuildException;
import org.opencastproject.elasticsearch.index.rebuild.IndexRebuildService;
import org.opencastproject.security.api.Organization;
import org.opencastproject.security.api.OrganizationDirectoryService;
import org.opencastproject.security.api.SecurityService;
import org.opencastproject.security.api.User;
import org.opencastproject.security.api.UserDirectoryService;
import org.opencastproject.themes.Theme;
import org.opencastproject.themes.ThemesServiceDatabase;
import org.opencastproject.util.NotFoundException;

import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.tuple.Pair;
import org.osgi.service.component.ComponentContext;
import org.osgi.service.component.annotations.Activate;
import org.osgi.service.component.annotations.Component;
import org.osgi.service.component.annotations.Reference;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
import java.util.function.Function;
import java.util.stream.Collectors;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;

/**
 * Implements {@link ThemesServiceDatabase}. Defines permanent storage for themes.
 */
@Component(
    immediate = true,
    service = { ThemesServiceDatabase.class, IndexProducer.class },
    property = {
        &quot;service.description=Themes Database Service&quot;
    }
)
<span class="fc" id="L72">public class ThemesServiceDatabaseImpl extends AbstractIndexProducer implements ThemesServiceDatabase {</span>

  public static final String PERSISTENCE_UNIT = &quot;org.opencastproject.themes&quot;;

  /** Logging utilities */
<span class="fc" id="L77">  private static final Logger logger = LoggerFactory.getLogger(ThemesServiceDatabaseImpl.class);</span>

  /** Factory used to create {@link EntityManager}s for transactions */
  protected EntityManagerFactory emf;

  protected DBSessionFactory dbSessionFactory;

  protected DBSession db;

  /** The security service */
  protected SecurityService securityService;

  /** The user directory service */
  protected UserDirectoryService userDirectoryService;

  /** The organization directory service to get organizations */
  protected OrganizationDirectoryService organizationDirectoryService;

  /** The elasticsearch indices */
  protected ElasticsearchIndex index;

  /** The component context for this themes service database */
  private ComponentContext cc;

  /**
   * Creates {@link EntityManagerFactory} using persistence provider and properties passed via OSGi.
   *
   * @param cc
   */
  @Activate
  public void activate(ComponentContext cc) {
<span class="fc" id="L108">    logger.info(&quot;Activating persistence manager for themes&quot;);</span>
<span class="fc" id="L109">    this.cc = cc;</span>
<span class="fc" id="L110">    db = dbSessionFactory.createSession(emf);</span>
<span class="fc" id="L111">  }</span>

  /** OSGi DI */
  @Reference(target = &quot;(osgi.unit.name=org.opencastproject.themes)&quot;)
  public void setEntityManagerFactory(EntityManagerFactory emf) {
<span class="fc" id="L116">    this.emf = emf;</span>
<span class="fc" id="L117">  }</span>

  @Reference
  public void setDBSessionFactory(DBSessionFactory dbSessionFactory) {
<span class="fc" id="L121">    this.dbSessionFactory = dbSessionFactory;</span>
<span class="fc" id="L122">  }</span>

  /**
   * OSGi callback to set the security service.
   *
   * @param securityService
   *          the security service
   */
  @Reference
  public void setSecurityService(SecurityService securityService) {
<span class="fc" id="L132">    this.securityService = securityService;</span>
<span class="fc" id="L133">  }</span>

  /**
   * OSGi callback to set the user directory service
   *
   * @param userDirectoryService
   *          the user directory service
   */
  @Reference
  public void setUserDirectoryService(UserDirectoryService userDirectoryService) {
<span class="fc" id="L143">    this.userDirectoryService = userDirectoryService;</span>
<span class="fc" id="L144">  }</span>

  /** OSGi DI */
  @Reference
  public void setOrganizationDirectoryService(OrganizationDirectoryService organizationDirectoryService) {
<span class="nc" id="L149">    this.organizationDirectoryService = organizationDirectoryService;</span>
<span class="nc" id="L150">  }</span>

  /** OSGi DI */
  @Reference
  public void setIndex(ElasticsearchIndex index) {
<span class="fc" id="L155">    this.index = index;</span>
<span class="fc" id="L156">  }</span>

  @Override
  public Theme getTheme(long id) throws ThemesServiceDatabaseException, NotFoundException {
    try {
<span class="fc" id="L161">      return db.exec(getThemeDtoQuery(id))</span>
<span class="fc" id="L162">          .map(t -&gt; t.toTheme(userDirectoryService))</span>
<span class="fc" id="L163">          .orElseThrow(() -&gt; new NotFoundException(&quot;No theme with id=&quot; + id + &quot; exists&quot;));</span>
<span class="fc" id="L164">    } catch (NotFoundException e) {</span>
<span class="fc" id="L165">      throw e;</span>
<span class="nc" id="L166">    } catch (Exception e) {</span>
<span class="nc" id="L167">      logger.error(&quot;Could not get theme&quot;, e);</span>
<span class="nc" id="L168">      throw new ThemesServiceDatabaseException(e);</span>
    }
  }

  private List&lt;Theme&gt; getThemes() throws ThemesServiceDatabaseException {
    try {
<span class="nc" id="L174">      String orgId = securityService.getOrganization().getId();</span>
<span class="nc" id="L175">      return db.exec(namedQuery.findAll(</span>
          &quot;Themes.findByOrg&quot;,
              ThemeDto.class,
<span class="nc" id="L178">              Pair.of(&quot;org&quot;, orgId)</span>
<span class="nc" id="L179">          )).stream()</span>
<span class="nc" id="L180">          .map(t -&gt; t.toTheme(userDirectoryService))</span>
<span class="nc" id="L181">          .collect(Collectors.toList());</span>
<span class="nc" id="L182">    } catch (Exception e) {</span>
<span class="nc" id="L183">      logger.error(&quot;Could not get themes&quot;, e);</span>
<span class="nc" id="L184">      throw new ThemesServiceDatabaseException(e);</span>
    }
  }

  @Override
  public Theme updateTheme(final Theme theme) throws ThemesServiceDatabaseException {
    try {
<span class="fc" id="L191">      Theme newTheme = db.execTxChecked(em -&gt; {</span>
<span class="fc" id="L192">        ThemeDto themeDto = null;</span>
<span class="fc bfc" id="L193" title="All 2 branches covered.">        if (theme.getId().isSome()) {</span>
<span class="fc" id="L194">          themeDto = getThemeDtoQuery(theme.getId().get()).apply(em).orElse(null);</span>
        }

<span class="fc bfc" id="L197" title="All 2 branches covered.">        if (themeDto == null) {</span>
          // no theme stored, create new entity
<span class="fc" id="L199">          themeDto = new ThemeDto();</span>
<span class="fc" id="L200">          themeDto.setOrganization(securityService.getOrganization().getId());</span>
<span class="fc" id="L201">          updateTheme(theme, themeDto);</span>
<span class="fc" id="L202">          em.persist(themeDto);</span>
        } else {
<span class="fc" id="L204">          updateTheme(theme, themeDto);</span>
<span class="fc" id="L205">          em.merge(themeDto);</span>
        }

<span class="fc" id="L208">        return themeDto.toTheme(userDirectoryService);</span>
      });

      // update the elasticsearch indices
<span class="fc" id="L212">      String orgId = securityService.getOrganization().getId();</span>
<span class="fc" id="L213">      User user = securityService.getUser();</span>
<span class="fc" id="L214">      updateThemeInIndex(newTheme, orgId, user);</span>

<span class="fc" id="L216">      return newTheme;</span>
<span class="nc" id="L217">    } catch (Exception e) {</span>
<span class="nc" id="L218">      logger.error(&quot;Could not update theme {}&quot;, theme, e);</span>
<span class="nc" id="L219">      throw new ThemesServiceDatabaseException(e);</span>
    }
  }

  private void updateTheme(Theme theme, ThemeDto themeDto) {
<span class="fc bfc" id="L224" title="All 2 branches covered.">    if (theme.getId().isSome()) {</span>
<span class="fc" id="L225">      themeDto.setId(theme.getId().get());</span>
    }
<span class="fc" id="L227">    themeDto.setUsername(theme.getCreator().getUsername());</span>
<span class="fc" id="L228">    themeDto.setCreationDate(theme.getCreationDate());</span>
<span class="fc" id="L229">    themeDto.setDefault(theme.isDefault());</span>
<span class="fc" id="L230">    themeDto.setName(theme.getName());</span>
<span class="fc" id="L231">    themeDto.setDescription(theme.getDescription());</span>
<span class="fc" id="L232">    themeDto.setBumperActive(theme.isBumperActive());</span>
<span class="fc" id="L233">    themeDto.setBumperFile(theme.getBumperFile());</span>
<span class="fc" id="L234">    themeDto.setTrailerActive(theme.isTrailerActive());</span>
<span class="fc" id="L235">    themeDto.setTrailerFile(theme.getTrailerFile());</span>
<span class="fc" id="L236">    themeDto.setTitleSlideActive(theme.isTitleSlideActive());</span>
<span class="fc" id="L237">    themeDto.setTitleSlideBackground(theme.getTitleSlideBackground());</span>
<span class="fc" id="L238">    themeDto.setTitleSlideMetadata(theme.getTitleSlideMetadata());</span>
<span class="fc" id="L239">    themeDto.setLicenseSlideActive(theme.isLicenseSlideActive());</span>
<span class="fc" id="L240">    themeDto.setLicenseSlideBackground(theme.getLicenseSlideBackground());</span>
<span class="fc" id="L241">    themeDto.setLicenseSlideDescription(theme.getLicenseSlideDescription());</span>
<span class="fc" id="L242">    themeDto.setWatermarkActive(theme.isWatermarkActive());</span>
<span class="fc" id="L243">    themeDto.setWatermarkFile(theme.getWatermarkFile());</span>
<span class="fc" id="L244">    themeDto.setWatermarkPosition(theme.getWatermarkPosition());</span>
<span class="fc" id="L245">  }</span>

  @Override
  public void deleteTheme(long id) throws ThemesServiceDatabaseException, NotFoundException {
    try {
<span class="fc" id="L250">      db.execTxChecked(em -&gt; {</span>
<span class="fc" id="L251">        ThemeDto themeDto = getThemeDtoQuery(id).apply(em)</span>
<span class="pc" id="L252">            .orElseThrow(() -&gt; new NotFoundException(&quot;No theme with id=&quot; + id + &quot; exists&quot;));</span>
<span class="fc" id="L253">        namedQuery.remove(themeDto).accept(em);</span>
<span class="fc" id="L254">      });</span>

      // update the elasticsearch indices
<span class="fc" id="L257">      String organization = securityService.getOrganization().getId();</span>
<span class="fc" id="L258">      removeThemeFromIndex(id, organization);</span>
<span class="nc" id="L259">    } catch (NotFoundException e) {</span>
<span class="nc" id="L260">      throw e;</span>
<span class="nc" id="L261">    } catch (Exception e) {</span>
<span class="nc" id="L262">      logger.error(&quot;Could not delete theme '{}'&quot;, id, e);</span>
<span class="nc" id="L263">      throw new ThemesServiceDatabaseException(e);</span>
<span class="fc" id="L264">    }</span>
<span class="fc" id="L265">  }</span>

  @Override
  public int countThemes() throws ThemesServiceDatabaseException {
    try {
<span class="fc" id="L270">      String orgId = securityService.getOrganization().getId();</span>
<span class="fc" id="L271">      return db.exec(namedQuery.find(</span>
          &quot;Themes.count&quot;,
          Number.class,
<span class="fc" id="L274">          Pair.of(&quot;org&quot;, orgId)</span>
<span class="fc" id="L275">      )).intValue();</span>
<span class="nc" id="L276">    } catch (Exception e) {</span>
<span class="nc" id="L277">      logger.error(&quot;Could not count themes&quot;, e);</span>
<span class="nc" id="L278">      throw new ThemesServiceDatabaseException(e);</span>
    }
  }

  /**
   * Gets a theme by its ID, using the current organizational context.
   *
   * @param id
   *          the theme identifier
   * @return a query function returning an optional theme entity
   */
  private Function&lt;EntityManager, Optional&lt;ThemeDto&gt;&gt; getThemeDtoQuery(long id) {
<span class="fc" id="L290">    String orgId = securityService.getOrganization().getId();</span>
<span class="fc" id="L291">    return namedQuery.findOpt(</span>
        &quot;Themes.findById&quot;,
        ThemeDto.class,
<span class="fc" id="L294">        Pair.of(&quot;id&quot;, id),</span>
<span class="fc" id="L295">        Pair.of(&quot;org&quot;, orgId)</span>
    );
  }

  @Override
  public void repopulate(IndexRebuildService.DataType type) throws IndexRebuildException {
    try {
<span class="nc bnc" id="L302" title="All 2 branches missed.">      for (final Organization organization : organizationDirectoryService.getOrganizations()) {</span>
        try {
<span class="nc" id="L304">          final List&lt;Theme&gt; themes = getThemes();</span>
<span class="nc" id="L305">          int total = themes.size();</span>
<span class="nc" id="L306">          logIndexRebuildBegin(logger, total, &quot;themes&quot;, organization);</span>
<span class="nc" id="L307">          int current = 0;</span>
<span class="nc" id="L308">          int n = 20;</span>
<span class="nc" id="L309">          List&lt;IndexTheme&gt; updatedThemeRange = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L311" title="All 2 branches missed.">          for (Theme theme : themes) {</span>
<span class="nc" id="L312">            current++;</span>

<span class="nc" id="L314">            var updatedThemeData = index.getTheme(theme.getId().get(), organization.toString(),</span>
<span class="nc" id="L315">                        securityService.getUser());</span>
<span class="nc" id="L316">            updatedThemeData = getThemeUpdateFunction(theme, organization.toString()).apply(updatedThemeData);</span>
<span class="nc" id="L317">            updatedThemeRange.add(updatedThemeData.get());</span>

<span class="nc bnc" id="L319" title="All 4 branches missed.">            if (updatedThemeRange.size() &gt;= n || current &gt;= themes.size()) {</span>
<span class="nc" id="L320">              index.bulkThemeUpdate(updatedThemeRange);</span>
<span class="nc" id="L321">              logIndexRebuildProgress(logger, total, current, n);</span>
<span class="nc" id="L322">              updatedThemeRange.clear();</span>
            }
<span class="nc" id="L324">          }</span>
<span class="nc" id="L325">        } catch (ThemesServiceDatabaseException e) {</span>
<span class="nc" id="L326">          logger.error(&quot;Unable to get themes from the database&quot;, e);</span>
<span class="nc" id="L327">          throw new IllegalStateException(e);</span>
<span class="nc" id="L328">        }</span>
<span class="nc" id="L329">      }</span>
<span class="nc" id="L330">    } catch (Exception e) {</span>
<span class="nc" id="L331">      logIndexRebuildError(logger, e);</span>
<span class="nc" id="L332">      throw new IndexRebuildException(getService(), e);</span>
<span class="nc" id="L333">    }</span>
<span class="nc" id="L334">  }</span>

  @Override
  public IndexRebuildService.Service getService() {
<span class="nc" id="L338">    return IndexRebuildService.Service.Themes;</span>
  }

  /**
   * Remove the theme from the ElasticSearch index.
   *
   * @param themeId
   *           the id of the theme to remove
   * @param orgId
   *           the organization the theme belongs to
   */
  private void removeThemeFromIndex(long themeId, String orgId) {
<span class="fc" id="L350">    logger.debug(&quot;Removing theme {} from the {} index.&quot;, themeId, index.getIndexName());</span>

    try {
<span class="fc" id="L353">      index.deleteTheme(Long.toString(themeId), orgId);</span>
<span class="fc" id="L354">      logger.debug(&quot;Theme {} removed from the {} index&quot;, themeId, index.getIndexName());</span>
<span class="nc" id="L355">    } catch (SearchIndexException e) {</span>
<span class="nc" id="L356">      logger.error(&quot;Error deleting the theme {} from the {} index&quot;, themeId, index.getIndexName(), e);</span>
<span class="fc" id="L357">    }</span>
<span class="fc" id="L358">  }</span>

  /**
   * Update the theme in the ElasticSearch index.
   *  @param theme
   *           the theme to update
   * @param orgId
   *           the organization the theme belongs to
   * @param user
   */
  private void updateThemeInIndex(Theme theme, String orgId,
          User user) {
<span class="fc" id="L370">    logger.debug(&quot;Updating the theme with id '{}', name '{}', description '{}', organization '{}' in the {} index.&quot;,</span>
<span class="fc" id="L371">            theme.getId(), theme.getName(), theme.getDescription(),</span>
<span class="fc" id="L372">            orgId, index.getIndexName());</span>
    try {
<span class="pc bpc" id="L374" title="1 of 2 branches missed.">      if (theme.getId().isNone()) {</span>
<span class="nc" id="L375">        throw new IllegalArgumentException(&quot;Can't put theme in index without valid id!&quot;);</span>
      }
<span class="fc" id="L377">      Long id = theme.getId().get();</span>

      // the function to do the actual updating
<span class="fc" id="L380">      Function&lt;Optional&lt;IndexTheme&gt;, Optional&lt;IndexTheme&gt;&gt; updateFunction = (Optional&lt;IndexTheme&gt; indexThemeOpt) -&gt; {</span>
        IndexTheme indexTheme;
<span class="nc" id="L382">        indexTheme = indexThemeOpt.orElseGet(() -&gt; new IndexTheme(id, orgId));</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">        String creator = StringUtils.isNotBlank(theme.getCreator().getName())</span>
<span class="nc" id="L384">                ? theme.getCreator().getName() : theme.getCreator().getUsername();</span>

<span class="nc" id="L386">        indexTheme.setCreationDate(theme.getCreationDate());</span>
<span class="nc" id="L387">        indexTheme.setDefault(theme.isDefault());</span>
<span class="nc" id="L388">        indexTheme.setName(theme.getName());</span>
<span class="nc" id="L389">        indexTheme.setDescription(theme.getDescription());</span>
<span class="nc" id="L390">        indexTheme.setCreator(creator);</span>
<span class="nc" id="L391">        indexTheme.setBumperActive(theme.isBumperActive());</span>
<span class="nc" id="L392">        indexTheme.setBumperFile(theme.getBumperFile());</span>
<span class="nc" id="L393">        indexTheme.setTrailerActive(theme.isTrailerActive());</span>
<span class="nc" id="L394">        indexTheme.setTrailerFile(theme.getTrailerFile());</span>
<span class="nc" id="L395">        indexTheme.setTitleSlideActive(theme.isTitleSlideActive());</span>
<span class="nc" id="L396">        indexTheme.setTitleSlideBackground(theme.getTitleSlideBackground());</span>
<span class="nc" id="L397">        indexTheme.setTitleSlideMetadata(theme.getTitleSlideMetadata());</span>
<span class="nc" id="L398">        indexTheme.setLicenseSlideActive(theme.isLicenseSlideActive());</span>
<span class="nc" id="L399">        indexTheme.setLicenseSlideBackground(theme.getLicenseSlideBackground());</span>
<span class="nc" id="L400">        indexTheme.setLicenseSlideDescription(theme.getLicenseSlideDescription());</span>
<span class="nc" id="L401">        indexTheme.setWatermarkActive(theme.isWatermarkActive());</span>
<span class="nc" id="L402">        indexTheme.setWatermarkFile(theme.getWatermarkFile());</span>
<span class="nc" id="L403">        indexTheme.setWatermarkPosition(theme.getWatermarkPosition());</span>
<span class="nc" id="L404">        return Optional.of(indexTheme);</span>
      };

<span class="fc" id="L407">      index.addOrUpdateTheme(id, updateFunction, orgId, user);</span>
<span class="fc" id="L408">      logger.debug(&quot;Updated the theme {} in the {} index&quot;, theme.getId(), index.getIndexName());</span>
<span class="nc" id="L409">    } catch (SearchIndexException e) {</span>
<span class="nc" id="L410">      logger.error(&quot;Error updating the theme {} in the {} index&quot;, theme.getId(), index.getIndexName(), e);</span>
<span class="fc" id="L411">    }</span>
<span class="fc" id="L412">  }</span>
  /**
   * Get the function to update a theme in the Elasticsearch index.
   *
   * @param theme
   *          The theme to update
   * @param orgId
   *          The id of the current organization
   * @return the function to do the update
   */
  private Function&lt;Optional&lt;IndexTheme&gt;, Optional&lt;IndexTheme&gt;&gt; getThemeUpdateFunction(Theme theme, String orgId) {
<span class="nc" id="L423">    return (Optional&lt;IndexTheme&gt; indexThemeOpt) -&gt; {</span>
      IndexTheme indexTheme;
<span class="nc" id="L425">      indexTheme = indexThemeOpt.orElseGet(() -&gt; new IndexTheme(theme.getId().get(), orgId));</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">      String creator = theme.getCreator() == null ? &quot;?&quot; : (</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">          StringUtils.isNotBlank(theme.getCreator().getName())</span>
<span class="nc" id="L428">              ? theme.getCreator().getName()</span>
<span class="nc" id="L429">              : theme.getCreator().getUsername());</span>

<span class="nc" id="L431">      indexTheme.setCreationDate(theme.getCreationDate());</span>
<span class="nc" id="L432">      indexTheme.setDefault(theme.isDefault());</span>
<span class="nc" id="L433">      indexTheme.setName(theme.getName());</span>
<span class="nc" id="L434">      indexTheme.setDescription(theme.getDescription());</span>
<span class="nc" id="L435">      indexTheme.setCreator(creator);</span>
<span class="nc" id="L436">      indexTheme.setBumperActive(theme.isBumperActive());</span>
<span class="nc" id="L437">      indexTheme.setBumperFile(theme.getBumperFile());</span>
<span class="nc" id="L438">      indexTheme.setTrailerActive(theme.isTrailerActive());</span>
<span class="nc" id="L439">      indexTheme.setTrailerFile(theme.getTrailerFile());</span>
<span class="nc" id="L440">      indexTheme.setTitleSlideActive(theme.isTitleSlideActive());</span>
<span class="nc" id="L441">      indexTheme.setTitleSlideBackground(theme.getTitleSlideBackground());</span>
<span class="nc" id="L442">      indexTheme.setTitleSlideMetadata(theme.getTitleSlideMetadata());</span>
<span class="nc" id="L443">      indexTheme.setLicenseSlideActive(theme.isLicenseSlideActive());</span>
<span class="nc" id="L444">      indexTheme.setLicenseSlideBackground(theme.getLicenseSlideBackground());</span>
<span class="nc" id="L445">      indexTheme.setLicenseSlideDescription(theme.getLicenseSlideDescription());</span>
<span class="nc" id="L446">      indexTheme.setWatermarkActive(theme.isWatermarkActive());</span>
<span class="nc" id="L447">      indexTheme.setWatermarkFile(theme.getWatermarkFile());</span>
<span class="nc" id="L448">      indexTheme.setWatermarkPosition(theme.getWatermarkPosition());</span>
<span class="nc" id="L449">      return Optional.of(indexTheme);</span>
    };
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>