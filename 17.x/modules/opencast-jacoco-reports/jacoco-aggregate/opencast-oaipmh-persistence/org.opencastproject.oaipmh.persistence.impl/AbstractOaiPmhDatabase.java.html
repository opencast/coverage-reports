<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>AbstractOaiPmhDatabase.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-oaipmh-persistence</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.oaipmh.persistence.impl</a> &gt; <span class="el_source">AbstractOaiPmhDatabase.java</span></div><h1>AbstractOaiPmhDatabase.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */
package org.opencastproject.oaipmh.persistence.impl;

import org.opencastproject.db.DBSession;
import org.opencastproject.mediapackage.MediaPackage;
import org.opencastproject.mediapackage.MediaPackageElement;
import org.opencastproject.mediapackage.MediaPackageParser;
import org.opencastproject.oaipmh.persistence.OaiPmhDatabase;
import org.opencastproject.oaipmh.persistence.OaiPmhDatabaseException;
import org.opencastproject.oaipmh.persistence.OaiPmhElementEntity;
import org.opencastproject.oaipmh.persistence.OaiPmhEntity;
import org.opencastproject.oaipmh.persistence.OaiPmhSetDefinition;
import org.opencastproject.oaipmh.persistence.OaiPmhSetDefinitionFilter;
import org.opencastproject.oaipmh.persistence.Query;
import org.opencastproject.oaipmh.persistence.SearchResult;
import org.opencastproject.oaipmh.persistence.SearchResultElementItem;
import org.opencastproject.oaipmh.persistence.SearchResultItem;
import org.opencastproject.security.api.SecurityService;
import org.opencastproject.util.MimeTypes;
import org.opencastproject.util.NotFoundException;
import org.opencastproject.util.XmlUtil;
import org.opencastproject.workspace.api.Workspace;

import org.apache.commons.io.IOUtils;
import org.apache.commons.lang3.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.InputStream;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Date;
import java.util.List;
import java.util.concurrent.locks.ReadWriteLock;
import java.util.concurrent.locks.ReentrantReadWriteLock;
import java.util.regex.Pattern;

import javax.persistence.EntityManager;
import javax.persistence.NoResultException;
import javax.persistence.TypedQuery;
import javax.persistence.criteria.CriteriaBuilder;
import javax.persistence.criteria.CriteriaQuery;
import javax.persistence.criteria.Predicate;
import javax.persistence.criteria.Root;

<span class="fc" id="L65">public abstract class AbstractOaiPmhDatabase implements OaiPmhDatabase {</span>
  /** Logging utilities */
<span class="fc" id="L67">  private static final Logger logger = LoggerFactory.getLogger(AbstractOaiPmhDatabase.class);</span>

<span class="fc" id="L69">  private ReadWriteLock dbAccessLock = new ReentrantReadWriteLock();</span>

  public abstract DBSession getDBSession();

  public abstract SecurityService getSecurityService();

  public abstract Workspace getWorkspace();

  @Override
  public void store(MediaPackage mediaPackage, String repository) throws OaiPmhDatabaseException {
    try {
<span class="fc" id="L80">      dbAccessLock.writeLock().lock();</span>
<span class="fc" id="L81">      storeInternal(mediaPackage, repository);</span>
    } finally {
<span class="fc" id="L83">      dbAccessLock.writeLock().unlock();</span>
    }
<span class="fc" id="L85">  }</span>

  private void storeInternal(MediaPackage mediaPackage, String repository) throws OaiPmhDatabaseException {
    try {
<span class="fc" id="L89">      getDBSession().execTx(em -&gt; {</span>
<span class="fc" id="L90">        OaiPmhEntity entity = getOaiPmhEntity(mediaPackage.getIdentifier().toString(), repository, em);</span>
<span class="fc bfc" id="L91" title="All 2 branches covered.">        if (entity == null) {</span>
          // no entry found, create new entity
<span class="fc" id="L93">          entity = new OaiPmhEntity();</span>
<span class="fc" id="L94">          updateEntity(entity, mediaPackage, repository);</span>
<span class="fc" id="L95">          em.persist(entity);</span>
        } else {
          // entry found, update existing
<span class="fc" id="L98">          updateEntity(entity, mediaPackage, repository);</span>
<span class="fc" id="L99">          em.merge(entity);</span>
        }
<span class="fc" id="L101">      });</span>
<span class="nc" id="L102">    } catch (Exception e) {</span>
<span class="nc" id="L103">      logger.error(&quot;Could not store mediapackage '{}' to OAI-PMH repository '{}'&quot;, mediaPackage.getIdentifier(),</span>
            repository, e);
<span class="nc" id="L105">      throw new OaiPmhDatabaseException(e);</span>
<span class="fc" id="L106">    }</span>
<span class="fc" id="L107">  }</span>

  public void updateEntity(OaiPmhEntity entity, MediaPackage mediaPackage, String repository) {
<span class="fc" id="L110">    entity.setOrganization(getSecurityService().getOrganization().getId());</span>
<span class="fc" id="L111">    entity.setDeleted(false);</span>
<span class="fc" id="L112">    entity.setRepositoryId(repository);</span>

<span class="fc" id="L114">    entity.setMediaPackageId(mediaPackage.getIdentifier().toString());</span>
<span class="fc" id="L115">    entity.setMediaPackageXML(MediaPackageParser.getAsXml(mediaPackage));</span>
<span class="fc" id="L116">    entity.setSeries(mediaPackage.getSeries());</span>
<span class="fc" id="L117">    entity.removeAllMediaPackageElements();</span>


<span class="fc bfc" id="L120" title="All 2 branches covered.">    for (MediaPackageElement mpe : mediaPackage.getElements()) {</span>
<span class="pc bpc" id="L121" title="1 of 2 branches missed.">      if (mpe.getFlavor() == null) {</span>
<span class="nc" id="L122">        logger.debug(&quot;A flavor must be set on media package elements for publishing&quot;);</span>
<span class="nc" id="L123">        continue;</span>
      }

<span class="pc bpc" id="L126" title="1 of 2 branches missed.">      if (mpe.getElementType() != MediaPackageElement.Type.Catalog</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">              &amp;&amp; mpe.getElementType() != MediaPackageElement.Type.Attachment) {</span>
<span class="nc" id="L128">        logger.debug(&quot;Only catalog and attachment types are currently supported&quot;);</span>
<span class="nc" id="L129">        continue;</span>
      }

<span class="pc bpc" id="L132" title="2 of 4 branches missed.">      if (mpe.getMimeType() == null || !mpe.getMimeType().eq(MimeTypes.XML)) {</span>
<span class="nc" id="L133">        logger.debug(&quot;Only media package elements with mime type XML are supported&quot;);</span>
<span class="nc" id="L134">        continue;</span>
      }
<span class="fc" id="L136">      String catalogXml = null;</span>
<span class="fc" id="L137">      try (InputStream in = getWorkspace().read(mpe.getURI())) {</span>
<span class="fc" id="L138">        catalogXml = IOUtils.toString(in, &quot;UTF-8&quot;);</span>
<span class="fc" id="L139">      } catch (Throwable e) {</span>
<span class="fc" id="L140">        logger.warn(&quot;Unable to load catalog {} from media package {}&quot;,</span>
<span class="fc" id="L141">                mpe.getIdentifier(), mediaPackage.getIdentifier().toString(), e);</span>
<span class="fc" id="L142">        continue;</span>
<span class="fc" id="L143">      }</span>
<span class="pc bpc" id="L144" title="3 of 6 branches missed.">      if (catalogXml == null || StringUtils.isBlank(catalogXml) || !XmlUtil.parseNs(catalogXml).isRight()) {</span>
<span class="nc" id="L145">        logger.warn(&quot;The catalog {} from media package {} isn't a well formatted XML document&quot;,</span>
<span class="nc" id="L146">                mpe.getIdentifier(), mediaPackage.getIdentifier().toString());</span>
<span class="nc" id="L147">        continue;</span>
      }

<span class="fc" id="L150">      entity.addMediaPackageElement(new OaiPmhElementEntity(</span>
<span class="fc" id="L151">              mpe.getElementType().name(), mpe.getFlavor().toString(), catalogXml));</span>
    }
<span class="fc" id="L153">  }</span>

  @Override
  public void delete(String mediaPackageId, String repository) throws OaiPmhDatabaseException, NotFoundException {
    try {
<span class="fc" id="L158">      dbAccessLock.writeLock().lock();</span>
<span class="fc" id="L159">      deleteInternal(mediaPackageId, repository);</span>
    } finally {
<span class="fc" id="L161">      dbAccessLock.writeLock().unlock();</span>
    }
<span class="fc" id="L163">  }</span>

  private void deleteInternal(String mediaPackageId, String repository) throws OaiPmhDatabaseException, NotFoundException {
    try {
<span class="fc" id="L167">      getDBSession().execTxChecked(em -&gt; {</span>
<span class="fc" id="L168">        OaiPmhEntity oaiPmhEntity = getOaiPmhEntity(mediaPackageId, repository, em);</span>
<span class="fc bfc" id="L169" title="All 2 branches covered.">        if (oaiPmhEntity == null)</span>
<span class="fc" id="L170">          throw new NotFoundException(&quot;No media package with id &quot; + mediaPackageId + &quot; exists&quot;);</span>

<span class="fc" id="L172">        oaiPmhEntity.setDeleted(true);</span>
<span class="fc" id="L173">        em.merge(oaiPmhEntity);</span>
<span class="fc" id="L174">      });</span>
<span class="fc" id="L175">    } catch (NotFoundException e) {</span>
<span class="fc" id="L176">      throw e;</span>
<span class="nc" id="L177">    } catch (Exception e) {</span>
<span class="nc" id="L178">      logger.error(&quot;Could not delete mediapackage '{}' from OAI-PMH repository '{}'&quot;, mediaPackageId, repository, e);</span>
<span class="nc" id="L179">      throw new OaiPmhDatabaseException(e);</span>
<span class="fc" id="L180">    }</span>
<span class="fc" id="L181">  }</span>

  @Override
  public SearchResult search(Query query) {
    try {
<span class="fc" id="L186">      final int chunkSize = query.getLimit().getOrElse(-1);</span>
<span class="fc" id="L187">      dbAccessLock.readLock().lock();</span>
<span class="fc" id="L188">      return searchInternal(query, chunkSize);</span>
    } finally {
<span class="fc" id="L190">      dbAccessLock.readLock().unlock();</span>
    }
  }

  private SearchResult searchInternal(Query query, int chunkSize) {
<span class="fc" id="L195">    final String requestSetSpec = query.getSetSpec().getOrElseNull();</span>
<span class="fc" id="L196">    Date lastDate = new Date();</span>
    long resultSize;
    long resultOffset;
    long resultLimit;
<span class="fc" id="L200">    SearchResult result = getDBSession().exec(em -&gt; {</span>
<span class="fc" id="L201">      CriteriaBuilder cb = em.getCriteriaBuilder();</span>
<span class="fc" id="L202">      CriteriaQuery&lt;OaiPmhEntity&gt; q = cb.createQuery(OaiPmhEntity.class);</span>
<span class="fc" id="L203">      Root&lt;OaiPmhEntity&gt; c = q.from(OaiPmhEntity.class);</span>
<span class="fc" id="L204">      q.select(c);</span>

      // create predicates joined in an &quot;and&quot; expression
<span class="fc" id="L207">      final List&lt;Predicate&gt; predicates = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L208">      predicates.add(cb.equal(c.get(&quot;organization&quot;), getSecurityService().getOrganization().getId()));</span>

<span class="fc bfc" id="L210" title="All 2 branches covered.">      for (String p : query.getMediaPackageId())</span>
<span class="fc" id="L211">        predicates.add(cb.equal(c.get(&quot;mediaPackageId&quot;), p));</span>
<span class="fc bfc" id="L212" title="All 2 branches covered.">      for (String p : query.getRepositoryId())</span>
<span class="fc" id="L213">        predicates.add(cb.equal(c.get(&quot;repositoryId&quot;), p));</span>
<span class="pc bpc" id="L214" title="1 of 2 branches missed.">      for (String p : query.getSeriesId())</span>
<span class="nc" id="L215">        predicates.add(cb.equal(c.get(&quot;series&quot;), p));</span>
<span class="pc bpc" id="L216" title="1 of 2 branches missed.">      for (Boolean p : query.isDeleted())</span>
<span class="nc" id="L217">        predicates.add(cb.equal(c.get(&quot;deleted&quot;), p));</span>
<span class="pc bpc" id="L218" title="1 of 2 branches missed.">      if (query.isSubsequentRequest()) {</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">        for (Date p : query.getModifiedAfter())</span>
<span class="nc" id="L220">          predicates.add(cb.greaterThan(c.get(&quot;modificationDate&quot;).as(Date.class), p));</span>
      } else {
<span class="fc bfc" id="L222" title="All 2 branches covered.">        for (Date p : query.getModifiedAfter())</span>
<span class="fc" id="L223">          predicates.add(cb.greaterThanOrEqualTo(c.get(&quot;modificationDate&quot;).as(Date.class), p));</span>
      }
<span class="fc bfc" id="L225" title="All 2 branches covered.">      for (Date p : query.getModifiedBefore())</span>
<span class="fc" id="L226">        predicates.add(cb.lessThanOrEqualTo(c.get(&quot;modificationDate&quot;).as(Date.class), p));</span>

<span class="fc" id="L228">      q.where(cb.and(predicates.toArray(new Predicate[0])));</span>
<span class="fc" id="L229">      q.orderBy(cb.asc(c.get(&quot;modificationDate&quot;)));</span>

<span class="fc" id="L231">      TypedQuery&lt;OaiPmhEntity&gt; typedQuery = em.createQuery(q);</span>
<span class="fc bfc" id="L232" title="All 2 branches covered.">      if (chunkSize &gt; 0) {</span>
<span class="fc" id="L233">        typedQuery.setMaxResults(chunkSize);</span>
      }
<span class="fc bfc" id="L235" title="All 2 branches covered.">      for (int startPosition : query.getOffset()) {</span>
<span class="fc" id="L236">        logger.warn(&quot;I'm pretty sure things break if this is used&quot;);</span>
<span class="fc" id="L237">        typedQuery.setFirstResult(startPosition);</span>
<span class="fc" id="L238">      }</span>

<span class="fc" id="L240">      return createSearchResult(typedQuery);</span>
    });

<span class="pc bpc" id="L243" title="1 of 2 branches missed.">    if (requestSetSpec == null) {</span>
<span class="fc" id="L244">      return new SearchResultImpl(result.getOffset(), result.getLimit(), result.getItems());</span>
    }

    // If we are here, setSpec request is ongoing
<span class="nc" id="L248">    final List&lt;SearchResultItem&gt; filteredItems = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">    for (SearchResultItem item : result.getItems()) {</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">      for (OaiPmhSetDefinition setDef : query.getSetDefinitions()) {</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">        if (matchSetDef(setDef, item.getElements())) {</span>
<span class="nc" id="L252">          item.addSetSpec(setDef.getSetSpec());</span>
        }
<span class="nc" id="L254">      }</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">      if (item.getSetSpecs().contains(requestSetSpec)) {</span>
<span class="nc" id="L256">        filteredItems.add(item);</span>
      } else {
        // If the setSpec does not match, we should mark this item as deleted for this specific setSpec
<span class="nc" id="L259">        filteredItems.add(new SearchResultItemImpl(item.getId(), item.getMediaPackageXml(), item.getOrganization(),</span>
<span class="nc" id="L260">            item.getRepository(), item.getModificationDate(), true, item.getMediaPackage(),</span>
<span class="nc" id="L261">            item.getElements(), Arrays.asList(requestSetSpec)));</span>
      }

<span class="nc" id="L264">    }</span>
<span class="nc" id="L265">    return new SearchResultImpl(result.getOffset(), result.getLimit(), filteredItems);</span>
  }

  /**
   * Returns true if all set definition filters matches.
   *
   * @param setDef set definition to test
   * @param elements media package elements to test
   * @return returns true if all set definition filters matches, otherwise false
   */
  protected boolean matchSetDef(OaiPmhSetDefinition setDef, List&lt;SearchResultElementItem&gt; elements) {
    // all filters should match
<span class="fc bfc" id="L277" title="All 2 branches covered.">    for (OaiPmhSetDefinitionFilter filter : setDef.getFilters()) {</span>
<span class="fc bfc" id="L278" title="All 2 branches covered.">      if (!matchSetDefFilter(filter, elements)) {</span>
<span class="fc" id="L279">        return false;</span>
      }
<span class="fc" id="L281">    }</span>
<span class="fc" id="L282">    return true;</span>
  }

  /**
   * Returns true if any filter criterion matches
   *
   * @param filter filter to test
   * @param elements media package elements to test filter criteria on
   * @return true if any filter criteria matches, otherwise false
   */
  private boolean matchSetDefFilter(OaiPmhSetDefinitionFilter filter, List&lt;SearchResultElementItem&gt; elements) {
    // At least one filter criterion should match
<span class="fc bfc" id="L294" title="All 2 branches covered.">    for (String criterion : filter.getCriteria().keySet()) {</span>
<span class="pc bpc" id="L295" title="1 of 2 branches missed.">      if (StringUtils.equals(OaiPmhSetDefinitionFilter.CRITERION_CONTAINS, criterion)) {</span>
<span class="fc bfc" id="L296" title="All 2 branches covered.">        for (SearchResultElementItem element : elements) {</span>
<span class="fc bfc" id="L297" title="All 2 branches covered.">          if (!StringUtils.equals(filter.getFlavor(), element.getFlavor())) {</span>
<span class="fc" id="L298">            continue;</span>
          }
<span class="fc bfc" id="L300" title="All 2 branches covered.">          for (String criterionValue : filter.getCriteria().get(criterion)) {</span>
<span class="fc bfc" id="L301" title="All 2 branches covered.">            if (StringUtils.contains(element.getXml(), criterionValue)) {</span>
<span class="fc" id="L302">              return true;</span>
            }
<span class="fc" id="L304">          }</span>
<span class="fc" id="L305">        }</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">      } else if (StringUtils.equals(OaiPmhSetDefinitionFilter.CRITERION_CONTAINSNOT, criterion)) {</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">        for (SearchResultElementItem element : elements) {</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">          if (!StringUtils.equals(filter.getFlavor(), element.getFlavor())) {</span>
<span class="nc" id="L309">            continue;</span>
          }
<span class="nc bnc" id="L311" title="All 2 branches missed.">          for (String criterionValue : filter.getCriteria().get(criterion)) {</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">            if (!StringUtils.contains(element.getXml(), criterionValue)) {</span>
<span class="nc" id="L313">              return true;</span>
            }
<span class="nc" id="L315">          }</span>
<span class="nc" id="L316">        }</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">      } else if (StringUtils.equals(OaiPmhSetDefinitionFilter.CRITERION_MATCH, criterion)) {</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">        for (String criterionValue : filter.getCriteria().get(criterion)) {</span>
<span class="nc" id="L319">          Pattern matchPattern = null; // wait with initialization until we found an element to test</span>
<span class="nc bnc" id="L320" title="All 2 branches missed.">          for (SearchResultElementItem element : elements) {</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">            if (!StringUtils.equals(filter.getFlavor(), element.getFlavor())) {</span>
<span class="nc" id="L322">              continue;</span>
            }
            // initialize regex pattern once and only if we need it (for performance reasons)
<span class="nc bnc" id="L325" title="All 2 branches missed.">            if (matchPattern == null) {</span>
<span class="nc" id="L326">              matchPattern = Pattern.compile(criterionValue);</span>
            }
<span class="nc bnc" id="L328" title="All 2 branches missed.">            if (matchPattern.matcher(element.getXml()).find()) {</span>
<span class="nc" id="L329">              return true;</span>
            }
<span class="nc" id="L331">          }</span>
<span class="nc" id="L332">        }</span>
      } else {
<span class="nc" id="L334">        logger.warn(&quot;Unknown OAI-PMH set filter criterion '{}'. Ignore it.&quot;, criterion);</span>
      }
<span class="fc" id="L336">    }</span>
<span class="fc" id="L337">    return false;</span>
  }

  /**
   * Gets a OAI-PMH entity by it's id, using the current organizational context.
   *
   * @param id
   *          the media package identifier
   * @param repository
   *          the OAI-PMH repository
   * @param em
   *          an open entity manager
   * @return the OAI-PMH entity, or null if not found
   */
  private OaiPmhEntity getOaiPmhEntity(String id, String repository, EntityManager em) {
<span class="fc" id="L352">    final String orgId = getSecurityService().getOrganization().getId();</span>
<span class="fc" id="L353">    javax.persistence.Query q = em.createNamedQuery(&quot;OaiPmh.findById&quot;).setParameter(&quot;mediaPackageId&quot;, id)</span>
<span class="fc" id="L354">            .setParameter(&quot;repository&quot;, repository).setParameter(&quot;organization&quot;, orgId);</span>
    try {
<span class="fc" id="L356">      return (OaiPmhEntity) q.getSingleResult();</span>
<span class="fc" id="L357">    } catch (NoResultException e) {</span>
<span class="fc" id="L358">      return null;</span>
    }
  }

  /**
   * Creates a search result from a given JPA query
   *
   * @param query
   *          the query
   * @return The search result.
   */
  private SearchResult createSearchResult(TypedQuery&lt;OaiPmhEntity&gt; query) {
    // Create and configure the query result
<span class="fc" id="L371">    final long offset = query.getFirstResult();</span>
<span class="fc bfc" id="L372" title="All 2 branches covered.">    final long limit = query.getMaxResults() != Integer.MAX_VALUE ? query.getMaxResults() : 0;</span>
<span class="fc" id="L373">    final List&lt;SearchResultItem&gt; items = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L374" title="All 2 branches covered.">    for (OaiPmhEntity oaipmhEntity : query.getResultList()) {</span>
      try {
<span class="fc" id="L376">        items.add(new SearchResultItemImpl(oaipmhEntity));</span>
<span class="nc" id="L377">      } catch (Exception ex) {</span>
<span class="nc" id="L378">        logger.warn(&quot;Unable to parse an OAI-PMH database entry&quot;, ex);</span>
<span class="fc" id="L379">      }</span>
<span class="fc" id="L380">    }</span>
<span class="fc" id="L381">    return new SearchResultImpl(offset, limit, items);</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>