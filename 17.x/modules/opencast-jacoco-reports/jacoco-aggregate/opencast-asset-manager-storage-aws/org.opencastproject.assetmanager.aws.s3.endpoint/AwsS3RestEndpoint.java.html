<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>AwsS3RestEndpoint.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-asset-manager-storage-aws</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.assetmanager.aws.s3.endpoint</a> &gt; <span class="el_source">AwsS3RestEndpoint.java</span></div><h1>AwsS3RestEndpoint.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.assetmanager.aws.s3.endpoint;

import static org.opencastproject.util.RestUtil.R.noContent;
import static org.opencastproject.util.RestUtil.R.notFound;
import static org.opencastproject.util.RestUtil.R.ok;
import static org.opencastproject.util.RestUtil.R.serverError;

import org.opencastproject.assetmanager.api.AssetManager;
import org.opencastproject.assetmanager.api.AssetManagerException;
import org.opencastproject.assetmanager.api.query.AQueryBuilder;
import org.opencastproject.assetmanager.api.query.ARecord;
import org.opencastproject.assetmanager.api.query.AResult;
import org.opencastproject.assetmanager.api.query.ASelectQuery;
import org.opencastproject.assetmanager.api.storage.AssetStoreException;
import org.opencastproject.assetmanager.api.storage.StoragePath;
import org.opencastproject.assetmanager.aws.s3.AwsS3AssetStore;
import org.opencastproject.mediapackage.MediaPackageElement;
import org.opencastproject.security.api.SecurityService;
import org.opencastproject.util.NotFoundException;
import org.opencastproject.util.data.Function0;
import org.opencastproject.util.doc.rest.RestParameter;
import org.opencastproject.util.doc.rest.RestQuery;
import org.opencastproject.util.doc.rest.RestResponse;
import org.opencastproject.util.doc.rest.RestService;

import com.amazonaws.services.s3.model.StorageClass;

import org.apache.commons.lang3.StringUtils;
import org.osgi.service.component.annotations.Component;
import org.osgi.service.component.annotations.Reference;
import org.osgi.service.jaxrs.whiteboard.propertytypes.JaxrsResource;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import javax.servlet.http.HttpServletResponse;
import javax.ws.rs.BadRequestException;
import javax.ws.rs.FormParam;
import javax.ws.rs.GET;
import javax.ws.rs.PUT;
import javax.ws.rs.Path;
import javax.ws.rs.PathParam;
import javax.ws.rs.Produces;
import javax.ws.rs.WebApplicationException;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;

@Path(&quot;/assets/aws/s3&quot;)
@RestService(name = &quot;archive-aws-s3&quot;, title = &quot;AWS S3 Archive&quot;,
    notes = {
        &quot;All paths are relative to the REST endpoint base (something like http://your.server/files)&quot;,
        &quot;If you notice that this service is not working as expected, there might be a bug! &quot;
            + &quot;You should file an error report with your server logs from the time when the error occurred: &quot;
            + &quot;&lt;a href=\&quot;http://opencast.jira.com\&quot;&gt;Opencast Issue Tracker&lt;/a&gt;&quot;
    },
    abstractText = &quot;This service handles AWS S3 archived assets&quot;)
@Component(
    immediate = true,
    service = AwsS3RestEndpoint.class,
    property = {
        &quot;service.description=AssetManager S3 REST Endpoint&quot;,
        &quot;opencast.service.type=org.opencastproject.assetmanager.aws-s3&quot;,
        &quot;opencast.service.path=/assets/aws/s3&quot;,
    }
)
@JaxrsResource
<span class="nc" id="L87">public class AwsS3RestEndpoint {</span>

<span class="nc" id="L89">  private static final Logger logger = LoggerFactory.getLogger(AwsS3RestEndpoint.class);</span>

<span class="nc" id="L91">  private AwsS3AssetStore awsS3AssetStore = null;</span>
<span class="nc" id="L92">  private AssetManager assetManager = null;</span>
<span class="nc" id="L93">  private SecurityService securityService = null;</span>

  @GET
  @Path(&quot;{mediaPackageId}/assets/storageClass&quot;)
  @Produces(MediaType.TEXT_PLAIN)
  @RestQuery(name = &quot;getStorageClass&quot;,
      description = &quot;Get the S3 Storage Class for each asset in the Media Package&quot;,
      pathParameters = {
          @RestParameter(
              name = &quot;mediaPackageId&quot;, isRequired = true,
              type = RestParameter.Type.STRING,
              description = &quot;The media package indentifier.&quot;)},
      responses = {
          @RestResponse(
              description = &quot;mediapackage found in S3&quot;,
              responseCode = HttpServletResponse.SC_OK),
          @RestResponse(
              description = &quot;mediapackage not found or has no assets in S3&quot;,
              responseCode = HttpServletResponse.SC_NOT_FOUND)
      },
      returnDescription = &quot;List each assets's Object Key and S3 Storage Class&quot;)
  public Response getStorageClass(@PathParam(&quot;mediaPackageId&quot;) final String mediaPackageId) {
<span class="nc" id="L115">    return handleException(new Function0&lt;Response&gt;() {</span>
      private String getMediaPackageId() {
<span class="nc" id="L117">        return StringUtils.trimToNull(mediaPackageId);</span>
      }

      @Override public Response apply() {
<span class="nc" id="L121">        AQueryBuilder q = assetManager.createQuery();</span>
<span class="nc" id="L122">        final ASelectQuery idQuery = q.select(q.snapshot())</span>
<span class="nc" id="L123">            .where(</span>
<span class="nc" id="L124">                q.organizationId(securityService.getOrganization().getId())</span>
<span class="nc" id="L125">                    .and(q.mediaPackageId(getMediaPackageId()))</span>
<span class="nc" id="L126">                    .and(q.version().isLatest()));</span>
<span class="nc" id="L127">        final AResult result = idQuery.run();</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">        if (result.getSize() &gt; 1) {</span>
<span class="nc" id="L129">          return serverError();</span>
        }
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if (result.getSize() == 0) {</span>
<span class="nc" id="L132">          return notFound();</span>
        }
<span class="nc" id="L134">        final ARecord item = result.getRecords().stream().findFirst().get();</span>

<span class="nc" id="L136">        StringBuilder info = new StringBuilder();</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">        for (MediaPackageElement e : assetManager.getMediaPackage(item.getMediaPackageId()).get().elements()) {</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">          if (e.getElementType() == MediaPackageElement.Type.Publication) {</span>
<span class="nc" id="L139">            continue;</span>
          }

<span class="nc" id="L142">          StoragePath storagePath = new StoragePath(securityService.getOrganization().getId(),</span>
<span class="nc" id="L143">              getMediaPackageId(),</span>
<span class="nc" id="L144">              item.getSnapshot().get().getVersion(),</span>
<span class="nc" id="L145">              e.getIdentifier());</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">          if (awsS3AssetStore.contains(storagePath)) {</span>
            try {
<span class="nc" id="L148">              info.append(String.format(&quot;%s,%s\n&quot;, awsS3AssetStore.getAssetObjectKey(storagePath),</span>
<span class="nc" id="L149">                                                   awsS3AssetStore.getAssetStorageClass(storagePath)));</span>
<span class="nc" id="L150">            } catch (AssetStoreException ex) {</span>
<span class="nc" id="L151">              throw new AssetManagerException(ex);</span>
<span class="nc" id="L152">            }</span>
          } else {
<span class="nc" id="L154">            info.append(String.format(&quot;%s,NONE\n&quot;, e.getURI()));</span>
          }
<span class="nc" id="L156">        }</span>
<span class="nc" id="L157">        return ok(info.toString());</span>
      }

    });
  }

  @PUT
  @Path(&quot;{mediaPackageId}/assets&quot;)
  @Produces(MediaType.TEXT_PLAIN)
  @RestQuery(name = &quot;modifyStorageClass&quot;,
      description = &quot;Move the Media Package assets to the specified S3 Storage Class if possible&quot;,
      pathParameters = {
          @RestParameter(
              name = &quot;mediaPackageId&quot;,
              isRequired = true,
              type = RestParameter.Type.STRING,
              description = &quot;The media package indentifier.&quot;)
      },
      restParameters = {
          @RestParameter(
              name = &quot;storageClass&quot;,
              isRequired = true,
              type = RestParameter.Type.STRING,
              description = &quot;The S3 storage class, valid terms STANDARD, STANDARD_IA, INTELLIGENT_TIERING, ONEZONE_IA,&quot;
                          + &quot;GLACIER_IR, GLACIER, and DEEP_ARCHIVE. See https://aws.amazon.com/s3/storage-classes/&quot;)
      },
      responses = {
          @RestResponse(
              description = &quot;mediapackage found in S3&quot;,
              responseCode = HttpServletResponse.SC_OK),
          @RestResponse(
              description = &quot;mediapackage not found or has no assets in S3&quot;,
              responseCode = HttpServletResponse.SC_NOT_FOUND)      },
      returnDescription = &quot;List each asset's Object Key and new S3 Storage Class&quot;)
  public Response modifyStorageClass(@PathParam(&quot;mediaPackageId&quot;) final String mediaPackageId,
                                     @FormParam(&quot;storageClass&quot;) final String storageClass) {
<span class="nc" id="L193">    return handleException(new Function0&lt;Response&gt;() {</span>
      private String getMediaPackageId() {
<span class="nc" id="L195">        return StringUtils.trimToNull(mediaPackageId);</span>
      }

      private String getStorageClass() {
<span class="nc" id="L199">        return StringUtils.trimToNull(storageClass);</span>
      }

      @Override public Response apply() {
<span class="nc" id="L203">        AQueryBuilder q = assetManager.createQuery();</span>
<span class="nc" id="L204">        final ASelectQuery idQuery = q.select(q.snapshot())</span>
<span class="nc" id="L205">            .where(</span>
<span class="nc" id="L206">                q.organizationId(securityService.getOrganization().getId())</span>
<span class="nc" id="L207">                    .and(q.mediaPackageId(getMediaPackageId()))</span>
<span class="nc" id="L208">                    .and(q.version().isLatest()));</span>
<span class="nc" id="L209">        final AResult result = idQuery.run();</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">        if (result.getSize() &gt; 1) {</span>
<span class="nc" id="L211">          return serverError();</span>
        }
<span class="nc bnc" id="L213" title="All 2 branches missed.">        if (result.getSize() == 0) {</span>
<span class="nc" id="L214">          return notFound();</span>
        }
<span class="nc" id="L216">        final ARecord item = result.getRecords().stream().findFirst().get();</span>

<span class="nc" id="L218">        StringBuilder info = new StringBuilder();</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">        for (MediaPackageElement e : assetManager.getMediaPackage(item.getMediaPackageId()).get().elements()) {</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">          if (e.getElementType() == MediaPackageElement.Type.Publication) {</span>
<span class="nc" id="L221">            continue;</span>
          }

<span class="nc" id="L224">          StoragePath storagePath = new StoragePath(securityService.getOrganization().getId(),</span>
<span class="nc" id="L225">              getMediaPackageId(),</span>
<span class="nc" id="L226">              item.getSnapshot().get().getVersion(),</span>
<span class="nc" id="L227">              e.getIdentifier());</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">          if (awsS3AssetStore.contains(storagePath)) {</span>
            try {
<span class="nc" id="L230">              info.append(String.format(&quot;%s,%s\n&quot;, awsS3AssetStore.getAssetObjectKey(storagePath),</span>
<span class="nc" id="L231">                                                   awsS3AssetStore.modifyAssetStorageClass(storagePath,</span>
<span class="nc" id="L232">                                                   getStorageClass())));</span>
<span class="nc" id="L233">            } catch (AssetStoreException ex) {</span>
<span class="nc" id="L234">              throw new AssetManagerException(ex);</span>
<span class="nc" id="L235">            }</span>
          } else {
<span class="nc" id="L237">            info.append(String.format(&quot;%s,NONE\n&quot;, e.getURI()));</span>
          }
<span class="nc" id="L239">        }</span>
<span class="nc" id="L240">        return ok(info.toString());</span>
      }

    });
  }

  @GET
  @Path(&quot;glacier/{mediaPackageId}/assets&quot;)
  @Produces(MediaType.TEXT_PLAIN)
  @RestQuery(name = &quot;restoreAssetsStatus&quot;,
      description = &quot;Get the mediapackage asset's restored status&quot;,
      pathParameters = {
          @RestParameter(
              name = &quot;mediaPackageId&quot;,
              isRequired = true,
              type = RestParameter.Type.STRING,
              description = &quot;The media package indentifier.&quot;)
      },
      responses = {
          @RestResponse(
              description = &quot;mediapackage found in S3 and assets in Glacier&quot;,
              responseCode = HttpServletResponse.SC_OK),
          @RestResponse(
              description = &quot;mediapackage found in S3 but no assets in Glacier&quot;,
              responseCode = HttpServletResponse.SC_NO_CONTENT),
          @RestResponse(
              description = &quot;mediapackage not found or has no assets in S3&quot;,
              responseCode = HttpServletResponse.SC_NOT_FOUND)
      },
      returnDescription = &quot;List each glacier asset's restoration status and expiration date&quot;)
  public Response getAssetRestoreState(@PathParam(&quot;mediaPackageId&quot;) final String mediaPackageId) {
<span class="nc" id="L271">    return handleException(new Function0&lt;Response&gt;() {</span>
      private String getMediaPackageId() {
<span class="nc" id="L273">        return StringUtils.trimToNull(mediaPackageId);</span>
      }

      @Override public Response apply() {
<span class="nc" id="L277">        AQueryBuilder q = assetManager.createQuery();</span>
<span class="nc" id="L278">        final ASelectQuery idQuery = q.select(q.snapshot())</span>
<span class="nc" id="L279">            .where(</span>
<span class="nc" id="L280">                q.organizationId(securityService.getOrganization().getId())</span>
<span class="nc" id="L281">                    .and(q.mediaPackageId(getMediaPackageId()))</span>
<span class="nc" id="L282">                    .and(q.version().isLatest()));</span>
<span class="nc" id="L283">        final AResult result = idQuery.run();</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">        if (result.getSize() &gt; 1) {</span>
<span class="nc" id="L285">          return serverError();</span>
        }
<span class="nc bnc" id="L287" title="All 2 branches missed.">        if (result.getSize() == 0) {</span>
<span class="nc" id="L288">          return notFound();</span>
        }
<span class="nc" id="L290">        final ARecord item = result.getRecords().stream().findFirst().get();</span>

<span class="nc" id="L292">        StringBuilder info = new StringBuilder();</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">        for (MediaPackageElement e : assetManager.getMediaPackage(item.getMediaPackageId()).get().elements()) {</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">          if (e.getElementType() == MediaPackageElement.Type.Publication) {</span>
<span class="nc" id="L295">            continue;</span>
          }

<span class="nc" id="L298">          StoragePath storagePath = new StoragePath(securityService.getOrganization().getId(),</span>
<span class="nc" id="L299">                                                    getMediaPackageId(),</span>
<span class="nc" id="L300">                                                    item.getSnapshot().get().getVersion(),</span>
<span class="nc" id="L301">                                                    e.getIdentifier());</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">          if (isFrozen(storagePath)) {</span>
            try {
<span class="nc" id="L304">              info.append(String.format(&quot;%s,%s\n&quot;, awsS3AssetStore.getAssetObjectKey(storagePath),</span>
<span class="nc" id="L305">                                                   awsS3AssetStore.getAssetRestoreStatusString(storagePath)));</span>
<span class="nc" id="L306">            } catch (AssetStoreException ex) {</span>
<span class="nc" id="L307">              throw new AssetManagerException(ex);</span>
<span class="nc" id="L308">            }</span>
          } else {
<span class="nc" id="L310">            info.append(String.format(&quot;%s,NONE\n&quot;, storagePath));</span>
          }
<span class="nc" id="L312">        }</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">        if (info.length() == 0) {</span>
<span class="nc" id="L314">          return noContent();</span>
        }
<span class="nc" id="L316">        return ok(info.toString());</span>
      }
    });
  }

  @PUT
  @Path(&quot;glacier/{mediaPackageId}/assets&quot;)
  @Produces(MediaType.TEXT_PLAIN)
  @RestQuery(name = &quot;restoreAssets&quot;,
      description = &quot;Initiate the restore of any assets in Glacier storage class&quot;,
      pathParameters = {
          @RestParameter(
              name = &quot;mediaPackageId&quot;,
              isRequired = true,
              type = RestParameter.Type.STRING,
              description = &quot;The media package indentifier.&quot;)
      },
      restParameters = {
          @RestParameter(
              name = &quot;restorePeriod&quot;,
              isRequired = false,
              type = RestParameter.Type.INTEGER,
              defaultValue = &quot;2&quot;,
              description = &quot;Number of days to restore the assets for, default see service configuration&quot;)
      },
      responses = {
          @RestResponse(
              description = &quot;restore of assets started&quot;,
              responseCode = HttpServletResponse.SC_NO_CONTENT),
          @RestResponse(
              description = &quot;invalid restore period, must be greater than zero&quot;,
              responseCode = HttpServletResponse.SC_BAD_REQUEST),
          @RestResponse(
              description = &quot;mediapackage not found or has no assets in S3&quot;,
              responseCode = HttpServletResponse.SC_NOT_FOUND)
      },
      returnDescription = &quot;Restore of assets initiated&quot;)
  public Response restoreAssets(@PathParam(&quot;mediaPackageId&quot;) final String mediaPackageId,
                                @FormParam(&quot;restorePeriod&quot;) final Integer restorePeriod) {
<span class="nc" id="L355">    return handleException(new Function0&lt;Response&gt;() {</span>
      private String getMediaPackageId() {
<span class="nc" id="L357">        return StringUtils.trimToNull(mediaPackageId);</span>
      }

      private Integer getRestorePeriod() {
<span class="nc bnc" id="L361" title="All 2 branches missed.">        return restorePeriod != null ? restorePeriod : awsS3AssetStore.getRestorePeriod();</span>
      }

      @Override public Response apply() {
<span class="nc" id="L365">        Integer restorePeriod = getRestorePeriod();</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">        if (restorePeriod &lt; 1) {</span>
<span class="nc" id="L367">          throw new BadRequestException(&quot;Restore period must be greater than zero!&quot;);</span>
        }

<span class="nc" id="L370">        AQueryBuilder q = assetManager.createQuery();</span>
<span class="nc" id="L371">        final ASelectQuery idQuery = q.select(q.snapshot())</span>
<span class="nc" id="L372">            .where(</span>
<span class="nc" id="L373">                q.organizationId(securityService.getOrganization().getId())</span>
<span class="nc" id="L374">                    .and(q.mediaPackageId(getMediaPackageId()))</span>
<span class="nc" id="L375">                    .and(q.version().isLatest()));</span>
<span class="nc" id="L376">        final AResult result = idQuery.run();</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">        if (result.getSize() &gt; 1) {</span>
<span class="nc" id="L378">          return serverError();</span>
        }
<span class="nc bnc" id="L380" title="All 2 branches missed.">        if (result.getSize() == 0) {</span>
<span class="nc" id="L381">          return notFound();</span>
        }
<span class="nc" id="L383">        final ARecord item = result.getRecords().stream().findFirst().get();</span>


<span class="nc bnc" id="L386" title="All 2 branches missed.">        for (MediaPackageElement e : assetManager.getMediaPackage(item.getMediaPackageId()).get().elements()) {</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">          if (e.getElementType() == MediaPackageElement.Type.Publication) {</span>
<span class="nc" id="L388">            continue;</span>
          }

<span class="nc" id="L391">          StoragePath storagePath = new StoragePath(securityService.getOrganization().getId(),</span>
<span class="nc" id="L392">                                                    getMediaPackageId(),</span>
<span class="nc" id="L393">                                                    item.getSnapshot().get().getVersion(),</span>
<span class="nc" id="L394">                                                    e.getIdentifier());</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">          if (isFrozen(storagePath)) {</span>
            try {
              // Initiate restore and return
<span class="nc" id="L398">              awsS3AssetStore.initiateRestoreAsset(storagePath, getRestorePeriod());</span>
<span class="nc" id="L399">            } catch (AssetStoreException ex) {</span>
<span class="nc" id="L400">              throw new AssetManagerException(ex);</span>
<span class="nc" id="L401">            }</span>
          }
<span class="nc" id="L403">        }</span>
<span class="nc" id="L404">        return noContent();</span>
      }
    });
  }

  private boolean isFrozen(StoragePath storagePath) {
<span class="nc" id="L410">    String assetStorageClass = awsS3AssetStore.getAssetStorageClass(storagePath);</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">    return awsS3AssetStore.contains(storagePath)</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">        &amp;&amp; (StorageClass.Glacier == StorageClass.fromValue(assetStorageClass)</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">          || StorageClass.DeepArchive == StorageClass.fromValue(assetStorageClass));</span>
  }


  /** Unify exception handling. */
  public static &lt;A&gt; A handleException(final Function0&lt;A&gt; f) {
    try {
<span class="nc" id="L420">      return f.apply();</span>
<span class="nc" id="L421">    } catch (AssetManagerException e) {</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">      if (e.isCauseNotAuthorized()) {</span>
<span class="nc" id="L423">        throw new WebApplicationException(e, Response.Status.UNAUTHORIZED);</span>
      }
<span class="nc bnc" id="L425" title="All 2 branches missed.">      if (e.isCauseNotFound()) {</span>
<span class="nc" id="L426">        throw new WebApplicationException(e, Response.Status.NOT_FOUND);</span>
      }
<span class="nc" id="L428">      throw new WebApplicationException(e, Response.Status.INTERNAL_SERVER_ERROR);</span>
<span class="nc" id="L429">    } catch (Exception e) {</span>
<span class="nc" id="L430">      logger.error(&quot;Error calling archive REST method&quot;, e);</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">      if (e instanceof NotFoundException) {</span>
<span class="nc" id="L432">        throw new WebApplicationException(e, Response.Status.NOT_FOUND);</span>
      }
<span class="nc" id="L434">      throw new WebApplicationException(e, Response.Status.INTERNAL_SERVER_ERROR);</span>
    }
  }

  @Reference()
  void setAwsS3AssetStore(AwsS3AssetStore store) {
<span class="nc" id="L440">    awsS3AssetStore = store;</span>
<span class="nc" id="L441">  }</span>

  @Reference()
  void setAssetManager(AssetManager service) {
<span class="nc" id="L445">    assetManager = service;</span>
<span class="nc" id="L446">  }</span>

  @Reference()
  void setSecurityService(SecurityService service) {
<span class="nc" id="L450">    securityService = service;</span>
<span class="nc" id="L451">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>