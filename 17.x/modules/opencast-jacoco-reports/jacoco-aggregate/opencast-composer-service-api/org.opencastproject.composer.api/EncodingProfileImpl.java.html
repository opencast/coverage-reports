<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>EncodingProfileImpl.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-composer-service-api</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.composer.api</a> &gt; <span class="el_source">EncodingProfileImpl.java</span></div><h1>EncodingProfileImpl.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */


package org.opencastproject.composer.api;

import org.opencastproject.util.EqualsUtil;

import org.apache.commons.lang3.StringUtils;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;

import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.bind.annotation.XmlAttribute;
import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlElementWrapper;
import javax.xml.bind.annotation.XmlID;
import javax.xml.bind.annotation.XmlRootElement;
import javax.xml.bind.annotation.XmlTransient;
import javax.xml.bind.annotation.XmlType;
import javax.xml.bind.annotation.XmlValue;

/**
 * Default implementation for encoding profiles.
 */
@XmlAccessorType(XmlAccessType.FIELD)
@XmlType(name = &quot;profile&quot;, namespace = &quot;http://composer.opencastproject.org&quot;)
@XmlRootElement(name = &quot;profile&quot;, namespace = &quot;http://composer.opencastproject.org&quot;)
public class EncodingProfileImpl implements EncodingProfile {

  /** The profile identifier */
<span class="fc" id="L55">  @XmlAttribute(name = &quot;id&quot;)</span>
  @XmlID
  protected String identifier = null;

  /** Format description */
<span class="fc" id="L60">  @XmlElement(name = &quot;name&quot;)</span>
  protected String name = null;

  @XmlTransient
  protected Object source;

  /** Format type */
<span class="fc" id="L67">  @XmlElement(name = &quot;outputmediatype&quot;)</span>
  protected MediaType outputType = null;

  /** Suffix
  @XmlElement(name = &quot;suffix&quot;)
  protected String suffix = null;
  */

  /** Mime type */
<span class="fc" id="L76">  @XmlElement(name = &quot;mimetype&quot;)</span>
  protected String mimeType = null;

  /** The track type that this profile may be applied to */
<span class="fc" id="L80">  @XmlElement(name = &quot;inputmediatype&quot;)</span>
  protected MediaType applicableType = null;

  /** Installation-specific properties */
<span class="fc" id="L84">  @XmlElement(name = &quot;extension&quot;)</span>
  @XmlElementWrapper(name = &quot;extensions&quot;)
  protected List&lt;Extension&gt; extensions = new ArrayList&lt;Extension&gt;();

<span class="fc" id="L88">  @XmlElementWrapper(name = &quot;suffixes&quot;)</span>
  protected HashMap&lt;String,String&gt; suffixes = new HashMap&lt;String, String&gt;();

<span class="fc" id="L91">  @XmlElement(name = &quot;jobLoad&quot;)</span>
<span class="fc" id="L92">  protected Float jobLoad = 1.5f;</span>

  /**
   * Private, since the profile should be created using the static factory method.
   *
   * @param identifier
   *          the profile identifier
   * @param name
   *          the profile name
   */
<span class="fc" id="L102">  public EncodingProfileImpl(String identifier, String name, Object source) {</span>
<span class="fc" id="L103">    this.identifier = identifier;</span>
<span class="fc" id="L104">    this.name = name;</span>
<span class="fc" id="L105">    this.source = source;</span>
<span class="fc" id="L106">  }</span>

  // Needed by JAXB
<span class="fc" id="L109">  public EncodingProfileImpl() {</span>
<span class="fc" id="L110">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.composer.api.EncodingProfile#getIdentifier()
   */
  @Override
  public String getIdentifier() {
<span class="fc" id="L119">    return identifier;</span>
  }

  /**
   * Sets the identifier
   *
   * @param id
   *          the identifier
   */
  public void setIdentifier(String id) {
<span class="fc" id="L129">    identifier = id;</span>
<span class="fc" id="L130">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.composer.api.EncodingProfile#getName()
   */
  @Override
  public String getName() {
<span class="fc" id="L139">    return name;</span>
  }

  /**
   * Sets the profile name
   *
   * @param name
   *          the profile name
   */
  public void setName(String name) {
<span class="nc" id="L149">    this.name = name;</span>
<span class="nc" id="L150">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.composer.api.EncodingProfile#getSource()
   */
  @Override
  public Object getSource() {
<span class="fc" id="L159">    return source;</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.composer.api.EncodingProfile#getOutputType()
   */
  @Override
  public MediaType getOutputType() {
<span class="fc" id="L169">    return outputType;</span>
  }

  /**
   * Sets the output type.
   *
   * @param type
   *          the output type
   */
  public void setOutputType(MediaType type) {
<span class="fc" id="L179">    this.outputType = type;</span>
<span class="fc" id="L180">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.composer.api.EncodingProfile#getSuffix()
   */
  @Override
  public String getSuffix() {
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">    if (suffixes.keySet().size() == 0) return null;</span>
<span class="fc bfc" id="L190" title="All 2 branches covered.">    if (suffixes.containsKey(&quot;default&quot;)) {</span>
<span class="fc" id="L191">      return suffixes.get(&quot;default&quot;);</span>
    } else {
<span class="fc" id="L193">      return suffixes.get(suffixes.values().toArray()[0]);</span>
    }
  }

  /**
   * Sets the suffix for encoded file names.
   *
   * @param suffix
   *          the file suffix
   */
  public void setSuffix(String suffix) {
<span class="fc" id="L204">    setSuffix(&quot;default&quot;, suffix);</span>
<span class="fc" id="L205">  }</span>

  /**
   * Sets the suffix for encoded file names.
   *
   * @param suffix
   *          the file suffix
   */
  public void setSuffix(String tag ,String suffix) {
<span class="fc" id="L214">    this.suffixes.put(tag, suffix);</span>
<span class="fc" id="L215">  }</span>

  /**
   * Return the mimetype as string
   */
  @Override
  public String getMimeType() {
<span class="nc" id="L222">    return mimeType;</span>
  }

  /**
   * sets the mimetype of the output if applicable
   * @param mimeType
   * 
   */
  @Override
  public void setMimeType(String mimeType) {
<span class="nc" id="L232">    this.mimeType = mimeType;</span>
<span class="nc" id="L233">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.composer.api.EncodingProfile#getApplicableMediaType()
   */
  @Override
  public MediaType getApplicableMediaType() {
<span class="fc" id="L242">    return applicableType;</span>
  }

  /**
   * Sets the applicable type.
   *
   * @param applicableType
   *          the applicableType to set
   */
  public void setApplicableType(MediaType applicableType) {
<span class="fc" id="L252">    this.applicableType = applicableType;</span>
<span class="fc" id="L253">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.composer.api.EncodingProfile#isApplicableTo(org.opencastproject.composer.api.EncodingProfile.MediaType)
   */
  @Override
  public boolean isApplicableTo(MediaType type) {
<span class="pc bpc" id="L262" title="1 of 2 branches missed.">    if (type == null)</span>
<span class="nc" id="L263">      throw new IllegalArgumentException(&quot;Type must not be null&quot;);</span>
<span class="fc" id="L264">    return type.equals(applicableType);</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.composer.api.EncodingProfile#getExtension(java.lang.String)
   */
  @Override
  public String getExtension(String key) {
<span class="fc" id="L274">    return getExtensions().get(key);</span>
  }

  /**
   * Adds the given key-value pair to the extended configuration space of this media profile.
   *
   * @param key
   *          the property key
   * @param value
   *          the property value
   */
  public void addExtension(String key, String value) {
<span class="pc bpc" id="L286" title="1 of 2 branches missed.">    if (StringUtils.isBlank(key))</span>
<span class="nc" id="L287">      throw new IllegalArgumentException(&quot;Argument 'key' must not be null&quot;);</span>
<span class="pc bpc" id="L288" title="1 of 2 branches missed.">    if (value == null)</span>
<span class="nc" id="L289">      throw new IllegalArgumentException(&quot;Argument 'value' must not be null&quot;);</span>
<span class="fc" id="L290">    removeExtension(key);</span>
<span class="fc" id="L291">    extensions.add(new Extension(key, value));</span>
<span class="fc" id="L292">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.composer.api.EncodingProfile#getExtensions()
   */
  @Override
  public Map&lt;String, String&gt; getExtensions() {
<span class="fc" id="L301">    Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();</span>
<span class="fc bfc" id="L302" title="All 2 branches covered.">    for (Extension extension : extensions) {</span>
<span class="fc" id="L303">      map.put(extension.getKey(), extension.getValue());</span>
<span class="fc" id="L304">    }</span>
<span class="fc" id="L305">    return map;</span>
  }

  /**
   * Sets the extension properties for that profile. These properties may be intepreted by the encoder engine.
   *
   * @param extension
   *          the extension properties
   */
  public void setExtensions(Map&lt;String, String&gt; extension) {
<span class="nc" id="L315">    extensions.clear();</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">    for (Entry&lt;String, String&gt; entry : extension.entrySet()) {</span>
<span class="nc" id="L317">      extensions.add(new Extension(entry));</span>
<span class="nc" id="L318">    }</span>
<span class="nc" id="L319">  }</span>

  /**
   * Removes the specified property from the extended configuation space and returns either the property value or
   * &lt;code&gt;null&lt;/code&gt; if no property was found.
   *
   * @param key
   *          the property key
   * @return the property value or &lt;code&gt;null&lt;/code&gt;
   */
  public String removeExtension(String key) {
<span class="fc" id="L330">    int index = -1;</span>
<span class="fc bfc" id="L331" title="All 2 branches covered.">    for (int i = 0; i &lt; extensions.size(); i++) {</span>
<span class="pc bpc" id="L332" title="1 of 2 branches missed.">      if (extensions.get(i).getKey().equals(key)) {</span>
<span class="nc" id="L333">        index = i;</span>
<span class="nc" id="L334">        break;</span>
      }
    }
<span class="pc bpc" id="L337" title="1 of 2 branches missed.">    if (index == -1)</span>
<span class="fc" id="L338">      return null;</span>
<span class="nc" id="L339">    return extensions.remove(index).getValue();</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.composer.api.EncodingProfile#hasExtensions()
   */
  @Override
  public boolean hasExtensions() {
<span class="pc bpc" id="L349" title="1 of 4 branches missed.">    return extensions != null &amp;&amp; extensions.size() &gt; 0;</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.composer.api.EncodingProfile#getJobLoad()
   */
  @Override
  public float getJobLoad() {
<span class="fc" id="L359">    return jobLoad;</span>
  }

  /**
   * Sets the job load for this encoding profile
   *
   * @param jobLoad the load caused by one instance of this encoding profile running
   */
  public void setJobLoad(Float jobLoad) {
<span class="fc" id="L368">    this.jobLoad = jobLoad;</span>
<span class="fc" id="L369">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see java.lang.Object#hashCode()
   */
  @Override
  public int hashCode() {
<span class="nc" id="L378">    return identifier.hashCode();</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see java.lang.Object#equals(java.lang.Object)
   */
  @Override
  public boolean equals(Object obj) {
<span class="pc bpc" id="L388" title="1 of 2 branches missed.">    if (obj instanceof EncodingProfile) {</span>
<span class="fc" id="L389">      EncodingProfile mf = (EncodingProfile) obj;</span>
<span class="fc" id="L390">      return identifier.equals(mf.getIdentifier());</span>
    }
<span class="nc" id="L392">    return false;</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see java.lang.Object#toString()
   */
  @Override
  public String toString() {
<span class="nc" id="L402">    return identifier;</span>
  }

  @Override
  public String getSuffix(String tag) {
<span class="pc bpc" id="L407" title="1 of 2 branches missed.">    if (suffixes.containsKey(tag)) return suffixes.get(tag);</span>
<span class="nc" id="L408">    else return null;</span>
  }

  @Override
  public List&lt;String&gt; getTags() {
<span class="fc" id="L413">    return new ArrayList&lt;String&gt;(suffixes.keySet());</span>
  }

  /**
   * An extension property. To read about why this class is necessary, see http://java.net/jira/browse/JAXB-223
   */
  @XmlAccessorType(XmlAccessType.FIELD)
  @XmlType(name = &quot;extension&quot;, namespace = &quot;http://composer.opencastproject.org&quot;)
  public static class Extension {

    /** The property key */
    @XmlAttribute
    private String key;

    /** The property value */
    @XmlValue
    private String value;

    /**
     * No-arg constructor needed by JAXB
     */
<span class="nc" id="L434">    public Extension() {</span>
<span class="nc" id="L435">    }</span>

    /**
     * Constructs an extension property with a key and a value.
     *
     * @param key
     *          the key
     * @param value
     *          the value
     */
<span class="fc" id="L445">    public Extension(String key, String value) {</span>
<span class="fc" id="L446">      this.key = key;</span>
<span class="fc" id="L447">      this.value = value;</span>
<span class="fc" id="L448">    }</span>

    /**
     * Constructs an extension property with a map entry.
     *
     * @param e
     *          the value
     */
<span class="nc" id="L456">    public Extension(Map.Entry&lt;String, String&gt; e) {</span>
<span class="nc" id="L457">      key = e.getKey();</span>
<span class="nc" id="L458">      value = e.getValue();</span>
<span class="nc" id="L459">    }</span>

    /**
     * @return the key
     */
    public String getKey() {
<span class="fc" id="L465">      return key;</span>
    }

    /**
     * @return the value
     */
    public String getValue() {
<span class="fc" id="L472">      return value;</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="nc bnc" id="L477" title="All 2 branches missed.">      if (obj instanceof Extension) {</span>
<span class="nc" id="L478">        Extension ext = (Extension) obj;</span>
<span class="nc bnc" id="L479" title="All 4 branches missed.">        return key.equals(ext.getKey()) &amp;&amp; value.equals(ext.getValue());</span>
      }
<span class="nc" id="L481">      return false;</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L486">      return EqualsUtil.hash(key, value);</span>
    }
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>