<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Series.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-elasticsearch-index</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.elasticsearch.index.objects.series</a> &gt; <span class="el_source">Series.java</span></div><h1>Series.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.elasticsearch.index.objects.series;

import org.opencastproject.elasticsearch.index.objects.IndexObject;
import org.opencastproject.util.DateTimeSupport.UtcTimestampAdapter;
import org.opencastproject.util.EqualsUtil;
import org.opencastproject.util.IoSupport;
import org.opencastproject.util.XmlSafeParser;
import org.opencastproject.util.jaxb.ExtendedMetadataAdapter;

import org.codehaus.jettison.json.JSONException;
import org.codehaus.jettison.json.JSONObject;
import org.codehaus.jettison.mapped.Configuration;
import org.codehaus.jettison.mapped.MappedNamespaceConvention;
import org.codehaus.jettison.mapped.MappedXMLStreamReader;
import org.codehaus.jettison.mapped.MappedXMLStreamWriter;
import org.xml.sax.SAXException;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.StringWriter;
import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.xml.bind.JAXBContext;
import javax.xml.bind.JAXBException;
import javax.xml.bind.Marshaller;
import javax.xml.bind.Unmarshaller;
import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlElementWrapper;
import javax.xml.bind.annotation.XmlRootElement;
import javax.xml.bind.annotation.XmlType;
import javax.xml.bind.annotation.adapters.XmlJavaTypeAdapter;
import javax.xml.stream.XMLStreamException;
import javax.xml.stream.XMLStreamReader;
import javax.xml.stream.XMLStreamWriter;

/**
 * Object wrapper for a series.
 */
@XmlType(name = &quot;series&quot;, namespace = IndexObject.INDEX_XML_NAMESPACE, propOrder = { &quot;identifier&quot;, &quot;title&quot;,
        &quot;description&quot;, &quot;subject&quot;, &quot;organization&quot;, &quot;language&quot;, &quot;creator&quot;, &quot;license&quot;, &quot;extendedMetadata&quot;, &quot;accessPolicy&quot;,
        &quot;managedAcl&quot;, &quot;createdDateTime&quot;, &quot;organizers&quot;, &quot;contributors&quot;, &quot;publishers&quot;, &quot;rightsHolder&quot;, &quot;theme&quot; })
@XmlRootElement(name = &quot;series&quot;, namespace = IndexObject.INDEX_XML_NAMESPACE)
@XmlAccessorType(XmlAccessType.NONE)
public class Series implements IndexObject {

  /** The document type */
  public static final String DOCUMENT_TYPE = &quot;series&quot;;

  /** The name of the surrounding XML tag to wrap a result of multiple series */
  public static final String XML_SURROUNDING_TAG = &quot;series-list&quot;;

  /** The identifier */
<span class="fc" id="L82">  @XmlElement(name = &quot;identifier&quot;)</span>
  private String identifier = null;

  /** The title */
<span class="fc" id="L86">  @XmlElement(name = &quot;title&quot;)</span>
  private String title = null;

  /** The description */
<span class="fc" id="L90">  @XmlElement(name = &quot;description&quot;)</span>
  private String description = null;

  /** The subject */
<span class="fc" id="L94">  @XmlElement(name = &quot;subject&quot;)</span>
  private String subject = null;

  /** The organization for the series */
<span class="fc" id="L98">  @XmlElement(name = &quot;organization&quot;)</span>
  private String organization = null;

  /** The language for the series */
<span class="fc" id="L102">  @XmlElement(name = &quot;language&quot;)</span>
  private String language = null;

  /** The creator of the series */
<span class="fc" id="L106">  @XmlElement(name = &quot;creator&quot;)</span>
  private String creator = null;

  /** The license of the series */
<span class="fc" id="L110">  @XmlElement(name = &quot;license&quot;)</span>
  private String license = null;

<span class="fc" id="L113">  @XmlElement(name = &quot;extendedMetadata&quot;)</span>
  @XmlJavaTypeAdapter(ExtendedMetadataAdapter.class)
  private Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt; extendedMetadata = new HashMap();

  /** The access policy of the series */
<span class="fc" id="L118">  @XmlElement(name = &quot;access_policy&quot;)</span>
  private String accessPolicy = null;

  /** The name of the managed ACL used by the series (if set) */
<span class="fc" id="L122">  @XmlElement(name = &quot;managed_acl&quot;)</span>
  private String managedAcl = null;

  /** The date and time the series was created in UTC format e.g. 2011-07-16T20:39:05Z */
  @XmlElement(name = &quot;createdDateTime&quot;)
  @XmlJavaTypeAdapter(UtcTimestampAdapter.class)
  private Date createdDateTime;

<span class="fc" id="L130">  @XmlElementWrapper(name = &quot;organizers&quot;)</span>
  @XmlElement(name = &quot;organizer&quot;)
  private List&lt;String&gt; organizers = null;

<span class="fc" id="L134">  @XmlElementWrapper(name = &quot;contributors&quot;)</span>
  @XmlElement(name = &quot;contributor&quot;)
  private List&lt;String&gt; contributors = null;

<span class="fc" id="L138">  @XmlElementWrapper(name = &quot;publishers&quot;)</span>
  @XmlElement(name = &quot;publisher&quot;)
  private List&lt;String&gt; publishers = null;

<span class="fc" id="L142">  @XmlElement(name = &quot;rights_holder&quot;)</span>
  private String rightsHolder = null;

<span class="fc" id="L145">  @XmlElement(name = &quot;theme&quot;)</span>
  private Long theme = null;

  /** Context for serializing and deserializing */
<span class="fc" id="L149">  private static JAXBContext context = null;</span>

  /**
   * Required default no arg constructor for JAXB.
   */
<span class="fc" id="L154">  public Series() {</span>

<span class="fc" id="L156">  }</span>

  /**
   * The series identifier.
   *
   * @param identifier
   *          the object identifier
   * @param organization
   *          the organization
   */
<span class="fc" id="L166">  public Series(String identifier, String organization) {</span>
<span class="fc" id="L167">    this.identifier = identifier;</span>
<span class="fc" id="L168">    this.organization = organization;</span>
<span class="fc" id="L169">  }</span>

  /**
   * Create an unmarshaller for series
   * @return an unmarshaller for series
   * @throws IOException
   */
  public static Unmarshaller createUnmarshaller() throws IOException {
    try {
<span class="nc bnc" id="L178" title="All 2 branches missed.">      if (context == null) {</span>
<span class="nc" id="L179">        createJAXBContext();</span>
      }
<span class="nc" id="L181">      return context.createUnmarshaller();</span>
<span class="nc" id="L182">    } catch (JAXBException e) {</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">      throw new IOException(e.getLinkedException() != null ? e.getLinkedException() : e);</span>
    }
  }

  /**
   * Returns the series identifier.
   *
   * @return the identifier
   */
  public String getIdentifier() {
<span class="fc" id="L193">    return identifier;</span>
  }

  /**
   * Sets the series title.
   *
   * @param title
   *          the title
   */
  public void setTitle(String title) {
<span class="pc bpc" id="L203" title="1 of 2 branches missed.">    if (EqualsUtil.eq(this.title, title)) {</span>
<span class="nc" id="L204">      return;</span>
    }

<span class="fc" id="L207">    this.title = title;</span>
<span class="fc" id="L208">  }</span>

  /**
   * Returns the series title.
   *
   * @return the title
   */
  public String getTitle() {
<span class="fc" id="L216">    return title;</span>
  }

  /**
   * Sets the series description.
   *
   * @param description
   *          the description
   */
  public void setDescription(String description) {
<span class="fc" id="L226">    this.description = description;</span>
<span class="fc" id="L227">  }</span>

  /**
   * Returns the series description.
   *
   * @return the description
   */
  public String getDescription() {
<span class="fc" id="L235">    return description;</span>
  }

  /**
   * Sets the series subject.
   *
   * @param subject
   *          the subject
   */
  public void setSubject(String subject) {
<span class="fc" id="L245">    this.subject = subject;</span>
<span class="fc" id="L246">  }</span>

  /**
   * Returns the series subject.
   *
   * @return the subject
   */
  public String getSubject() {
<span class="fc" id="L254">    return subject;</span>
  }

  /**
   * Returns the series organization.
   *
   * @return the organization
   */
  public String getOrganization() {
<span class="fc" id="L263">    return organization;</span>
  }

  /**
   * Sets the series language.
   *
   * @param language
   *          the language
   */
  public void setLanguage(String language) {
<span class="fc" id="L273">    this.language = language;</span>
<span class="fc" id="L274">  }</span>

  /**
   * Returns the series language.
   *
   * @return the language
   */
  public String getLanguage() {
<span class="fc" id="L282">    return language;</span>
  }

  /**
   * Sets the series creator.
   *
   * @param creator
   *          the creator
   */
  public void setCreator(String creator) {
<span class="fc" id="L292">    this.creator = creator;</span>
<span class="fc" id="L293">  }</span>

  /**
   * Returns the series creator.
   *
   * @return the creator
   */
  public String getCreator() {
<span class="fc" id="L301">    return creator;</span>
  }

  /**
   * Sets the series license.
   *
   * @param license
   *          the license
   */
  public void setLicense(String license) {
<span class="fc" id="L311">    this.license = license;</span>
<span class="fc" id="L312">  }</span>

  /**
   * Returns the series license.
   *
   * @return the license
   */
  public String getLicense() {
<span class="fc" id="L320">    return license;</span>
  }

  /**
   * Sets the series access policy.
   *
   * @param accessPolicy
   *          the access policy
   */
  public void setAccessPolicy(String accessPolicy) {
<span class="fc" id="L330">    this.accessPolicy = accessPolicy;</span>
<span class="fc" id="L331">  }</span>

  /**
   * Returns the series access policy.
   *
   * @return the access policy
   */
  public String getAccessPolicy() {
<span class="fc" id="L339">    return accessPolicy;</span>
  }

  /**
   * Sets the name of the managed ACL used by the series.
   *
   * @param managedAcl
   *          the managed ACL name
   */
  public void setManagedAcl(String managedAcl) {
<span class="nc" id="L349">    this.managedAcl = managedAcl;</span>
<span class="nc" id="L350">  }</span>

  /**
   * Returns the name of the managed ACL, if the series does not have a custom ACL.
   *
   * @return the managed ACL name
   */
  public String getManagedAcl() {
<span class="fc" id="L358">    return managedAcl;</span>
  }

  /**
   * Sets the series created date and time.
   *
   * @param createdDateTime
   *          the date and time the series was created.
   */
  public void setCreatedDateTime(Date createdDateTime) {
<span class="fc" id="L368">    this.createdDateTime = createdDateTime;</span>
<span class="fc" id="L369">  }</span>

  /**
   * Returns the series date and time created.
   *
   * @return the created date and time
   */
  public Date getCreatedDateTime() {
<span class="fc" id="L377">    return createdDateTime;</span>
  }

  /**
   * Add an organizer
   *
   * @param organizer
   *          The organizer's name.
   */
  public void addOrganizer(String organizer) {
<span class="fc bfc" id="L387" title="All 2 branches covered.">    if (organizers == null) {</span>
<span class="fc" id="L388">      organizers = new ArrayList&lt;String&gt;();</span>
    }
<span class="fc" id="L390">    organizers.add(organizer);</span>
<span class="fc" id="L391">  }</span>

  /**
   * Sets the list of organizers.
   *
   * @param organizers
   *          the organizers for this event
   */
  public void setOrganizers(List&lt;String&gt; organizers) {
<span class="fc" id="L400">    this.organizers = organizers;</span>
<span class="fc" id="L401">  }</span>

  /**
   * Returns the series presenters.
   *
   * @return the presenters
   */
  public List&lt;String&gt; getOrganizers() {
<span class="fc" id="L409">    return organizers;</span>
  }

  /**
   * Add a contributor
   *
   * @param contributor
   *          The contributor's name.
   */
  public void addContributor(String contributor) {
<span class="fc bfc" id="L419" title="All 2 branches covered.">    if (contributors == null) {</span>
<span class="fc" id="L420">      contributors = new ArrayList&lt;String&gt;();</span>
    }
<span class="fc" id="L422">    contributors.add(contributor);</span>
<span class="fc" id="L423">  }</span>

  /**
   * Sets the list of contributors.
   *
   * @param contributors
   *          the contributors for this event
   */
  public void setContributors(List&lt;String&gt; contributors) {
<span class="fc" id="L432">    this.contributors = contributors;</span>
<span class="fc" id="L433">  }</span>

  /**
   * Returns the series contributors.
   *
   * @return the contributors
   */
  public List&lt;String&gt; getContributors() {
<span class="fc" id="L441">    return contributors;</span>
  }

  /**
   * Add a publisher
   *
   * @param publisher
   *          The publisher's name.
   */
  public void addPublisher(String publisher) {
<span class="pc bpc" id="L451" title="1 of 2 branches missed.">    if (publishers == null) {</span>
<span class="fc" id="L452">      publishers = new ArrayList&lt;String&gt;();</span>
    }
<span class="fc" id="L454">    publishers.add(publisher);</span>
<span class="fc" id="L455">  }</span>

  /**
   * Sets the list of publishers.
   *
   * @param publishers
   *          the publishers for this event
   */
  public void setPublishers(List&lt;String&gt; publishers) {
<span class="nc" id="L464">    this.publishers = publishers;</span>
<span class="nc" id="L465">  }</span>

  /**
   * Returns the series publishers.
   *
   * @return the publishers
   */
  public List&lt;String&gt; getPublishers() {
<span class="fc" id="L473">    return publishers;</span>
  }

  /**
   * Sets the series rights holder.
   *
   * @param rightsHolder
   *          holder the rights holder
   */
  public void setRightsHolder(String rightsHolder) {
<span class="nc" id="L483">    this.rightsHolder = rightsHolder;</span>
<span class="nc" id="L484">  }</span>

  /**
   * Returns the series rights holder.
   *
   * @return the rights holder
   */
  public String getRightsHolder() {
<span class="fc" id="L492">    return rightsHolder;</span>
  }

  /**
   * Sets the theme for this series
   *
   * @param theme
   *          the theme
   */
  public void setTheme(Long theme) {
<span class="fc" id="L502">    this.theme = theme;</span>
<span class="fc" id="L503">  }</span>

  /**
   * Returns the theme of this series
   *
   * @return the theme of this series
   */
  public Long getTheme() {
<span class="fc" id="L511">    return theme;</span>
  }

  /**
   * Sets the external metadata for a catalog type.
   *
   * @param type
   *         The catalog type
   * @param metadata
   *         The metadata
   */
  public void setExtendedMetadata(String type, Map&lt;String, List&lt;String&gt;&gt; metadata) {
<span class="nc" id="L523">    extendedMetadata.put(type, metadata);</span>
<span class="nc" id="L524">  }</span>

  /**
   * Removes the external metadata for a catalog type.
   *
   * @param type
   *         The catalog type
   */
  public void removeExtendedMetadata(String type) {
<span class="nc" id="L533">    extendedMetadata.remove(type);</span>
<span class="nc" id="L534">  }</span>

  /**
   * Removes all external metadata.
   */
  public void resetExtendedMetadata() {
<span class="nc" id="L540">    extendedMetadata.clear();</span>
<span class="nc" id="L541">  }</span>

  /**
   * Returns the extended metadata
   *
   * @return the extended metadata in a map by catalog type
   */
  public Map&lt;String, Map&lt;String, List&lt;String&gt;&gt;&gt; getExtendedMetadata() {
<span class="nc" id="L549">    return extendedMetadata;</span>
  }

  /**
   * Reads the series from the input stream.
   *
   * @param xml
   *          the input stream
   * @param unmarshaller the unmarshaller to use
   * @return the deserialized recording event
   * @throws IOException
   */
  public static Series valueOf(InputStream xml, Unmarshaller unmarshaller) throws IOException {
    try {
<span class="nc bnc" id="L563" title="All 2 branches missed.">      if (context == null) {</span>
<span class="nc" id="L564">        createJAXBContext();</span>
      }
<span class="nc" id="L566">      return unmarshaller.unmarshal(XmlSafeParser.parse(xml), Series.class).getValue();</span>
<span class="nc" id="L567">    } catch (JAXBException e) {</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">      throw new IOException(e.getLinkedException() != null ? e.getLinkedException() : e);</span>
<span class="nc" id="L569">    } catch (SAXException e) {</span>
<span class="nc" id="L570">      throw new IOException(e);</span>
    } finally {
<span class="nc" id="L572">      IoSupport.closeQuietly(xml);</span>
    }
  }

  /**
   * Reads the series from the input stream.
   *
   * @param json
   *          the input stream
   * @return the deserialized recording event
   * @throws JSONException
   * @throws XMLStreamException
   * @throws JAXBException
   */
  public static Series valueOfJson(InputStream json) throws IOException, JSONException, XMLStreamException,
          JAXBException {
    // TODO Get this to work, it is currently returning null properties for all properties.
<span class="nc bnc" id="L589" title="All 2 branches missed.">    if (context == null) {</span>
<span class="nc" id="L590">      createJAXBContext();</span>
    }

<span class="nc" id="L593">    BufferedReader streamReader = new BufferedReader(new InputStreamReader(json, &quot;UTF-8&quot;));</span>
<span class="nc" id="L594">    StringBuilder jsonStringBuilder = new StringBuilder();</span>
    String inputStr;
<span class="nc bnc" id="L596" title="All 2 branches missed.">    while ((inputStr = streamReader.readLine()) != null) {</span>
<span class="nc" id="L597">      jsonStringBuilder.append(inputStr);</span>
    }

<span class="nc" id="L600">    JSONObject obj = new JSONObject(jsonStringBuilder.toString());</span>
<span class="nc" id="L601">    Configuration config = new Configuration();</span>
<span class="nc" id="L602">    config.setSupressAtAttributes(true);</span>
<span class="nc" id="L603">    Map&lt;String, String&gt; xmlToJsonNamespaces = new HashMap&lt;String, String&gt;(1);</span>
<span class="nc" id="L604">    xmlToJsonNamespaces.put(IndexObject.INDEX_XML_NAMESPACE, &quot;&quot;);</span>
<span class="nc" id="L605">    config.setXmlToJsonNamespaces(xmlToJsonNamespaces);</span>
<span class="nc" id="L606">    MappedNamespaceConvention con = new MappedNamespaceConvention(config);</span>
<span class="nc" id="L607">    Unmarshaller unmarshaller = context.createUnmarshaller();</span>
    // CHECKSTYLE:OFF
    // the xml is parsed from json and should be safe
<span class="nc" id="L610">    XMLStreamReader xmlStreamReader = new MappedXMLStreamReader(obj, con);</span>
<span class="nc" id="L611">    Series event = (Series) unmarshaller.unmarshal(xmlStreamReader);</span>
    // CHECKSTYLE:ON
<span class="nc" id="L613">    return event;</span>
  }

  /**
   * Initialize the JAXBContext.
   */
  private static void createJAXBContext() throws JAXBException {
<span class="fc" id="L620">    context = JAXBContext.newInstance(Series.class);</span>
<span class="fc" id="L621">  }</span>

  /**
   * Serializes the series.
   *
   * @return the serialized series
   */
  public String toJSON() {
    try {
<span class="fc bfc" id="L630" title="All 2 branches covered.">      if (context == null) {</span>
<span class="fc" id="L631">        createJAXBContext();</span>
      }
<span class="fc" id="L633">      Marshaller marshaller = Series.context.createMarshaller();</span>

<span class="fc" id="L635">      Configuration config = new Configuration();</span>
<span class="fc" id="L636">      config.setSupressAtAttributes(true);</span>
<span class="fc" id="L637">      MappedNamespaceConvention con = new MappedNamespaceConvention(config);</span>
<span class="fc" id="L638">      StringWriter writer = new StringWriter();</span>
<span class="fc" id="L639">      XMLStreamWriter xmlStreamWriter = new MappedXMLStreamWriter(con, writer) {</span>
        @Override
        public void writeStartElement(String prefix, String local, String uri) throws XMLStreamException {
<span class="fc" id="L642">          super.writeStartElement(&quot;&quot;, local, &quot;&quot;);</span>
<span class="fc" id="L643">        }</span>

        @Override
        public void writeStartElement(String uri, String local) throws XMLStreamException {
<span class="nc" id="L647">          super.writeStartElement(&quot;&quot;, local, &quot;&quot;);</span>
<span class="nc" id="L648">        }</span>

        @Override
        public void setPrefix(String pfx, String uri) throws XMLStreamException {
<span class="nc" id="L652">        }</span>

        @Override
        public void setDefaultNamespace(String uri) throws XMLStreamException {
<span class="nc" id="L656">        }</span>
      };

<span class="fc" id="L659">      marshaller.marshal(this, xmlStreamWriter);</span>
<span class="fc" id="L660">      return writer.toString();</span>
<span class="nc" id="L661">    } catch (JAXBException e) {</span>
<span class="nc bnc" id="L662" title="All 2 branches missed.">      throw new IllegalStateException(e.getLinkedException() != null ? e.getLinkedException() : e);</span>
    }
  }

  /**
   * Serializes the series to an XML format.
   *
   * @return A String with this series' content as XML.
   */
  public String toXML() {
    try {
<span class="nc bnc" id="L673" title="All 2 branches missed.">      if (context == null) {</span>
<span class="nc" id="L674">        createJAXBContext();</span>
      }
<span class="nc" id="L676">      StringWriter writer = new StringWriter();</span>
<span class="nc" id="L677">      Marshaller marshaller = Series.context.createMarshaller();</span>
<span class="nc" id="L678">      marshaller.marshal(this, writer);</span>
<span class="nc" id="L679">      return writer.toString();</span>
<span class="nc" id="L680">    } catch (JAXBException e) {</span>
<span class="nc bnc" id="L681" title="All 2 branches missed.">      throw new IllegalStateException(e.getLinkedException() != null ? e.getLinkedException() : e);</span>
    }
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>