<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>JaxbServiceRegistration.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-common</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.serviceregistry.api</a> &gt; <span class="el_source">JaxbServiceRegistration.java</span></div><h1>JaxbServiceRegistration.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.serviceregistry.api;

import java.util.Date;

import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlRootElement;
import javax.xml.bind.annotation.XmlType;

/**
 * A record of a service that creates and manages receipts.
 */
@XmlAccessorType(XmlAccessType.NONE)
@XmlType(name = &quot;service&quot;, namespace = &quot;http://serviceregistry.opencastproject.org&quot;)
@XmlRootElement(name = &quot;service&quot;, namespace = &quot;http://serviceregistry.opencastproject.org&quot;)
public class JaxbServiceRegistration implements ServiceRegistration {

  @XmlElement(name = &quot;type&quot;)
  protected String serviceType;

  @XmlElement(name = &quot;host&quot;)
  protected String host;

  @XmlElement(name = &quot;path&quot;)
  protected String path;

  @XmlElement(name = &quot;active&quot;)
  protected boolean active;

  @XmlElement(name = &quot;online&quot;)
  protected boolean online;

  @XmlElement(name = &quot;maintenance&quot;)
  protected boolean maintenanceMode;

  @XmlElement(name = &quot;jobproducer&quot;)
  protected boolean jobProducer;

  /** The last time the service has been declared online */
  @XmlElement(name = &quot;onlinefrom&quot;)
  protected Date onlineFrom;

  @XmlElement(name = &quot;service_state&quot;)
  protected ServiceState serviceState;

  @XmlElement(name = &quot;state_changed&quot;)
  protected Date stateChanged;

  @XmlElement(name = &quot;error_state_trigger&quot;)
  protected int errorStateTrigger;

  @XmlElement(name = &quot;warning_state_trigger&quot;)
  protected int warningStateTrigger;

  /**
   * Creates a new service registration which is online and not in maintenance mode.
   */
<span class="fc" id="L80">  public JaxbServiceRegistration() {</span>
<span class="fc" id="L81">    this.online = true;</span>
<span class="fc" id="L82">    this.active = true;</span>
<span class="fc" id="L83">    this.maintenanceMode = false;</span>
<span class="fc" id="L84">    this.onlineFrom = new Date();</span>
<span class="fc" id="L85">    this.serviceState = ServiceState.NORMAL;</span>
<span class="fc" id="L86">    this.stateChanged = new Date();</span>
<span class="fc" id="L87">  }</span>

  /**
   * Creates a new JAXB annotated service registration based on an existing service registration
   *
   * @param serviceRegistration
   */
<span class="fc" id="L94">  public JaxbServiceRegistration(ServiceRegistration serviceRegistration) {</span>
<span class="fc" id="L95">    this.host = serviceRegistration.getHost();</span>
<span class="fc" id="L96">    this.jobProducer = serviceRegistration.isJobProducer();</span>
<span class="fc" id="L97">    this.maintenanceMode = serviceRegistration.isInMaintenanceMode();</span>
<span class="fc" id="L98">    this.active = serviceRegistration.isActive();</span>
<span class="fc" id="L99">    this.online = serviceRegistration.isOnline();</span>
<span class="fc" id="L100">    this.onlineFrom = serviceRegistration.getOnlineFrom();</span>
<span class="fc" id="L101">    this.path = serviceRegistration.getPath();</span>
<span class="fc" id="L102">    this.serviceType = serviceRegistration.getServiceType();</span>
<span class="fc" id="L103">    this.serviceState = serviceRegistration.getServiceState();</span>
<span class="fc" id="L104">    this.stateChanged = serviceRegistration.getStateChanged();</span>
<span class="fc" id="L105">    this.warningStateTrigger = serviceRegistration.getWarningStateTrigger();</span>
<span class="fc" id="L106">    this.errorStateTrigger = serviceRegistration.getErrorStateTrigger();</span>
<span class="fc" id="L107">  }</span>

  /**
   * Creates a new service registration which is online and not in maintenance mode.
   *
   * @param host
   *          the host
   * @param serviceType
   *          the job type
   */
  public JaxbServiceRegistration(String serviceType, String host, String path) {
<span class="fc" id="L118">    this();</span>
<span class="fc" id="L119">    this.serviceType = serviceType;</span>
<span class="fc" id="L120">    this.host = host;</span>
<span class="fc" id="L121">    this.path = path;</span>
<span class="fc" id="L122">  }</span>

  /**
   * Creates a new service registration which is online and not in maintenance mode.
   *
   * @param host
   *          the host
   * @param serviceType
   *          the job type
   * @param jobProducer
   */
  public JaxbServiceRegistration(String serviceType, String host, String path, boolean jobProducer) {
<span class="nc" id="L134">    this();</span>
<span class="nc" id="L135">    this.serviceType = serviceType;</span>
<span class="nc" id="L136">    this.host = host;</span>
<span class="nc" id="L137">    this.path = path;</span>
<span class="nc" id="L138">    this.jobProducer = jobProducer;</span>
<span class="nc" id="L139">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.serviceregistry.api.ServiceRegistration#getHost()
   */
  @Override
  public String getHost() {
<span class="fc" id="L148">    return host;</span>
  }

  /**
   * @param host
   *          the host to set
   */
  public void setHost(String host) {
<span class="nc" id="L156">    this.host = host;</span>
<span class="nc" id="L157">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.serviceregistry.api.ServiceRegistration#getServiceType()
   */
  @Override
  public String getServiceType() {
<span class="fc" id="L166">    return serviceType;</span>
  }

  /**
   * @param serviceType
   *          the serviceType to set
   */
  public void setServiceType(String serviceType) {
<span class="nc" id="L174">    this.serviceType = serviceType;</span>
<span class="nc" id="L175">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.serviceregistry.api.ServiceRegistration#isInMaintenanceMode()
   */
  @Override
  public boolean isInMaintenanceMode() {
<span class="fc" id="L184">    return maintenanceMode;</span>
  }

  /**
   * Sets the maintenance status of this service registration
   *
   * @param maintenanceMode
   */
  public void setInMaintenanceMode(boolean maintenanceMode) {
<span class="nc" id="L193">    this.maintenanceMode = maintenanceMode;</span>
<span class="nc" id="L194">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.serviceregistry.api.ServiceRegistration#isActive()
   */
  @Override
  public boolean isActive() {
<span class="fc" id="L203">    return active;</span>
  }

  public void setActive(boolean active) {
<span class="nc" id="L207">    this.active = active;</span>
<span class="nc" id="L208">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.serviceregistry.api.ServiceRegistration#isOnline()
   */
  @Override
  public boolean isOnline() {
<span class="fc" id="L217">    return online;</span>
  }

  /**
   * Sets the online status of this service registration
   *
   * @param online
   */
  public void setOnline(boolean online) {
<span class="nc bnc" id="L226" title="All 4 branches missed.">    if (online &amp;&amp; !isOnline())</span>
<span class="nc" id="L227">      setOnlineFrom(new Date());</span>
<span class="nc" id="L228">    this.online = online;</span>
<span class="nc" id="L229">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.serviceregistry.api.ServiceRegistration#getPath()
   */
  @Override
  public String getPath() {
<span class="nc" id="L238">    return path;</span>
  }

  /**
   * @param path
   *          the path to set
   */
  public void setPath(String path) {
<span class="nc" id="L246">    this.path = path;</span>
<span class="nc" id="L247">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.serviceregistry.api.ServiceRegistration#isJobProducer()
   */
  @Override
  public boolean isJobProducer() {
<span class="nc" id="L256">    return jobProducer;</span>
  }

  /**
   * Sets whether this service registration is a job producer.
   *
   * @param jobProducer
   *          the jobProducer to set
   */
  public void setJobProducer(boolean jobProducer) {
<span class="nc" id="L266">    this.jobProducer = jobProducer;</span>
<span class="nc" id="L267">  }</span>

  /**
   *
   * {@inheritDoc}
   *
   * @see org.opencastproject.serviceregistry.api.ServiceRegistration#getOnlineFrom()
   */
  @Override
  public Date getOnlineFrom() {
<span class="nc" id="L277">    return onlineFrom;</span>
  }

  /**
   * Sets the last time the service has been declared online
   *
   * @param onlineFrom
   *          the onlineFrom to set
   */
  public void setOnlineFrom(Date onlineFrom) {
<span class="nc" id="L287">    this.onlineFrom = onlineFrom;</span>
<span class="nc" id="L288">  }</span>

  /**
   *
   * {@inheritDoc}
   *
   * @see org.opencastproject.serviceregistry.api.ServiceRegistration#getServiceState()
   */
  @Override
  public ServiceState getServiceState() {
<span class="fc" id="L298">    return serviceState;</span>
  }

  /**
   * Sets the current state of the service.
   *
   * @param state
   *          current state
   */
  public void setServiceState(ServiceState state) {
<span class="fc" id="L308">    this.serviceState = state;</span>
<span class="fc" id="L309">  }</span>

  /**
   * Sets the current state of the service and the trigger Job. If the state is set to {@link ServiceState#WARNING} or
   * {@link ServiceState#ERROR} the triggered job will be set.
   *
   * @param state
   *          the service state
   * @param triggerJobSignature
   *          the triggered job signature
   */
  public void setServiceState(ServiceState state, int triggerJobSignature) {

<span class="nc" id="L322">    setServiceState(state);</span>
<span class="nc" id="L323">    setStateChanged(new Date());</span>
<span class="nc bnc" id="L324" title="All 2 branches missed.">    if (state == ServiceState.WARNING) {</span>
<span class="nc" id="L325">      setWarningStateTrigger(triggerJobSignature);</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">    } else if (state == ServiceState.ERROR) {</span>
<span class="nc" id="L327">      setErrorStateTrigger(triggerJobSignature);</span>
    }
<span class="nc" id="L329">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.serviceregistry.api.ServiceRegistration#getStateChanged()
   */
  @Override
  public Date getStateChanged() {
<span class="nc" id="L338">    return stateChanged;</span>
  }

  /**
   * Sets the last date when the state was changed
   *
   * @param stateChanged
   *          last date
   */
  public void setStateChanged(Date stateChanged) {
<span class="nc" id="L348">    this.stateChanged = stateChanged;</span>
<span class="nc" id="L349">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.serviceregistry.api.ServiceRegistration#getErrorStateTrigger()
   */
  @Override
  public int getErrorStateTrigger() {
<span class="nc" id="L358">    return errorStateTrigger;</span>
  }

  /**
   * Sets the job which triggered the last error state
   *
   * @param jobSignature
   *          the job
   */
  public void setErrorStateTrigger(int jobSignature) {
<span class="nc" id="L368">    this.errorStateTrigger = jobSignature;</span>
<span class="nc" id="L369">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.serviceregistry.api.ServiceRegistration#getWarningStateTrigger()
   */
  @Override
  public int getWarningStateTrigger() {
<span class="nc" id="L378">    return warningStateTrigger;</span>
  }

  /**
   * Sets the job which triggered the last warning state
   *
   * @param jobSignature
   *          the job
   */
  public void setWarningStateTrigger(int jobSignature) {
<span class="nc" id="L388">    this.warningStateTrigger = jobSignature;</span>
<span class="nc" id="L389">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see java.lang.Object#hashCode()
   */
  @Override
  public int hashCode() {
<span class="nc" id="L398">    return toString().hashCode();</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see java.lang.Object#equals(java.lang.Object)
   */
  @Override
  public boolean equals(Object obj) {
<span class="nc bnc" id="L408" title="All 2 branches missed.">    if (!(obj instanceof ServiceRegistration))</span>
<span class="nc" id="L409">      return false;</span>
<span class="nc" id="L410">    ServiceRegistration registration = (ServiceRegistration) obj;</span>
<span class="nc bnc" id="L411" title="All 4 branches missed.">    return getHost().equals(registration.getHost()) &amp;&amp; getServiceType().equals(registration.getServiceType());</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see java.lang.Object#toString()
   */
  @Override
  public String toString() {
<span class="nc" id="L421">    return getServiceType() + &quot;@&quot; + getHost();</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>