<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Adopter.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-adopter-registration-impl</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.adopter.registration.dto</a> &gt; <span class="el_source">Adopter.java</span></div><h1>Adopter.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.adopter.registration.dto;

import org.opencastproject.security.api.Organization;
import org.opencastproject.util.EqualsUtil;

import java.util.Date;
import java.util.Objects;

import javax.persistence.Access;
import javax.persistence.AccessType;
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.NamedQueries;
import javax.persistence.NamedQuery;
import javax.persistence.Table;
import javax.persistence.Temporal;
import javax.persistence.TemporalType;

/**
 * JPA-annotated registration form object.
 */
@Entity
@Access(AccessType.FIELD)
@Table(name = &quot;oc_adopter_registration&quot;)
@NamedQueries({
        @NamedQuery(name = &quot;Adopter.findAll&quot;, query = &quot;SELECT f FROM Adopter f&quot;),
        @NamedQuery(name = &quot;Adopter.deleteAll&quot;, query = &quot;DELETE FROM Adopter f&quot;)
})
public class Adopter {

<span class="nc" id="L53">  public enum TERMSOFUSEVERSION {</span>
<span class="nc" id="L54">    PRE_2022, APRIL_2022</span>
  };

  public static final TERMSOFUSEVERSION getLatestTermsOfUse() {
<span class="nc" id="L58">    return TERMSOFUSEVERSION.APRIL_2022;</span>
  }


  //================================================================================
  // Properties
  //================================================================================

  @Id
  @Column(name = &quot;adopter_key&quot;, length = 64)
  private String adopterKey;

  @Column(name = &quot;statistic_key&quot;)
  private String statisticKey;

  @Column(name = &quot;organisation&quot;)
  private String organisationName;

  @Column(name = &quot;department&quot;)
  private String departmentName;

  @Column(name = &quot;first_name&quot;)
  private String firstName;

  @Column(name = &quot;last_name&quot;)
  private String lastName;

  @Column(name = &quot;email&quot;)
  private String email;

  @Column(name = &quot;country&quot;)
  private String country;

  @Column(name = &quot;postal_code&quot;)
  private String postalCode;

  @Column(name = &quot;city&quot;)
  private String city;

  @Column(name = &quot;street&quot;)
  private String street;

  @Column(name = &quot;street_no&quot;)
  private String streetNo;

  @Column(name = &quot;contact_me&quot;)
  private boolean contactMe;

  @Column(name = &quot;system_type&quot;)
  private String systemType;

  @Column(name = &quot;allows_statistics&quot;)
  private boolean allowsStatistics;

  @Column(name = &quot;allows_error_reports&quot;)
  private boolean allowsErrorReports;

  @Column(name = &quot;created&quot;, nullable = false)
  @Temporal(TemporalType.TIMESTAMP)
  private Date dateCreated;

  @Column(name = &quot;last_modified&quot;, nullable = false)
  @Temporal(TemporalType.TIMESTAMP)
  private Date dateModified;

  @Column(name = &quot;agreed_to_policy&quot;)
  private boolean agreedToPolicy;

  @Column(name = &quot;registered&quot;)
  private boolean registered;

  // The default here is the original terms of use.
  // Note that this object doesn't get instanciated unless you've agreed to the terms *at some point*
  // so assuming a default of PRE_2022 is reasonable.  Either no agreement -&gt; no db object at all, or
  // agreement -&gt; PRE_2022 default
<span class="nc" id="L133">  @Column(name = &quot;terms_version_agreed&quot;)</span>
  private TERMSOFUSEVERSION termsVersionAgreed = TERMSOFUSEVERSION.PRE_2022;

  // If this is true, then the next stats send pass should delete the registration, then delete this object.
<span class="nc" id="L137">  @Column(name = &quot;delete_me&quot;)</span>
  private boolean deleteMe = false;


  //================================================================================
  // Constructor and Methods
  //================================================================================

  /** No-arg constructor needed by JPA. */
<span class="nc" id="L146">  public Adopter() {</span>

<span class="nc" id="L148">  }</span>

  public Adopter(String organisationName, String departmentName, String firstName, String lastName, String email,
          String country, String postalCode, String city, String street, String streetNo, boolean contactMe,
          String systemType, boolean allowsStatistics, boolean allowsErrorReports, boolean agreedToPolicy,
<span class="nc" id="L153">          boolean registered) {</span>
<span class="nc" id="L154">    this.organisationName = organisationName;</span>
<span class="nc" id="L155">    this.departmentName = departmentName;</span>
<span class="nc" id="L156">    this.firstName = firstName;</span>
<span class="nc" id="L157">    this.lastName = lastName;</span>
<span class="nc" id="L158">    this.email = email;</span>
<span class="nc" id="L159">    this.country = country;</span>
<span class="nc" id="L160">    this.postalCode = postalCode;</span>
<span class="nc" id="L161">    this.city = city;</span>
<span class="nc" id="L162">    this.street = street;</span>
<span class="nc" id="L163">    this.streetNo = streetNo;</span>
<span class="nc" id="L164">    this.contactMe = contactMe;</span>
<span class="nc" id="L165">    this.systemType = systemType;</span>
<span class="nc" id="L166">    this.allowsStatistics = allowsStatistics;</span>
<span class="nc" id="L167">    this.allowsErrorReports = allowsErrorReports;</span>
<span class="nc" id="L168">    this.agreedToPolicy = agreedToPolicy;</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">    if (this.agreedToPolicy) {</span>
<span class="nc" id="L170">      this.termsVersionAgreed = getLatestTermsOfUse();</span>
    }
<span class="nc" id="L172">    this.registered = registered;</span>
<span class="nc" id="L173">  }</span>

  public void merge(Adopter a) {
<span class="nc" id="L176">    this.organisationName = a.organisationName;</span>
<span class="nc" id="L177">    this.departmentName = a.departmentName;</span>
<span class="nc" id="L178">    this.firstName = a.firstName;</span>
<span class="nc" id="L179">    this.lastName = a.lastName;</span>
<span class="nc" id="L180">    this.email = a.email;</span>
<span class="nc" id="L181">    this.country = a.country;</span>
<span class="nc" id="L182">    this.postalCode = a.postalCode;</span>
<span class="nc" id="L183">    this.city = a.city;</span>
<span class="nc" id="L184">    this.street = a.street;</span>
<span class="nc" id="L185">    this.streetNo = a.streetNo;</span>
<span class="nc" id="L186">    this.contactMe = a.contactMe;</span>
<span class="nc" id="L187">    this.systemType = a.systemType;</span>
<span class="nc" id="L188">    this.allowsStatistics = a.allowsStatistics;</span>
<span class="nc" id="L189">    this.allowsErrorReports = a.allowsErrorReports;</span>
<span class="nc" id="L190">    this.agreedToPolicy = a.agreedToPolicy;</span>
<span class="nc" id="L191">    this.termsVersionAgreed = a.termsVersionAgreed;</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">    if (!this.registered) {</span>
      // overwrite this field only when an adopter isn't registered yet
      // once an adopter is registered, he stays registered
<span class="nc" id="L195">      this.registered = a.registered;</span>
    }
<span class="nc" id="L197">    this.dateModified = new Date();</span>
<span class="nc" id="L198">    this.deleteMe = a.deleteMe;</span>
<span class="nc" id="L199">  }</span>

  @Override
  public boolean equals(Object obj) {
<span class="nc bnc" id="L203" title="All 2 branches missed.">    if (!(obj instanceof Organization)) {</span>
<span class="nc" id="L204">      return false;</span>
    }
<span class="nc" id="L206">    return ((Adopter) obj).adopterKey.equals(adopterKey);</span>
  }

  @Override
  public int hashCode() {
<span class="nc" id="L211">    return EqualsUtil.hash(adopterKey);</span>
  }

  @Override
  public String toString() {
<span class="nc" id="L216">    return adopterKey;</span>
  }


  //================================================================================
  // Getter and Setter
  //================================================================================

  public String getAdopterKey() {
<span class="nc" id="L225">    return adopterKey;</span>
  }

  public void setAdopterKey(String adopterKey) {
<span class="nc" id="L229">    this.adopterKey = adopterKey;</span>
<span class="nc" id="L230">  }</span>

  public String getStatisticKey() {
<span class="nc" id="L233">    return statisticKey;</span>
  }

  public void setStatisticKey(String statisticKey) {
<span class="nc" id="L237">    this.statisticKey = statisticKey;</span>
<span class="nc" id="L238">  }</span>

  public String getOrganisationName() {
<span class="nc" id="L241">    return organisationName;</span>
  }

  public void setOrganisationName(String organisationName) {
<span class="nc" id="L245">    this.organisationName = organisationName;</span>
<span class="nc" id="L246">  }</span>

  public String getDepartmentName() {
<span class="nc" id="L249">    return departmentName;</span>
  }

  public void setDepartmentName(String departmentName) {
<span class="nc" id="L253">    this.departmentName = departmentName;</span>
<span class="nc" id="L254">  }</span>

  public String getFirstName() {
<span class="nc" id="L257">    return firstName;</span>
  }

  public void setFirstName(String firstName) {
<span class="nc" id="L261">    this.firstName = firstName;</span>
<span class="nc" id="L262">  }</span>

  public String getLastName() {
<span class="nc" id="L265">    return lastName;</span>
  }

  public void setLastName(String lastName) {
<span class="nc" id="L269">    this.lastName = lastName;</span>
<span class="nc" id="L270">  }</span>

  public String getEmail() {
<span class="nc" id="L273">    return email;</span>
  }

  public void setEmail(String email) {
<span class="nc" id="L277">    this.email = email;</span>
<span class="nc" id="L278">  }</span>

  public String getCountry() {
<span class="nc" id="L281">    return country;</span>
  }

  public void setCountry(String country) {
<span class="nc" id="L285">    this.country = country;</span>
<span class="nc" id="L286">  }</span>

  public String getPostalCode() {
<span class="nc" id="L289">    return postalCode;</span>
  }

  public void setPostalCode(String postalCode) {
<span class="nc" id="L293">    this.postalCode = postalCode;</span>
<span class="nc" id="L294">  }</span>

  public String getCity() {
<span class="nc" id="L297">    return city;</span>
  }

  public void setCity(String city) {
<span class="nc" id="L301">    this.city = city;</span>
<span class="nc" id="L302">  }</span>

  public String getStreet() {
<span class="nc" id="L305">    return street;</span>
  }

  public void setStreet(String street) {
<span class="nc" id="L309">    this.street = street;</span>
<span class="nc" id="L310">  }</span>

  public String getStreetNo() {
<span class="nc" id="L313">    return streetNo;</span>
  }

  public void setStreetNo(String streetNo) {
<span class="nc" id="L317">    this.streetNo = streetNo;</span>
<span class="nc" id="L318">  }</span>

  public boolean allowsContacting() {
<span class="nc" id="L321">    return contactMe;</span>
  }

  public void setContactMe(boolean contactMe) {
<span class="nc" id="L325">    this.contactMe = contactMe;</span>
<span class="nc" id="L326">  }</span>

  public String systemType() {
<span class="nc" id="L329">    return systemType;</span>
  }

  public void setSystemType(String systemType) {
<span class="nc" id="L333">    this.systemType = systemType;</span>
<span class="nc" id="L334">  }</span>

  public boolean allowsStatistics() {
<span class="nc" id="L337">    return allowsStatistics;</span>
  }

  public void setAllowsStatistics(boolean allowsStatistics) {
<span class="nc" id="L341">    this.allowsStatistics = allowsStatistics;</span>
<span class="nc" id="L342">  }</span>

  public boolean allowsErrorReports() {
<span class="nc" id="L345">    return allowsErrorReports;</span>
  }

  public void setAllowsErrorReports(boolean allowsErrorReports) {
<span class="nc" id="L349">    this.allowsErrorReports = allowsErrorReports;</span>
<span class="nc" id="L350">  }</span>

  public Date getDateCreated() {
<span class="nc" id="L353">    return dateCreated;</span>
  }

  public void setDateCreated(Date dateCreated) {
<span class="nc" id="L357">    this.dateCreated = dateCreated;</span>
<span class="nc" id="L358">  }</span>

  public Date getDateModified() {
<span class="nc" id="L361">    return dateModified;</span>
  }

  public void setDateModified(Date dateModified) {
<span class="nc" id="L365">    this.dateModified = dateModified;</span>
<span class="nc" id="L366">  }</span>

  public boolean agreedToPolicy() {
<span class="nc" id="L369">    return agreedToPolicy;</span>
  }

  public void setAgreedToPolicy(boolean agreedToPolicy) {
<span class="nc" id="L373">    this.agreedToPolicy = agreedToPolicy;</span>
<span class="nc" id="L374">  }</span>

  public boolean isRegistered() {
<span class="nc" id="L377">    return registered;</span>
  }

  public void setRegistered(boolean registered) {
<span class="nc" id="L381">    this.registered = registered;</span>
<span class="nc" id="L382">  }</span>

  public TERMSOFUSEVERSION getTermsVersionAgreed() {
<span class="nc" id="L385">    return Objects.requireNonNullElse(termsVersionAgreed, TERMSOFUSEVERSION.PRE_2022);</span>
  }

  public void delete() {
<span class="nc" id="L389">    this.deleteMe = true;</span>
<span class="nc" id="L390">    this.organisationName = null;</span>
<span class="nc" id="L391">    this.departmentName = null;</span>
<span class="nc" id="L392">    this.firstName = null;</span>
<span class="nc" id="L393">    this.lastName = null;</span>
<span class="nc" id="L394">    this.email = null;</span>
<span class="nc" id="L395">    this.country = null;</span>
<span class="nc" id="L396">    this.postalCode = null;</span>
<span class="nc" id="L397">    this.city = null;</span>
<span class="nc" id="L398">    this.street = null;</span>
<span class="nc" id="L399">    this.streetNo = null;</span>
<span class="nc" id="L400">    this.contactMe = false;</span>
<span class="nc" id="L401">    this.systemType = null;</span>
<span class="nc" id="L402">    this.allowsStatistics = false;</span>
<span class="nc" id="L403">    this.allowsErrorReports = false;</span>
<span class="nc" id="L404">    this.dateModified = new Date();</span>
<span class="nc" id="L405">    this.agreedToPolicy = false;</span>
<span class="nc" id="L406">  }</span>

  public boolean shouldDelete() {
<span class="nc" id="L409">    return this.deleteMe;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>