<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>JpaFns.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-asset-manager-impl</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.assetmanager.impl.query</a> &gt; <span class="el_source">JpaFns.java</span></div><h1>JpaFns.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */
package org.opencastproject.assetmanager.impl.query;

import static com.entwinemedia.fn.Stream.$;

import org.opencastproject.util.data.Collections;

import com.entwinemedia.fn.Fn;
import com.entwinemedia.fn.Fn2;
import com.entwinemedia.fn.Fns;
import com.entwinemedia.fn.data.Opt;
import com.mysema.query.support.Expressions;
import com.mysema.query.types.EntityPath;
import com.mysema.query.types.Expression;
import com.mysema.query.types.expr.BooleanExpression;

import javax.annotation.Nullable;
import javax.annotation.ParametersAreNonnullByDefault;

@ParametersAreNonnullByDefault
public final class JpaFns {
  private JpaFns() {
  }

<span class="fc" id="L44">  static final Fn2&lt;BooleanExpression, BooleanExpression, BooleanExpression&gt; and =</span>
<span class="fc" id="L45">      new Fn2&lt;BooleanExpression, BooleanExpression, BooleanExpression&gt;() {</span>
        @Override public BooleanExpression apply(BooleanExpression left, BooleanExpression right) {
<span class="fc" id="L47">          return left.and(right);</span>
        }
      };
<span class="fc" id="L50">  static final Fn2&lt;BooleanExpression, BooleanExpression, BooleanExpression&gt; or =</span>
<span class="fc" id="L51">      new Fn2&lt;BooleanExpression, BooleanExpression, BooleanExpression&gt;() {</span>
        @Override public BooleanExpression apply(BooleanExpression left, BooleanExpression right) {
<span class="fc" id="L53">          return left.or(right);</span>
        }
      };
<span class="fc" id="L56">  static final Fn&lt;BooleanExpression, BooleanExpression&gt; not =</span>
<span class="fc" id="L57">      new Fn&lt;BooleanExpression, BooleanExpression&gt;() {</span>
        @Override public BooleanExpression apply(BooleanExpression expr) {
<span class="fc" id="L59">          return expr.not();</span>
        }
      };

  /**
   * Apply a boolean operation to two expressions. If one of the expressions is none the other one is returned.
   */
  static Opt&lt;BooleanExpression&gt; op(Fn2&lt;BooleanExpression, BooleanExpression, BooleanExpression&gt; f,
                                   Opt&lt;BooleanExpression&gt; a, Opt&lt;BooleanExpression&gt; b) {
<span class="pc bpc" id="L68" title="1 of 2 branches missed.">    if (a.isNone()) {</span>
<span class="nc" id="L69">      return b;</span>
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">    } else if (b.isNone()) {</span>
<span class="nc" id="L71">      return a;</span>
    } else {
<span class="fc" id="L73">      return Opt.some(f.apply(a.get(), b.get()));</span>
    }
  }

  /**
   * Apply a boolean operation to two expressions. If one of the expressions is none the other one is returned.
   */
  static Fn&lt;EntityPath&lt;?&gt;, BooleanExpression&gt; op(
          final Fn2&lt;BooleanExpression, BooleanExpression, BooleanExpression&gt; op,
          final Fn&lt;EntityPath&lt;?&gt;, BooleanExpression&gt; a,
          final Fn&lt;EntityPath&lt;?&gt;, BooleanExpression&gt; b) {
<span class="fc" id="L84">    return new Fn&lt;EntityPath&lt;?&gt;, BooleanExpression&gt;() {</span>
      @Override public BooleanExpression apply(EntityPath&lt;?&gt; entityPath) {
<span class="fc" id="L86">        return op.apply(a.apply(entityPath), b.apply(entityPath));</span>
      }
    };
  }

  /**
   * Combine expressions with boolean 'and' operation while removing all duplicate expressions.
   *
   * @return a combined expression or null, if the iterable is empty
   */
  @Nullable
  static BooleanExpression allOf(Iterable&lt;BooleanExpression&gt; expressions) {
<span class="fc" id="L98">    return Expressions.allOf(Collections.toArray(BooleanExpression.class, $(expressions).toSet()));</span>
  }

  /**
   * Combine expressions with boolean 'and' operation while removing all duplicate expressions.
   *
   * @return a combined expression or null, if the passed array is empty or all expressions are none
   */
  @SafeVarargs
  @Nullable
  static BooleanExpression allOf(Opt&lt;BooleanExpression&gt;... expressions) {
<span class="fc" id="L109">    return allOf($(expressions).bind(Fns.&lt;Opt&lt;BooleanExpression&gt;&gt;id()));</span>
  }

  /**
   * The function's return value may be null.
   */
  @SafeVarargs
  static Fn&lt;EntityPath&lt;?&gt;, BooleanExpression&gt; allOf(final Fn&lt;EntityPath&lt;?&gt;, BooleanExpression&gt;... expressions) {
<span class="fc" id="L117">    return new Fn&lt;EntityPath&lt;?&gt;, BooleanExpression&gt;() {</span>
      @Override public BooleanExpression apply(final EntityPath&lt;?&gt; entityPath) {
<span class="fc" id="L119">        return allOf($(expressions).map(new Fn&lt;Fn&lt;EntityPath&lt;?&gt;, BooleanExpression&gt;, BooleanExpression&gt;() {</span>
          @Override public BooleanExpression apply(Fn&lt;EntityPath&lt;?&gt;, BooleanExpression&gt; f) {
<span class="fc" id="L121">            return f.apply(entityPath);</span>
          }
        }));
      }
    };
  }

  /**
   * Combine expressions with boolean 'or' operation while removing all duplicate expressions.
   */
  @Nullable static BooleanExpression anyOf(Iterable&lt;BooleanExpression&gt; expressions) {
<span class="fc" id="L132">    return Expressions.anyOf(Collections.toArray(BooleanExpression.class, $(expressions).toSet()));</span>
  }

  /**
   * Convert expressions into an array while removing duplicates.
   */
  static Expression[] toExpressionArray(Iterable&lt;Expression&lt;?&gt;&gt; as) {
<span class="fc" id="L139">    return Collections.toArray(Expression.class, $(as).toSet());</span>
  }

  /**
   * Convert entity paths into an array while removing duplicates.
   */
  static EntityPath[] toEntityPathArray(Iterable&lt;EntityPath&lt;?&gt;&gt; as) {
<span class="fc" id="L146">    return Collections.toArray(EntityPath.class, $(as).toSet());</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>