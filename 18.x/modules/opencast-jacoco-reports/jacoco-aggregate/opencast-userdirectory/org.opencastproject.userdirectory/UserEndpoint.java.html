<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>UserEndpoint.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-userdirectory</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.userdirectory</a> &gt; <span class="el_source">UserEndpoint.java</span></div><h1>UserEndpoint.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.userdirectory;

import static org.apache.http.HttpStatus.SC_NOT_FOUND;
import static org.apache.http.HttpStatus.SC_OK;
import static org.opencastproject.util.doc.rest.RestParameter.Type.STRING;

import org.opencastproject.security.api.JaxbUser;
import org.opencastproject.security.api.JaxbUserList;
import org.opencastproject.security.api.User;
import org.opencastproject.security.api.UserDirectoryService;
import org.opencastproject.util.NotFoundException;
import org.opencastproject.util.doc.rest.RestParameter;
import org.opencastproject.util.doc.rest.RestQuery;
import org.opencastproject.util.doc.rest.RestResponse;
import org.opencastproject.util.doc.rest.RestService;

import org.apache.commons.lang3.StringUtils;
import org.osgi.service.component.annotations.Component;
import org.osgi.service.component.annotations.Reference;
import org.osgi.service.jaxrs.whiteboard.propertytypes.JaxrsResource;

import java.io.IOException;
import java.util.Iterator;

import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.PathParam;
import javax.ws.rs.Produces;
import javax.ws.rs.QueryParam;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;
import javax.ws.rs.core.Response.Status;

/**
 * Provides a sorted set of known users
 */
@Path(&quot;/users&quot;)
@RestService(
    name = &quot;users&quot;,
    title = &quot;User account manager&quot;,
    notes = &quot;This service offers the ability to manage the roles for internal accounts.&quot;,
    abstractText = &quot;Displays the users available in the current user's organization&quot;
)
@Component(
    property = {
        &quot;service.description=User listing REST endpoint&quot;,
        &quot;opencast.service.type=org.opencastproject.userdirectory.users&quot;,
        &quot;opencast.service.path=/users&quot;,
        &quot;opencast.service.jobproducer=false&quot;
    },
    immediate = true,
    service = { UserEndpoint.class }
)
@JaxrsResource
<span class="nc" id="L76">public class UserEndpoint {</span>

  /** The role directory service */
<span class="nc" id="L79">  protected UserDirectoryService userDirectoryService = null;</span>

  /**
   * Sets the user directory service
   *
   * @param userDirectoryService
   *          the userDirectoryService to set
   */
  @Reference
  public void setUserDirectoryService(UserDirectoryService userDirectoryService) {
<span class="nc" id="L89">    this.userDirectoryService = userDirectoryService;</span>
<span class="nc" id="L90">  }</span>

  @GET
  @Path(&quot;users.xml&quot;)
  @Produces(MediaType.APPLICATION_XML)
  @RestQuery(
      name = &quot;allusersasxml&quot;,
      description = &quot;Returns a list of users&quot;,
      returnDescription = &quot;Returns a XML representation of the list of user accounts&quot;,
      restParameters = {
          @RestParameter(
              name = &quot;query&quot;,
              description = &quot;The search query, must be at lest 3 characters long.&quot;,
              isRequired = false,
              type = RestParameter.Type.STRING
          ),
          @RestParameter(
              name = &quot;limit&quot;,
              defaultValue = &quot;100&quot;,
              description = &quot;The maximum number of items to return per page.&quot;,
              isRequired = false,
              type = RestParameter.Type.INTEGER
          ),
          @RestParameter(
              name = &quot;offset&quot;,
              defaultValue = &quot;0&quot;,
              description = &quot;The page number.&quot;,
              isRequired = false,
              type = RestParameter.Type.INTEGER
          ),
      },
      responses = { @RestResponse(responseCode = SC_OK, description = &quot;The user accounts.&quot;) }
  )
  public Response getUsersAsXml(
      @QueryParam(&quot;query&quot;) String queryString,
      @QueryParam(&quot;limit&quot;) int limit,
      @QueryParam(&quot;offset&quot;) int offset
  ) throws IOException {
<span class="nc bnc" id="L128" title="All 2 branches missed.">    if (limit &lt; 1) {</span>
<span class="nc" id="L129">      limit = 100;</span>
    }

<span class="nc" id="L132">    String query = &quot;%&quot;;</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">    if (StringUtils.isNotBlank(queryString)) {</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">      if (queryString.trim().length() &lt; 3) {</span>
<span class="nc" id="L135">        return Response.status(Status.BAD_REQUEST).build();</span>
      }
<span class="nc" id="L137">      query = queryString;</span>
    }

<span class="nc" id="L140">    JaxbUserList userList = new JaxbUserList();</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">    for (Iterator&lt;User&gt; i = userDirectoryService.findUsers(query, offset, limit); i.hasNext();) {</span>
<span class="nc" id="L142">      userList.add(i.next());</span>
    }
<span class="nc" id="L144">    return Response.ok(userList).build();</span>
  }

  @GET
  @Path(&quot;users.json&quot;)
  @Produces(MediaType.APPLICATION_JSON)
  @RestQuery(
      name = &quot;allusersasjson&quot;,
      description = &quot;Returns a list of users&quot;,
      returnDescription = &quot;Returns a JSON representation of the list of user accounts&quot;,
      restParameters = {
          @RestParameter(
              name = &quot;query&quot;,
              description = &quot;The search query, must be at lest 3 characters long.&quot;,
              isRequired = false,
              type = RestParameter.Type.STRING
          ),
          @RestParameter(
              name = &quot;limit&quot;,
              defaultValue = &quot;100&quot;,
              description = &quot;The maximum number of items to return per page.&quot;,
              isRequired = false,
              type = RestParameter.Type.INTEGER
          ),
          @RestParameter(
              name = &quot;offset&quot;,
              defaultValue = &quot;0&quot;,
              description = &quot;The page number.&quot;,
              isRequired = false,
              type = RestParameter.Type.INTEGER
          ),
      },
      responses = { @RestResponse(responseCode = SC_OK, description = &quot;The user accounts.&quot;) }
  )
  public Response getUsersAsJson(
      @QueryParam(&quot;query&quot;) String queryString,
      @QueryParam(&quot;limit&quot;) int limit,
      @QueryParam(&quot;offset&quot;) int offset
  ) throws IOException {
<span class="nc" id="L183">    return getUsersAsXml(queryString, limit, offset);</span>
  }

  @GET
  @Path(&quot;{username}.xml&quot;)
  @Produces(MediaType.APPLICATION_XML)
  @RestQuery(
      name = &quot;user&quot;,
      description = &quot;Returns a user&quot;,
      returnDescription = &quot;Returns a XML representation of a user&quot;,
      pathParameters = {
          @RestParameter(description = &quot;The username.&quot;, isRequired = true, name = &quot;username&quot;, type = STRING),
      },
      responses = {
          @RestResponse(responseCode = SC_OK, description = &quot;The user account.&quot;),
          @RestResponse(responseCode = SC_NOT_FOUND, description = &quot;User not found&quot;),
      }
  )
  public JaxbUser getUserAsXml(@PathParam(&quot;username&quot;) String username) throws NotFoundException {
<span class="nc" id="L202">    User user = userDirectoryService.loadUser(username);</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">    if (user == null) {</span>
<span class="nc" id="L204">      throw new NotFoundException();</span>
    }
<span class="nc" id="L206">    return JaxbUser.fromUser(user);</span>
  }

  @GET
  @Path(&quot;{username}.json&quot;)
  @Produces(MediaType.APPLICATION_JSON)
  @RestQuery(
      name = &quot;user&quot;,
      description = &quot;Returns a user&quot;,
      returnDescription = &quot;Returns a JSON representation of a user&quot;,
      pathParameters = {
          @RestParameter(description = &quot;The username.&quot;, isRequired = true, name = &quot;username&quot;, type = STRING),
      },
      responses = {
          @RestResponse(responseCode = SC_OK, description = &quot;The user account.&quot;),
          @RestResponse(responseCode = SC_NOT_FOUND, description = &quot;User not found&quot;),
      }
  )
  public JaxbUser getUserAsJson(@PathParam(&quot;username&quot;) String username) throws NotFoundException {
<span class="nc" id="L225">    return getUserAsXml(username);</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>