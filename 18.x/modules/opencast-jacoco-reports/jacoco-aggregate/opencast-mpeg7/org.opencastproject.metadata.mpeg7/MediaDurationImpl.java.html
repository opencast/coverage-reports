<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>MediaDurationImpl.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-mpeg7</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.metadata.mpeg7</a> &gt; <span class="el_source">MediaDurationImpl.java</span></div><h1>MediaDurationImpl.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */


package org.opencastproject.metadata.mpeg7;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;

import java.util.Formatter;

/**
 * TODO: Comment me!
 */
public class MediaDurationImpl implements MediaDuration {

  /** Time delimiter */
  private static final String TimeDelimiter = &quot;T&quot;;

  /** Day delimiter */
  private static final String DayDelimiter = &quot;D&quot;;

  /** Hour delimiter */
  private static final String HourDelimiter = &quot;H&quot;;

  /** Minute delimiter */
  private static final String MinuteDelimiter = &quot;M&quot;;

  /** Seconds delimiter */
  private static final String SecondsDelimiter = &quot;S&quot;;

  /** Fractions delimiter */
  private static final String FractionDelimiter = &quot;N&quot;;

  /** Fractions per second delimiter */
  private static final String FPSDelimiter = &quot;F&quot;;

  /** Number of milliseconds per day */
  private static final long MS_PER_DAY = 86400000L;

  /** Number of milliseconds per hour */
  private static final long MS_PER_HOUR = 3600000L;

  /** Number of milliseconds per minute */
  private static final long MS_PER_MINUTE = 60000L;

  /** Number of milliseconds per second */
  private static final long MS_PER_SECOND = 1000L;

<span class="fc" id="L69">  private int days = 0;</span>
<span class="fc" id="L70">  private int hours = 0;</span>
<span class="fc" id="L71">  private int minutes = 0;</span>
<span class="fc" id="L72">  private int seconds = 0;</span>
<span class="fc" id="L73">  private int fractions = 0;</span>
<span class="fc" id="L74">  private int fractionsPerSecond = 0;</span>

  /**
   * Creates a media duration representing &lt;code&gt;PD0T00H00M00S00N0F&lt;/code&gt;.
   */
<span class="fc" id="L79">  public MediaDurationImpl() {</span>
<span class="fc" id="L80">    days = 0;</span>
<span class="fc" id="L81">    hours = 0;</span>
<span class="fc" id="L82">    minutes = 0;</span>
<span class="fc" id="L83">    seconds = 0;</span>
<span class="fc" id="L84">    fractions = 0;</span>
<span class="fc" id="L85">    fractionsPerSecond = 0;</span>
<span class="fc" id="L86">  }</span>

  /**
   * Creates a media duration representing the given long value.
   */
<span class="fc" id="L91">  public MediaDurationImpl(long milliseconds) {</span>
<span class="fc" id="L92">    fractions = (int) (milliseconds % MS_PER_SECOND);</span>
<span class="fc" id="L93">    seconds = (int) ((milliseconds / MS_PER_SECOND) % 60);</span>
<span class="fc" id="L94">    minutes = (int) ((milliseconds / MS_PER_MINUTE) % 60);</span>
<span class="fc" id="L95">    hours = (int) ((milliseconds / MS_PER_HOUR) % 24);</span>
<span class="fc" id="L96">    days = (int) (milliseconds / MS_PER_DAY);</span>
<span class="fc" id="L97">    hours += days * 24;</span>
<span class="fc" id="L98">    fractionsPerSecond = 1000;</span>
<span class="fc" id="L99">  }</span>

  /**
   * Parses a duration text representation.
   *
   * @param text
   *          the duration text representation
   * @return the media duration object
   * @throws IllegalArgumentException
   *           if the text is not in the right format
   */
  public static MediaDuration parseDuration(String text) throws IllegalArgumentException {
<span class="fc" id="L111">    MediaDurationImpl mediaDuration = new MediaDurationImpl();</span>
<span class="fc" id="L112">    mediaDuration.parse(text);</span>
<span class="fc" id="L113">    return mediaDuration;</span>
  }

  /**
   * Parses a duration text representation.
   *
   * @param text
   *          the duration text representation
   * @throws IllegalArgumentException
   *           if the text is not in the right format
   */
  public void parse(String text) throws IllegalArgumentException {
<span class="fc" id="L125">    int index = 0;</span>
<span class="pc bpc" id="L126" title="2 of 4 branches missed.">    if ((!text.startsWith(&quot;P&quot;)) || (!text.contains(TimeDelimiter)))</span>
<span class="nc" id="L127">      throw new IllegalArgumentException();</span>
<span class="pc bpc" id="L128" title="1 of 2 branches missed.">    if (text.contains(DayDelimiter)) {</span>
<span class="nc" id="L129">      days = Integer.parseInt(text.substring(1, text.indexOf(DayDelimiter)));</span>
    }
<span class="fc" id="L131">    index = text.indexOf(TimeDelimiter);</span>
<span class="fc bfc" id="L132" title="All 2 branches covered.">    if (text.contains(HourDelimiter)) {</span>
<span class="fc" id="L133">      hours = Short.parseShort(text.substring(index + 1, text.indexOf(HourDelimiter)));</span>
<span class="fc" id="L134">      index = text.indexOf(HourDelimiter);</span>
    }
<span class="fc bfc" id="L136" title="All 2 branches covered.">    if (text.contains(MinuteDelimiter)) {</span>
<span class="fc" id="L137">      minutes = Short.parseShort(text.substring(index + 1, text.indexOf(MinuteDelimiter)));</span>
<span class="fc" id="L138">      index = text.indexOf(MinuteDelimiter);</span>
    }
<span class="fc bfc" id="L140" title="All 2 branches covered.">    if (text.contains(SecondsDelimiter)) {</span>
<span class="fc" id="L141">      seconds = Short.parseShort(text.substring(index + 1, text.indexOf(SecondsDelimiter)));</span>
<span class="fc" id="L142">      index = text.indexOf(SecondsDelimiter);</span>
    }
<span class="fc bfc" id="L144" title="All 2 branches covered.">    if (text.contains(FractionDelimiter)) {</span>
<span class="fc" id="L145">      fractions = Integer.parseInt(text.substring(index + 1, text.indexOf(FractionDelimiter)));</span>
<span class="fc" id="L146">      index = text.indexOf(FractionDelimiter);</span>
    }
<span class="fc bfc" id="L148" title="All 2 branches covered.">    if (text.contains(FPSDelimiter)) {</span>
<span class="fc" id="L149">      fractionsPerSecond = Integer.parseInt(text.substring(index + 1, text.indexOf(FPSDelimiter)));</span>
    }
<span class="fc" id="L151">  }</span>

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaDuration#getDays()
   */
  public int getDays() {
<span class="fc" id="L157">    return days;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaDuration#getFractions()
   */
  public int getFractions() {
<span class="nc" id="L164">    return fractions;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaDuration#getFractionsPerSecond()
   */
  public int getFractionsPerSecond() {
<span class="nc" id="L171">    return fractionsPerSecond;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaDuration#getHours()
   */
  public int getHours() {
<span class="fc" id="L178">    return hours;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaDuration#getMinutes()
   */
  public int getMinutes() {
<span class="fc" id="L185">    return minutes;</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaDuration#getSeconds()
   */
  public int getSeconds() {
<span class="fc" id="L192">    return seconds;</span>
  }

  /**
   * Sets the number of days.
   *
   * @param days
   */
  public void setDayDuration(int days) {
<span class="nc" id="L201">    this.days = days;</span>
<span class="nc" id="L202">  }</span>

  /**
   * Sets the number of fractions.
   *
   * @param fractions
   *          the fractions
   */
  public void setFractionDuration(int fractions) {
<span class="nc" id="L211">    this.fractions = fractions;</span>
<span class="nc" id="L212">  }</span>

  /**
   * Sets the number of fractions per second.
   *
   * @param fractionsPerSecond
   *          the fractions per second
   */
  public void setFractionsPerSecond(int fractionsPerSecond) {
<span class="nc" id="L221">    this.fractionsPerSecond = fractionsPerSecond;</span>
<span class="nc" id="L222">  }</span>

  /**
   * Sets the number of hours.
   *
   * @param hours
   *          the hours
   */
  public void setHourDuration(short hours) {
<span class="nc" id="L231">    this.hours = hours;</span>
<span class="nc" id="L232">  }</span>

  /**
   * Sets the number of minutes.
   *
   * @param minutes
   *          the number of minutes
   */
  public void setMinuteDuration(short minutes) {
<span class="nc" id="L241">    this.minutes = minutes;</span>
<span class="nc" id="L242">  }</span>

  /**
   * Sets the number of seconds.
   *
   * @param seconds
   *          the number of seconds
   */
  public void setSecondDuration(short seconds) {
<span class="nc" id="L251">    this.seconds = seconds;</span>
<span class="nc" id="L252">  }</span>

  /**
   * @see java.lang.Object#toString()
   */
  @Override
  public String toString() {
<span class="fc" id="L259">    StringBuffer returnString = new StringBuffer(&quot;PT&quot;);</span>
<span class="fc" id="L260">    Formatter f = new Formatter(returnString);</span>
<span class="fc bfc" id="L261" title="All 2 branches covered.">    if (hours != 0) {</span>
<span class="fc" id="L262">      f.format(&quot;%02d&quot; + HourDelimiter, hours);</span>
    }
<span class="fc bfc" id="L264" title="All 2 branches covered.">    if (minutes != 0) {</span>
<span class="fc" id="L265">      f.format(&quot;%02d&quot; + MinuteDelimiter, minutes);</span>
    }
<span class="fc bfc" id="L267" title="All 2 branches covered.">    if (seconds != 0) {</span>
<span class="fc" id="L268">      f.format(&quot;%02d&quot; + SecondsDelimiter, seconds);</span>
    }
<span class="fc bfc" id="L270" title="All 2 branches covered.">    if (fractionsPerSecond != 0) {</span>
<span class="fc" id="L271">      f.format(&quot;%d&quot; + FractionDelimiter + &quot;%d&quot; + FPSDelimiter, fractions, fractionsPerSecond);</span>
    }
<span class="fc" id="L273">    f.close();</span>
<span class="fc" id="L274">    return returnString.toString();</span>
  }

  /**
   * @see org.opencastproject.metadata.mpeg7.MediaDuration#getDurationInMilliseconds()
   */
  public long getDurationInMilliseconds() {
<span class="fc" id="L281">    long s = seconds * MS_PER_SECOND;</span>
<span class="fc" id="L282">    s += minutes * MS_PER_MINUTE;</span>
<span class="fc" id="L283">    s += hours * MS_PER_HOUR;</span>
<span class="fc" id="L284">    s += days * MS_PER_DAY;</span>
<span class="fc bfc" id="L285" title="All 2 branches covered.">    if (fractionsPerSecond &gt; 0)</span>
<span class="fc" id="L286">      s += (fractions * 1000L / fractionsPerSecond);</span>
<span class="fc" id="L287">    return s;</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see java.lang.Object#hashCode()
   */
  @Override
  public int hashCode() {
<span class="nc" id="L297">    return super.hashCode();</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see java.lang.Object#equals(java.lang.Object)
   */
  @Override
  public boolean equals(Object obj) {
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">    if (obj instanceof MediaDuration)</span>
<span class="pc bpc" id="L308" title="1 of 2 branches missed.">      return ((MediaDuration) obj).getDurationInMilliseconds() == getDurationInMilliseconds();</span>
<span class="nc" id="L309">    return false;</span>
  }

  /**
   * @see org.opencastproject.mediapackage.XmlElement#toXml(org.w3c.dom.Document)
   */
  public Node toXml(Document document) {
<span class="fc" id="L316">    Element node = document.createElement(&quot;MediaDuration&quot;);</span>
<span class="fc" id="L317">    node.setTextContent(toString());</span>
<span class="fc" id="L318">    return node;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>