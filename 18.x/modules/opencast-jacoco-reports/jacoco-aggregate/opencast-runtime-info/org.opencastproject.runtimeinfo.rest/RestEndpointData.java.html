<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>RestEndpointData.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-runtime-info</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.runtimeinfo.rest</a> &gt; <span class="el_source">RestEndpointData.java</span></div><h1>RestEndpointData.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.runtimeinfo.rest;

import static org.apache.commons.lang3.StringUtils.isBlank;

import org.opencastproject.util.JaxbXmlSchemaGenerator;
import org.opencastproject.util.doc.DocData;
import org.opencastproject.util.doc.rest.RestParameter;
import org.opencastproject.util.doc.rest.RestResponse;

import org.apache.commons.lang3.StringEscapeUtils;

import java.util.ArrayList;
import java.util.List;
import java.util.Vector;

public class RestEndpointData implements Comparable&lt;RestEndpointData&gt; {

  /**
   * The name of the endpoint, which should be unique. In the documentation page, the same type of endpoints are shown
   * in ascending order of name.
   */
  private String name;

  /**
   * The HTTP method used to invoke the endpoint.
   */
  private String httpMethod;

  /**
   * The path for this endpoint (e.g. /search OR /add/{id}).
   */
  private String path;

  /**
   * The description of this endpoint.
   */
  private String description;

  /**
   * The body parameter of this endpoint.
   */
  private RestParamData bodyParam;

  /**
   * The list of path parameters of this endpoint.
   */
  private List&lt;RestParamData&gt; pathParams;

  /**
   * The list of required query parameters of this endpoint.
   */
  private List&lt;RestParamData&gt; requiredParams;

  /**
   * The list of optional query parameters of this endpoint.
   */
  private List&lt;RestParamData&gt; optionalParams;

  /**
   * The list of notes (i.e. extra information) of this endpoint.
   */
  private List&lt;String&gt; notes;

  /**
   * The list of formats returned by this endpoint.
   */
  private List&lt;RestFormatData&gt; formats;

  /**
   * The list of HTTP responses returned by this endpoint.
   */
  private List&lt;StatusData&gt; statuses;

  /**
   * The form for testing this endpoint in the documentation page.
   */
  private RestFormData form;

  /** The XML schema for data returned by this endpoint. */
<span class="fc" id="L101">  private String returnTypeSchema = null;</span>

  /**
   * Create a new basic endpoint, you should use the add methods to fill in the rest of the information about the
   * endpoint data
   *
   * @param returnType
   *          the endpoint's return type
   * @param name
   *          the endpoint's name (this should be unique in the same type of endpoints)
   * @param httpMethod
   *          the HTTP method used for this endpoint
   * @param path
   *          the path for this endpoint (e.g. /search OR /add/{id})
   * @param description
   *          [optional] the description of this endpoint
   * @throws IllegalArgumentException
   *           if name is null, name is not alphanumeric, method is null, path is null or path is not valid.
   */
  public RestEndpointData(Class&lt;?&gt; returnType, String name, String httpMethod, String path, String description)
<span class="fc" id="L121">          throws IllegalArgumentException {</span>
<span class="pc bpc" id="L122" title="1 of 2 branches missed.">    if (!DocData.isValidName(name)) {</span>
<span class="nc" id="L123">      throw new IllegalArgumentException(&quot;Name must not be null and must be alphanumeric.&quot;);</span>
    }
<span class="pc bpc" id="L125" title="2 of 4 branches missed.">    if ((httpMethod == null) || (httpMethod.isEmpty())) {</span>
<span class="nc" id="L126">      throw new IllegalArgumentException(&quot;Method must not be null and must not be empty.&quot;);</span>
    }
<span class="pc bpc" id="L128" title="1 of 2 branches missed.">    if (!RestDocData.isValidPath(path)) {</span>
<span class="nc" id="L129">      throw new IllegalArgumentException(String.format(&quot;Path '%s' must not be null and must look something like &quot;</span>
              + &quot;/a/b/{c}.&quot;, path));
    }
<span class="fc" id="L132">    this.returnTypeSchema = JaxbXmlSchemaGenerator.getXmlSchema(returnType);</span>
<span class="fc" id="L133">    this.name = name;</span>
<span class="fc" id="L134">    this.httpMethod = httpMethod.toUpperCase();</span>
<span class="fc" id="L135">    this.path = path;</span>
<span class="fc" id="L136">    this.description = description;</span>
<span class="fc" id="L137">  }</span>

  /**
   * Returns a string representation of this object.
   *
   * @return a string representation of this object
   */
  @Override
  public String toString() {
<span class="nc" id="L146">    return &quot;ENDP:&quot; + name + &quot;:&quot; + httpMethod + &quot; &quot; + path + &quot; :body=&quot; + bodyParam + &quot; :req=&quot; + requiredParams</span>
            + &quot; :opt=&quot; + optionalParams + &quot; :formats=&quot; + formats + &quot; :status=&quot; + statuses + &quot; :form=&quot; + form;
  }

  /**
   * Adds a body parameter to this endpoint. Once added, the body parameter becomes a required parameter.
   *
   * @param restParam
   *          a RestParameter annotation object corresponding to the body parameter
   *
   * @return the new RestParamData object in case you want to set attributes
   */
  public RestParamData addBodyParam(RestParameter restParam) {
<span class="fc" id="L159">    RestParamData.Type type = RestParamData.Type.valueOf(restParam.type().name());</span>
<span class="fc" id="L160">    RestParamData param = new RestParamData(&quot;BODY&quot;, type, restParam.defaultValue(),</span>
<span class="fc" id="L161">            restParam.description(), null);</span>
<span class="fc" id="L162">    param.setRequired(true);</span>
<span class="fc" id="L163">    bodyParam = param;</span>
<span class="fc" id="L164">    return param;</span>
  }

  /**
   * Adds a path parameter for this endpoint, this would be a parameter which is passed as part of the path (e.g.
   * /my/path/{param}) and thus must use a name which is safe to be placed in a URL and does not contain a slash (/)
   *
   * @param param
   *          the path parameter to add
   * @throws IllegalStateException
   *           if the type of the path parameter is FILE or TEXT
   */
  public void addPathParam(RestParamData param) throws IllegalStateException {
<span class="pc bpc" id="L177" title="1 of 2 branches missed.">    if (RestParamData.Type.FILE.name().equals(param.getType())</span>
<span class="pc bpc" id="L178" title="1 of 2 branches missed.">            || RestParamData.Type.TEXT.name().equals(param.getType())) {</span>
<span class="nc" id="L179">      throw new IllegalStateException(&quot;Cannot add path param of type FILE or TEXT.&quot;);</span>
    }
<span class="fc" id="L181">    param.setRequired(true);</span>
<span class="fc" id="L182">    param.setPath(true);</span>
<span class="pc bpc" id="L183" title="1 of 2 branches missed.">    if (pathParams == null) {</span>
<span class="fc" id="L184">      pathParams = new Vector&lt;RestParamData&gt;(3);</span>
    }
<span class="fc" id="L186">    pathParams.add(param);</span>
<span class="fc" id="L187">  }</span>

  /**
   * Adds a required form parameter for this endpoint, this would be a parameter which is passed encoded as part of the
   * request body (commonly referred to as a post or form parameter). &lt;br&gt;
   * WARNING: This should generally be reserved for endpoints which are used for processing, it is better to use path
   * params unless the required parameter is not part of an identifier for the resource.
   *
   * @param param
   *          the required parameter to add
   */
  public void addRequiredParam(RestParamData param) throws IllegalStateException {
<span class="fc" id="L199">    param.setRequired(true);</span>
<span class="fc" id="L200">    param.setPath(false);</span>
<span class="pc bpc" id="L201" title="1 of 2 branches missed.">    if (requiredParams == null) {</span>
<span class="fc" id="L202">      requiredParams = new Vector&lt;RestParamData&gt;(3);</span>
    }
<span class="fc" id="L204">    requiredParams.add(param);</span>
<span class="fc" id="L205">  }</span>

  /**
   * Adds an optional parameter for this endpoint, this would be a parameter which is passed in the query string (for
   * GET) or encoded as part of the body otherwise (often referred to as a post or form parameter).
   *
   * @param param
   *          the optional parameter to add
   */
  public void addOptionalParam(RestParamData param) {
<span class="fc" id="L215">    param.setRequired(false);</span>
<span class="fc" id="L216">    param.setPath(false);</span>
<span class="pc bpc" id="L217" title="1 of 2 branches missed.">    if (optionalParams == null) {</span>
<span class="fc" id="L218">      optionalParams = new Vector&lt;RestParamData&gt;(3);</span>
    }
<span class="fc" id="L220">    optionalParams.add(param);</span>
<span class="fc" id="L221">  }</span>

  /**
   * Adds a format for the return data for this endpoint.
   *
   * @param format
   *          a RestFormatData object
   */
  public void addFormat(RestFormatData format) {
<span class="pc bpc" id="L230" title="1 of 2 branches missed.">    if (formats == null) {</span>
<span class="fc" id="L231">      formats = new Vector&lt;RestFormatData&gt;(2);</span>
    }
<span class="fc" id="L233">    formats.add(format);</span>
<span class="fc" id="L234">  }</span>

  /**
   * Adds a response status for this endpoint.
   *
   * @param restResponse
   *          a RestResponse object containing the HTTP response code and description
   */
  public void addStatus(RestResponse restResponse) {
<span class="fc bfc" id="L243" title="All 2 branches covered.">    if (statuses == null) {</span>
<span class="fc" id="L244">      statuses = new Vector&lt;StatusData&gt;(3);</span>
    }
<span class="fc" id="L246">    statuses.add(new StatusData(restResponse));</span>
<span class="fc" id="L247">  }</span>

  /**
   * Adds a note for this endpoint.
   *
   * @param note
   *          a string providing more information about this endpoint
   * @throws IllegalArgumentException
   *           if note is blank (e.g. null, empty string)
   */
  public void addNote(String note) throws IllegalArgumentException {
<span class="pc bpc" id="L258" title="1 of 2 branches missed.">    if (isBlank(note)) {</span>
<span class="nc" id="L259">      throw new IllegalArgumentException(&quot;Note must not be null or blank.&quot;);</span>
    }
<span class="pc bpc" id="L261" title="1 of 2 branches missed.">    if (notes == null) {</span>
<span class="fc" id="L262">      notes = new Vector&lt;String&gt;(3);</span>
    }
<span class="fc" id="L264">    notes.add(note);</span>
<span class="fc" id="L265">  }</span>

  /**
   * Sets the test form for this endpoint, if this is null then no test form is rendered for this endpoint.
   *
   * @param form
   *          the test form object (null to clear the form)
   */
  public void setTestForm(RestFormData form) {
<span class="nc" id="L274">    this.form = form;</span>
<span class="nc" id="L275">  }</span>

  /**
   * Returns whether this endpoint's HTTP method is GET
   *
   * @return true if this endpoint method is GET, otherwise false
   */
  public boolean isGetMethod() {
<span class="nc" id="L283">    return &quot;GET&quot;.equals(httpMethod);</span>
  }

  /**
   * Returns the URL-encoded query string for a GET endpoint.
   *
   * @return the calculated query string for a GET endpoint (e.g. ?blah=1), will be urlencoded for html display
   */
  public String getQueryString() {
<span class="nc" id="L292">    String qs = &quot;&quot;;</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">    if (isGetMethod()) {</span>
<span class="nc bnc" id="L294" title="All 4 branches missed.">      if (optionalParams != null &amp;&amp; !optionalParams.isEmpty()) {</span>
<span class="nc" id="L295">        StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L296">        sb.append(&quot;?&quot;);</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">        for (RestParamData p : optionalParams) {</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">          if (sb.length() &gt; 2) {</span>
<span class="nc" id="L299">            sb.append(&quot;&amp;&quot;);</span>
          }
<span class="nc" id="L301">          sb.append(p.getName());</span>
<span class="nc" id="L302">          sb.append(&quot;=&quot;);</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">          if (p.getDefaultValue() != null) {</span>
<span class="nc" id="L304">            sb.append(p.getDefaultValue());</span>
          } else {
<span class="nc" id="L306">            sb.append(&quot;{&quot;);</span>
<span class="nc" id="L307">            sb.append(p.getName());</span>
<span class="nc" id="L308">            sb.append(&quot;}&quot;);</span>
          }
<span class="nc" id="L310">        }</span>
<span class="nc" id="L311">        qs = StringEscapeUtils.escapeHtml4(sb.toString());</span>
      }
    }
<span class="nc" id="L314">    return qs;</span>
  }

  /**
   * Gets the name of this endpoint.
   *
   * @return the name of this endpoint
   */
  public String getName() {
<span class="fc" id="L323">    return name;</span>
  }

  /**
   * Gets the name of HTTP method used to invoke this endpoint.
   *
   * @return the name of HTTP method used to invoke this endpoint
   */
  public String getMethod() {
<span class="fc" id="L332">    return httpMethod;</span>
  }

  /**
   * Gets the path for this endpoint.
   *
   * @return the path for this endpoint
   */
  public String getPath() {
<span class="fc" id="L341">    return path;</span>
  }

  /**
   * Gets the description of this endpoint.
   *
   * @return the description of this endpoint
   */
  public String getDescription() {
<span class="fc" id="L350">    return description;</span>
  }

  /**
   * Gets the body parameter of this endpoint.
   *
   * @return the body parameter of this endpoint
   */
  public RestParamData getBodyParam() {
<span class="fc" id="L359">    return bodyParam;</span>
  }

  /**
   * Gets the list of path parameters of this endpoint.
   *
   * @return the list of path parameters of this endpoint
   */
  public List&lt;RestParamData&gt; getPathParams() {
<span class="pc bpc" id="L368" title="1 of 2 branches missed.">    if (pathParams == null) {</span>
<span class="nc" id="L369">      pathParams = new ArrayList&lt;RestParamData&gt;(0);</span>
    }
<span class="fc" id="L371">    return pathParams;</span>
  }

  /**
   * Gets the list of required parameters of this endpoint.
   *
   * @return the list of required parameters of this endpoint
   */
  public List&lt;RestParamData&gt; getRequiredParams() {
<span class="pc bpc" id="L380" title="1 of 2 branches missed.">    if (requiredParams == null) {</span>
<span class="nc" id="L381">      requiredParams = new ArrayList&lt;RestParamData&gt;(0);</span>
    }
<span class="fc" id="L383">    return requiredParams;</span>
  }

  /**
   * Gets the list of optional parameters of this endpoint.
   *
   * @return list of optional parameters of this endpoint
   */
  public List&lt;RestParamData&gt; getOptionalParams() {
<span class="pc bpc" id="L392" title="1 of 2 branches missed.">    if (optionalParams == null) {</span>
<span class="nc" id="L393">      optionalParams = new ArrayList&lt;RestParamData&gt;(0);</span>
    }
<span class="fc" id="L395">    return optionalParams;</span>
  }

  /**
   * Gets the list of formats returned by this endpoint.
   *
   * @return the list of formats returned by this endpoint
   */
  public List&lt;RestFormatData&gt; getFormats() {
<span class="pc bpc" id="L404" title="1 of 2 branches missed.">    if (formats == null) {</span>
<span class="nc" id="L405">      formats = new ArrayList&lt;RestFormatData&gt;(0);</span>
    }
<span class="fc" id="L407">    return formats;</span>
  }

  /**
   * Gets the list of HTTP responses returned by this endpoint.
   *
   * @return the list of HTTP responses returned by this endpoint
   */
  public List&lt;StatusData&gt; getStatuses() {
<span class="pc bpc" id="L416" title="1 of 2 branches missed.">    if (statuses == null) {</span>
<span class="nc" id="L417">      statuses = new ArrayList&lt;StatusData&gt;(0);</span>
    }
<span class="fc" id="L419">    return statuses;</span>
  }

  /**
   * Gets list of notes (i.e. extra information) of this endpoint.
   *
   * @return the list of notes (i.e. extra information) of this endpoint
   */
  public List&lt;String&gt; getNotes() {
<span class="pc bpc" id="L428" title="1 of 2 branches missed.">    if (notes == null) {</span>
<span class="nc" id="L429">      notes = new ArrayList&lt;&gt;(0);</span>
    }
<span class="fc" id="L431">    return notes;</span>
  }

  /**
   * Gets the form for testing this endpoint in the documentation page.
   *
   * @return the form for testing this endpoint in the documentation page
   */
  public RestFormData getForm() {
<span class="nc" id="L440">    return form;</span>
  }

  /**
   * Compares two RestEndpointData by their names so that the list of endpoints can be sorted.
   *
   * @param otherEndpoint
   *          the other endpoint object to compare to
   *
   * @return a negative integer, zero, or a positive integer as the name of the supplied endpoint is greater than, equal
   *         to, or less than this endpoint, ignoring case considerations.
   */
  @Override
  public int compareTo(RestEndpointData otherEndpoint) {
<span class="nc" id="L454">    return name.compareToIgnoreCase(otherEndpoint.name);</span>
  }

  /**
   * @return the XML schema for this endpoint's return type
   */
  public String getReturnTypeSchema() {
<span class="nc" id="L461">    return returnTypeSchema;</span>
  }

  public String getEscapedReturnTypeSchema() {
<span class="nc" id="L465">    return StringEscapeUtils.escapeXml(returnTypeSchema);</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>