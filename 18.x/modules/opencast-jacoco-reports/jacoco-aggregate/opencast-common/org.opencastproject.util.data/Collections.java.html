<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Collections.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-common</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.util.data</a> &gt; <span class="el_source">Collections.java</span></div><h1>Collections.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */

package org.opencastproject.util.data;

import static org.opencastproject.util.data.Option.some;

import java.lang.reflect.Array;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Dictionary;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Hashtable;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.NoSuchElementException;
import java.util.Set;

/**
 * This class provides functions to ease and secure the handling of collections by supporting a type safe -- at least to
 * the extent Java's type system allows -- immutable and more functional style.
 *
 * Note that all functions do &lt;i&gt;not&lt;/i&gt; mutate input collections unless otherwise stated.
 *
 * @deprecated By now, all of this is natively available in Java.
 */
@Deprecated
public final class Collections {
  private Collections() {
  }

  // TODO check all clients of this method since it potentially breaks!
  @SuppressWarnings(&quot;unchecked&quot;)
  private static &lt;A, B&gt; Collection&lt;A&gt; buildFrom(Collection&lt;B&gt; as) {
    try {
<span class="fc" id="L56">      return as.getClass().newInstance();</span>
<span class="nc" id="L57">    } catch (Exception e) {</span>
<span class="nc" id="L58">      throw new IllegalArgumentException(&quot;Type &quot; + as.getClass() + &quot; needs a parameterless constructor&quot;);</span>
    }
  }

  /**
   * Apply a function &lt;code&gt;f&lt;/code&gt; to all elements of collection &lt;code&gt;as&lt;/code&gt; to produce a new collection
   * &lt;code&gt;bs&lt;/code&gt;.
   *
   * An (empty) instance of the target collection has to be provided explicitly.
   *
   * @param as
   *          the source collection
   * @param bs
   *          the (empty) target collection
   * @param f
   *          the function to apply to each element of &lt;code&gt;as&lt;/code&gt;
   * @deprecated use {@link Monadics}
   */
  @Deprecated
  public static &lt;A, B, M extends Collection&lt;B&gt;&gt; M map(Collection&lt;A&gt; as, M bs, Function&lt;A, B&gt; f) {
<span class="nc bnc" id="L78" title="All 2 branches missed.">    for (A x : as) {</span>
<span class="nc" id="L79">      bs.add(f.apply(x));</span>
<span class="nc" id="L80">    }</span>
<span class="nc" id="L81">    return bs;</span>
  }

  /**
   * Apply a function &lt;code&gt;f&lt;/code&gt; to all elements of collection &lt;code&gt;as&lt;/code&gt; to produce a new collection
   * &lt;code&gt;bs&lt;/code&gt;.
   *
   * The type of collection &lt;code&gt;as&lt;/code&gt; needs a parameterless constructor.
   *
   * Please note that since java does not support higher-order polymorphism -- which is needed to capture the type of
   * the collection -- some casting on the client side may still be necessary.
   *
   * @throws RuntimeException
   *           if the target collection cannot be created
   * @deprecated use {@link Monadics}
   */
  @Deprecated
  public static &lt;A, B&gt; Collection&lt;B&gt; map(Collection&lt;A&gt; as, Function&lt;A, B&gt; f) {
<span class="fc" id="L99">    Collection&lt;B&gt; b = buildFrom(as);</span>
<span class="fc bfc" id="L100" title="All 2 branches covered.">    for (A x : as) {</span>
<span class="fc" id="L101">      b.add(f.apply(x));</span>
<span class="fc" id="L102">    }</span>
<span class="fc" id="L103">    return b;</span>
  }

  /**
   * Return a new collection containing only the elements that satisfy predicate &lt;code&gt;p&lt;/code&gt;.
   *
   * The type of collection &lt;code&gt;as&lt;/code&gt; needs a parameterless constructor.
   *
   * @deprecated use {@link Monadics}
   */
  @Deprecated
  public static &lt;A, M extends Collection&lt;A&gt;&gt; M filter(M as, Predicate&lt;A&gt; p) {
    @SuppressWarnings(&quot;unchecked&quot;)
<span class="fc" id="L116">    final M filtered = (M) buildFrom(as);</span>
<span class="fc bfc" id="L117" title="All 2 branches covered.">    for (A a : as) {</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">      if (p.apply(a))</span>
<span class="fc" id="L119">        filtered.add(a);</span>
<span class="fc" id="L120">    }</span>
<span class="fc" id="L121">    return filtered;</span>
  }

  /** Return the head of list &lt;code&gt;as&lt;/code&gt; or &lt;code&gt;none&lt;/code&gt;. */
  public static &lt;A&gt; Option&lt;A&gt; head(List&lt;A&gt; as) {
<span class="fc bfc" id="L126" title="All 2 branches covered.">    if (!as.isEmpty()) {</span>
<span class="fc" id="L127">      return some(as.get(0));</span>
    } else {
<span class="fc" id="L129">      return Option.none();</span>
    }
  }

  /** Make a string from a collection separating each element by &lt;code&gt;sep&lt;/code&gt;. */
  public static String mkString(Collection&lt;?&gt; as, String sep) {
<span class="fc" id="L135">    final StringBuilder b = new StringBuilder();</span>
<span class="fc bfc" id="L136" title="All 2 branches covered.">    for (Object a : as)</span>
<span class="fc" id="L137">      b.append(a).append(sep);</span>
<span class="fc" id="L138">    return b.substring(0, Math.max(b.length() - sep.length(), 0));</span>
  }

  /** Append source collection &lt;code&gt;as&lt;/code&gt; to &lt;code&gt;target&lt;/code&gt;. */
  public static &lt;A, T extends Collection&lt;A&gt;, S extends Iterable&lt;? extends A&gt;&gt; T appendTo(T target, S as) {
<span class="fc bfc" id="L143" title="All 2 branches covered.">    for (A a : as)</span>
<span class="fc" id="L144">      target.add(a);</span>
<span class="fc" id="L145">    return target;</span>
  }

  /** Append source collections &lt;code&gt;as&lt;/code&gt; to &lt;code&gt;target&lt;/code&gt;. */
  @SafeVarargs
  public static &lt;A, T extends Collection&lt;A&gt;, S extends Iterable&lt;? extends A&gt;&gt; T appendToM(T target, S... as) {
<span class="nc bnc" id="L151" title="All 2 branches missed.">    for (S s : as) {</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">      for (A a : s)</span>
<span class="nc" id="L153">        target.add(a);</span>
    }
<span class="nc" id="L155">    return target;</span>
  }

  /** Append source collections &lt;code&gt;as&lt;/code&gt; to &lt;code&gt;target&lt;/code&gt;. */
  @SafeVarargs
  public static &lt;A, T extends Collection&lt;A&gt;, X extends A&gt; T appendToA(T target, X... as) {
<span class="fc" id="L161">    java.util.Collections.addAll(target, as);</span>
<span class="fc" id="L162">    return target;</span>
  }

  /** Concatenates two iterables into a new list. */
  public static &lt;A, M extends Iterable&lt;? extends A&gt;&gt; List&lt;A&gt; concat(M as, M bs) {
<span class="fc" id="L167">    List&lt;A&gt; x = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L168" title="All 2 branches covered.">    for (A a : as)</span>
<span class="fc" id="L169">      x.add(a);</span>
<span class="fc bfc" id="L170" title="All 2 branches covered.">    for (A b : bs)</span>
<span class="fc" id="L171">      x.add(b);</span>
<span class="fc" id="L172">    return x;</span>
  }

  /**
   * Merge two maps where &lt;code&gt;b&lt;/code&gt; takes precedence.
   *
   * @return a new immutable map
   */
  public static &lt;A, B&gt; Map&lt;A, B&gt; merge(Map&lt;? extends A, ? extends B&gt; a, Map&lt;? extends A, ? extends B&gt; b) {
<span class="nc" id="L181">    final Map&lt;A, B&gt; x = new HashMap&lt;&gt;();</span>
<span class="nc" id="L182">    x.putAll(a);</span>
<span class="nc" id="L183">    x.putAll(b);</span>
<span class="nc" id="L184">    return java.util.Collections.unmodifiableMap(x);</span>
  }

  /** Drain all elements of &lt;code&gt;as&lt;/code&gt; into a list. */
  public static &lt;A&gt; List&lt;A&gt; toList(Iterator&lt;? extends A&gt; as) {
<span class="fc" id="L189">    final List&lt;A&gt; t = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L190" title="All 2 branches covered.">    while (as.hasNext()) {</span>
<span class="fc" id="L191">      t.add(as.next());</span>
    }
<span class="fc" id="L193">    return t;</span>
  }

  /** Drain all elements of &lt;code&gt;as&lt;/code&gt; into a list. */
  public static &lt;A&gt; List&lt;A&gt; toList(Collection&lt;A&gt; as) {
<span class="nc" id="L198">    return new ArrayList&lt;&gt;(as);</span>
  }

  /**
   * Return the list as is or nil, if &lt;code&gt;as&lt;/code&gt; is null.
   * 
   * @deprecated use {@link #nullToNil(java.util.List)}
   */
  @Deprecated
  public static &lt;A&gt; List&lt;A&gt; mkList(List&lt;A&gt; as) {
<span class="nc bnc" id="L208" title="All 2 branches missed.">    return as != null ? as : Collections.&lt;A&gt; nil();</span>
  }

  /** Return the list as is or nil, if &lt;code&gt;as&lt;/code&gt; is null. */
  public static &lt;A&gt; List&lt;A&gt; nullToNil(List&lt;A&gt; as) {
<span class="fc bfc" id="L213" title="All 2 branches covered.">    return as != null ? as : Collections.&lt;A&gt; nil();</span>
  }

  /** Create a list from an array. */
  @SafeVarargs
  public static &lt;A&gt; List&lt;A&gt; list(A... as) {
<span class="fc" id="L219">    final List&lt;A&gt; t = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L220">    java.util.Collections.addAll(t, as);</span>
<span class="fc" id="L221">    return t;</span>
  }

  /** Create a list from an array. */
  @SafeVarargs
  public static &lt;A&gt; List&lt;A&gt; nonNullList(A... as) {
<span class="fc" id="L227">    final List&lt;A&gt; t = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L228" title="All 2 branches covered.">    for (A a : as) {</span>
<span class="pc bpc" id="L229" title="1 of 2 branches missed.">      if (null != a) {</span>
<span class="fc" id="L230">        t.add(a);</span>
      }
    }
<span class="fc" id="L233">    return t;</span>
  }

  /** The empty list. */
  @SuppressWarnings(&quot;unchecked&quot;)
  public static &lt;A&gt; List&lt;A&gt; nil() {
<span class="fc" id="L239">    return java.util.Collections.EMPTY_LIST;</span>
  }

  /** The empty list. */
  @SuppressWarnings(&quot;unchecked&quot;)
  public static &lt;A&gt; List&lt;A&gt; nil(Class&lt;A&gt; type) {
<span class="nc" id="L245">    return java.util.Collections.EMPTY_LIST;</span>
  }

  /** Construct a new list by prepending an element to a given list. */
  public static &lt;A&gt; List&lt;A&gt; cons(A a, List&lt;? extends A&gt; as) {
<span class="fc" id="L250">    final List&lt;A&gt; target = new ArrayList&lt;&gt;(as.size() + 1);</span>
<span class="fc" id="L251">    target.add(a);</span>
<span class="fc" id="L252">    target.addAll(as);</span>
<span class="fc" id="L253">    return target;</span>
  }

  /** Create a set from an array. */
  @SafeVarargs
  public static &lt;A&gt; Set&lt;A&gt; set(A... as) {
<span class="fc" id="L259">    final Set&lt;A&gt; t = new HashSet&lt;&gt;(as.length);</span>
<span class="fc" id="L260">    java.util.Collections.addAll(t, as);</span>
<span class="fc" id="L261">    return t;</span>
  }

  /** Create a set from a list. */
  public static &lt;A&gt; Set&lt;A&gt; toSet(List&lt;A&gt; as) {
<span class="nc" id="L266">    Set&lt;A&gt; r = new HashSet&lt;&gt;(as.size());</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">    for (A a : as)</span>
<span class="nc" id="L268">      r.add(a);</span>
<span class="nc" id="L269">    return r;</span>
  }

  /** Create a map from a list of tuples (K, V). */
  @SafeVarargs
  public static &lt;K, V&gt; Map&lt;K, V&gt; map(Tuple&lt;? extends K, ? extends V&gt;... ts) {
<span class="fc" id="L275">    final Map&lt;K, V&gt; map = new HashMap&lt;&gt;(ts.length);</span>
<span class="fc bfc" id="L276" title="All 2 branches covered.">    for (Tuple&lt;? extends K, ? extends V&gt; t : ts) {</span>
<span class="fc" id="L277">      map.put(t.getA(), t.getB());</span>
    }
<span class="fc" id="L279">    return map;</span>
  }

  /** Create a dictionary from a list of tuples (K, V). */
  @SafeVarargs
  public static &lt;K, V&gt; Dictionary&lt;K, V&gt; dict(Tuple&lt;? extends K, ? extends V&gt;... ts) {
<span class="nc" id="L285">    final Dictionary&lt;K, V&gt; dict = new Hashtable&lt;&gt;(ts.length);</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">    for (Tuple&lt;? extends K, ? extends V&gt; t : ts) {</span>
<span class="nc" id="L287">      dict.put(t.getA(), t.getB());</span>
    }
<span class="nc" id="L289">    return dict;</span>
  }

  /** Create an array from a collection. */
  @SuppressWarnings(&quot;unchecked&quot;)
  public static &lt;A, B extends A&gt; A[] toArray(Class&lt;A&gt; elemType, Collection&lt;B&gt; a) {
<span class="fc" id="L295">    return a.toArray((A[]) Array.newInstance(elemType, a.size()));</span>
  }

  /** Convert a collection of {@link Double}s into an array of primitive type. */
  public static double[] toDoubleArray(Collection&lt;Double&gt; as) {
<span class="nc" id="L300">    final double[] target = new double[as.size()];</span>
<span class="nc" id="L301">    int i = 0;</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">    for (Double a : as) {</span>
<span class="nc" id="L303">      target[i] = a;</span>
<span class="nc" id="L304">      i++;</span>
<span class="nc" id="L305">    }</span>
<span class="nc" id="L306">    return target;</span>
  }

  /** Create an iterator form an array. */
  @SafeVarargs
  public static &lt;A&gt; Iterator&lt;A&gt; iterator(final A... as) {
<span class="fc" id="L312">    return new Iterator&lt;A&gt;() {</span>
<span class="fc" id="L313">      private int i = 0;</span>

      @Override
      public boolean hasNext() {
<span class="fc bfc" id="L317" title="All 2 branches covered.">        return as.length &gt; i;</span>
      }

      @Override
      public A next() {
<span class="fc bfc" id="L322" title="All 2 branches covered.">        if (i &lt; as.length) {</span>
<span class="fc" id="L323">          return as[i++];</span>
        } else {
<span class="fc" id="L325">          throw new NoSuchElementException();</span>
        }
      }

      @Override
      public void remove() {
<span class="nc" id="L331">        throw new UnsupportedOperationException();</span>
      }
    };
  }

  /** Create an iterator that repeats &lt;code&gt;a&lt;/code&gt; for the said times. */
  public static &lt;A, X extends A&gt; Iterator&lt;A&gt; repeat(final X a, final int times) {
<span class="fc" id="L338">    return new Iterator&lt;A&gt;() {</span>
<span class="fc" id="L339">      private int count = times;</span>

      @Override
      public boolean hasNext() {
<span class="fc bfc" id="L343" title="All 2 branches covered.">        return count &gt; 0;</span>
      }

      @Override
      public A next() {
<span class="fc" id="L348">        count--;</span>
<span class="fc" id="L349">        return a;</span>
      }

      @Override
      public void remove() {
<span class="nc" id="L354">        throw new UnsupportedOperationException();</span>
      }
    };
  }

  /** Join two iterators. */
  public static &lt;A&gt; Iterator&lt;A&gt; join(final Iterator&lt;A&gt; a, final Iterator&lt;A&gt; b) {
<span class="fc" id="L361">    return new Iterator&lt;A&gt;() {</span>
      @Override
      public boolean hasNext() {
<span class="fc bfc" id="L364" title="All 4 branches covered.">        return a.hasNext() || b.hasNext();</span>
      }

      @Override
      public A next() {
<span class="fc bfc" id="L369" title="All 2 branches covered.">        return a.hasNext() ? a.next() : b.next();</span>
      }

      @Override
      public void remove() {
<span class="nc" id="L374">        throw new UnsupportedOperationException();</span>
      }
    };
  }

  /**
   * Make an Iterator usable in a for comprehension like this:
   *
   * &lt;pre&gt;
   *   Iterator&amp;lt;A&amp;gt; as = ...
   *   for (A a : forc(as)) {
   *     ...
   *   }
   * &lt;/pre&gt;
   */
  public static &lt;A&gt; Iterable&lt;A&gt; forc(final Iterator&lt;A&gt; as) {
<span class="fc" id="L390">    return new Iterable&lt;A&gt;() {</span>
      @Override
      public Iterator&lt;A&gt; iterator() {
<span class="fc" id="L393">        return as;</span>
      }
    };
  }

  /** Concat (aka flatten) a collection of collections by concatenating them all. [[a]] -&amp;gt; [a] */
  public static &lt;A, M extends Collection&lt;? extends Collection&lt;A&gt;&gt;&gt; List&lt;A&gt; concat(M as) {
<span class="fc" id="L400">    final List&lt;A&gt; target = new ArrayList&lt;&gt;(as.size());</span>
<span class="fc bfc" id="L401" title="All 2 branches covered.">    for (Collection&lt;A&gt; a : as) {</span>
<span class="fc" id="L402">      target.addAll(a);</span>
<span class="fc" id="L403">    }</span>
<span class="fc" id="L404">    return target;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>