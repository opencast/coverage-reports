<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>MediaPackageReferenceImpl.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">Opencast :: jacoco-reports</a> &gt; <a href="../index.html" class="el_bundle">opencast-common</a> &gt; <a href="index.source.html" class="el_package">org.opencastproject.mediapackage</a> &gt; <span class="el_source">MediaPackageReferenceImpl.java</span></div><h1>MediaPackageReferenceImpl.java</h1><pre class="source lang-java linenums">/*
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 *
 * The Apereo Foundation licenses this file to you under the Educational
 * Community License, Version 2.0 (the &quot;License&quot;); you may not use this file
 * except in compliance with the License. You may obtain a copy of the License
 * at:
 *
 *   http://opensource.org/licenses/ecl2.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 */


package org.opencastproject.mediapackage;

import java.util.HashMap;
import java.util.Map;

import javax.xml.bind.annotation.adapters.XmlAdapter;

/**
 * Default implementation for a {@link MediaPackageReference}.
 */
public class MediaPackageReferenceImpl implements MediaPackageReference {

  /** Convenience reference that matches any media package */
<span class="fc" id="L36">  public static final MediaPackageReference ANY_MEDIAPACKAGE = new MediaPackageReferenceImpl(TYPE_MEDIAPACKAGE, ANY);</span>

  /** The reference identifier */
<span class="fc" id="L39">  protected String identifier = null;</span>

  /** The reference type */
<span class="fc" id="L42">  protected String type = null;</span>

  /** External representation */
<span class="fc" id="L45">  private String externalForm = null;</span>

  /** The properties that describe this reference */
<span class="fc" id="L48">  private Map&lt;String, String&gt; properties = null;</span>

  /**
   * Creates a reference to the containing media package (&lt;code&gt;self&lt;/code&gt;).
   */
  public MediaPackageReferenceImpl() {
<span class="nc" id="L54">    this(TYPE_MEDIAPACKAGE, SELF);</span>
<span class="nc" id="L55">  }</span>

  /**
   * Creates a reference to the specified media package.
   *
   * @param mediaPackage
   *          the media package to refer to
   */
<span class="fc" id="L63">  public MediaPackageReferenceImpl(MediaPackage mediaPackage) {</span>
<span class="pc bpc" id="L64" title="1 of 2 branches missed.">    if (mediaPackage == null)</span>
<span class="nc" id="L65">      throw new IllegalArgumentException(&quot;Parameter media package must not be null&quot;);</span>
<span class="fc" id="L66">    type = TYPE_MEDIAPACKAGE;</span>
<span class="pc bpc" id="L67" title="1 of 2 branches missed.">    if (mediaPackage.getIdentifier() != null)</span>
<span class="fc" id="L68">      identifier = mediaPackage.getIdentifier().toString();</span>
    else
<span class="nc" id="L70">      identifier = SELF;</span>
<span class="fc" id="L71">    properties = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L72">  }</span>

  /**
   * Creates a reference to the specified media package element.
   * &lt;p&gt;
   * Note that the referenced element must already be part of the media package, otherwise a
   * &lt;code&gt;MediaPackageException&lt;/code&gt; will be thrown as the object holding this reference is added to the media
   * package.
   *
   * @param mediaPackageElement
   *          the media package element to refer to
   */
<span class="fc" id="L84">  public MediaPackageReferenceImpl(MediaPackageElement mediaPackageElement) {</span>
<span class="pc bpc" id="L85" title="1 of 2 branches missed.">    if (mediaPackageElement == null)</span>
<span class="nc" id="L86">      throw new IllegalArgumentException(&quot;Parameter media package element must not be null&quot;);</span>
<span class="fc" id="L87">    this.type = mediaPackageElement.getElementType().toString().toLowerCase();</span>
<span class="fc" id="L88">    this.identifier = mediaPackageElement.getIdentifier();</span>
<span class="pc bpc" id="L89" title="1 of 2 branches missed.">    if (identifier == null)</span>
<span class="nc" id="L90">      throw new IllegalArgumentException(&quot;Media package element must have an identifier&quot;);</span>
<span class="fc" id="L91">    this.properties = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L92">  }</span>

  /**
   * Creates a reference to the entity identified by &lt;code&gt;type&lt;/code&gt; and &lt;code&gt;identifier&lt;/code&gt;.
   *
   * @param type
   *          the reference type
   * @param identifier
   *          the reference identifier
   */
<span class="fc" id="L102">  public MediaPackageReferenceImpl(String type, String identifier) {</span>
<span class="pc bpc" id="L103" title="1 of 2 branches missed.">    if (type == null)</span>
<span class="nc" id="L104">      throw new IllegalArgumentException(&quot;Parameter type must not be null&quot;);</span>
<span class="pc bpc" id="L105" title="1 of 2 branches missed.">    if (identifier == null)</span>
<span class="nc" id="L106">      throw new IllegalArgumentException(&quot;Parameter identifier must not be null&quot;);</span>
<span class="fc" id="L107">    this.type = type;</span>
<span class="fc" id="L108">    this.identifier = identifier;</span>
<span class="fc" id="L109">    this.properties = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L110">  }</span>

  /**
   * Returns a media package reference from the given string.
   *
   * @return the media package reference
   * @throws IllegalArgumentException
   *           if the string is malformed
   */
  public static MediaPackageReference fromString(String reference) throws IllegalArgumentException {
<span class="pc bpc" id="L120" title="1 of 2 branches missed.">    if (reference == null)</span>
<span class="nc" id="L121">      throw new IllegalArgumentException(&quot;Reference is null&quot;);</span>

<span class="fc" id="L123">    MediaPackageReference ref = null;</span>

<span class="fc" id="L125">    String[] parts = reference.split(&quot;;&quot;);</span>
<span class="fc" id="L126">    String elementReference = parts[0];</span>

    // Check for special reference
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">    if (&quot;self&quot;.equals(elementReference))</span>
<span class="nc" id="L130">      ref = new MediaPackageReferenceImpl(MediaPackageReference.TYPE_MEDIAPACKAGE, &quot;self&quot;);</span>
    else {
<span class="fc" id="L132">      String[] elementReferenceParts = elementReference.split(&quot;:&quot;);</span>
<span class="fc bfc" id="L133" title="All 2 branches covered.">      if (elementReferenceParts.length != 2)</span>
<span class="fc" id="L134">        throw new IllegalArgumentException(&quot;Reference &quot; + reference + &quot; is malformed&quot;);</span>
<span class="fc" id="L135">      ref = new MediaPackageReferenceImpl(elementReferenceParts[0], elementReferenceParts[1]);</span>
    }

    // Process the reference properties
<span class="pc bpc" id="L139" title="1 of 2 branches missed.">    for (int i = 1; i &lt; parts.length; i++) {</span>
<span class="nc" id="L140">      String[] propertyParts = parts[i].split(&quot;=&quot;);</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">      if (propertyParts.length != 2)</span>
<span class="nc" id="L142">        throw new IllegalStateException(&quot;malformatted reference properties&quot;);</span>
<span class="nc" id="L143">      String key = propertyParts[0];</span>
<span class="nc" id="L144">      String value = propertyParts[1];</span>
<span class="nc" id="L145">      ref.setProperty(key, value);</span>
    }

<span class="fc" id="L148">    return ref;</span>
  }

  /**
   * @see org.opencastproject.mediapackage.MediaPackageReference#getIdentifier()
   */
  public String getIdentifier() {
<span class="fc" id="L155">    return identifier;</span>
  }

  /**
   * @see org.opencastproject.mediapackage.MediaPackageReference#getType()
   */
  public String getType() {
<span class="fc" id="L162">    return type;</span>
  }

  /**
   * @return the properties
   */
  public Map&lt;String, String&gt; getProperties() {
<span class="fc" id="L169">    return properties;</span>
  }

  /**
   * @param properties
   *          the properties to set
   */
  public void setProperties(Map&lt;String, String&gt; properties) {
<span class="nc" id="L177">    this.properties = properties;</span>
<span class="nc" id="L178">  }</span>

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.mediapackage.MediaPackageReference#getProperty(java.lang.String)
   */
  @Override
  public String getProperty(String key) {
<span class="nc" id="L187">    return properties.get(key);</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see org.opencastproject.mediapackage.MediaPackageReference#setProperty(java.lang.String, java.lang.String)
   */
  @Override
  public void setProperty(String key, String value) {
<span class="nc bnc" id="L197" title="All 2 branches missed.">    if (value == null)</span>
<span class="nc" id="L198">      this.properties.remove(key);</span>
<span class="nc" id="L199">    this.properties.put(key, value);</span>
<span class="nc" id="L200">  }</span>

  /**
   * @see org.opencastproject.mediapackage.MediaPackageReference#matches(org.opencastproject.mediapackage.MediaPackageReference)
   */
  public boolean matches(MediaPackageReference reference) {
<span class="fc bfc" id="L206" title="All 2 branches covered.">    if (reference == null)</span>
<span class="fc" id="L207">      return false;</span>

    // type
<span class="fc bfc" id="L210" title="All 2 branches covered.">    if (!type.equals(reference.getType()))</span>
<span class="fc" id="L211">      return false;</span>

    // properties
<span class="pc bpc" id="L214" title="2 of 4 branches missed.">    if (properties != null &amp;&amp; !properties.equals(reference.getProperties()))</span>
<span class="nc" id="L215">      return false;</span>
<span class="pc bpc" id="L216" title="2 of 4 branches missed.">    else if (reference.getProperties() != null &amp;&amp; !reference.getProperties().equals(properties))</span>
<span class="nc" id="L217">      return false;</span>

    // identifier
<span class="fc bfc" id="L220" title="All 2 branches covered.">    if (identifier.equals(reference.getIdentifier()))</span>
<span class="fc" id="L221">      return true;</span>
<span class="pc bpc" id="L222" title="1 of 4 branches missed.">    else if (ANY.equals(identifier) || ANY.equals(reference.getIdentifier()))</span>
<span class="fc" id="L223">      return true;</span>
<span class="nc bnc" id="L224" title="All 4 branches missed.">    else if (SELF.equals(identifier) || SELF.equals(reference.getIdentifier()))</span>
<span class="nc" id="L225">      return true;</span>

<span class="nc" id="L227">    return false;</span>
  }

  /**
   * {@inheritDoc}
   *
   * @see java.lang.Object#clone()
   */
  @Override
  public Object clone() {
<span class="nc" id="L237">    MediaPackageReferenceImpl clone = new MediaPackageReferenceImpl(type, identifier);</span>
<span class="nc" id="L238">    clone.getProperties().putAll(properties);</span>
<span class="nc" id="L239">    return clone;</span>
  }

  /**
   * @see java.lang.Object#hashCode()
   */
  @Override
  public int hashCode() {
<span class="nc" id="L247">    return toString().hashCode();</span>
  }

  /**
   * @see java.lang.Object#equals(java.lang.Object)
   */
  @Override
  public boolean equals(Object obj) {
<span class="pc bpc" id="L255" title="2 of 4 branches missed.">    if (obj == null || !(obj instanceof MediaPackageReference))</span>
<span class="nc" id="L256">      return false;</span>
<span class="fc" id="L257">    MediaPackageReference ref = (MediaPackageReference) obj;</span>
<span class="pc bpc" id="L258" title="2 of 4 branches missed.">    return type.equals(ref.getType()) &amp;&amp; identifier.equals(ref.getIdentifier());</span>
  }

  /**
   * @see java.lang.Object#toString()
   */
  @Override
  public String toString() {
<span class="fc bfc" id="L266" title="All 2 branches covered.">    if (externalForm == null) {</span>
<span class="fc" id="L267">      StringBuffer buf = new StringBuffer();</span>
<span class="pc bpc" id="L268" title="3 of 4 branches missed.">      if (TYPE_MEDIAPACKAGE.equals(type) &amp;&amp; SELF.equals(identifier)) {</span>
<span class="nc" id="L269">        buf.append(&quot;self&quot;);</span>
      } else {
<span class="fc" id="L271">        buf.append(type);</span>
<span class="fc" id="L272">        buf.append(&quot;:&quot;);</span>
<span class="fc" id="L273">        buf.append(identifier);</span>
      }
<span class="pc bpc" id="L275" title="1 of 2 branches missed.">      if (properties.size() &gt; 0) {</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">        for (Map.Entry&lt;String, String&gt; entry : properties.entrySet()) {</span>
<span class="nc" id="L277">          buf.append(&quot;;&quot;);</span>
<span class="nc" id="L278">          buf.append(entry.getKey());</span>
<span class="nc" id="L279">          buf.append(&quot;=&quot;);</span>
<span class="nc" id="L280">          buf.append(entry.getValue());</span>
<span class="nc" id="L281">        }</span>
      }
<span class="fc" id="L283">      externalForm = buf.toString();</span>
    }
<span class="fc" id="L285">    return externalForm;</span>
  }

<span class="fc" id="L288">  public static class Adapter extends XmlAdapter&lt;String, MediaPackageReference&gt; {</span>
    @Override
    public String marshal(MediaPackageReference ref) throws Exception {
<span class="fc bfc" id="L291" title="All 2 branches covered.">      if (ref == null)</span>
<span class="fc" id="L292">        return null;</span>
<span class="fc" id="L293">      return ref.toString();</span>
    }

    @Override
    public MediaPackageReference unmarshal(String ref) throws Exception {
<span class="pc bpc" id="L298" title="1 of 2 branches missed.">      if (ref == null)</span>
<span class="nc" id="L299">        return null;</span>
<span class="fc" id="L300">      return MediaPackageReferenceImpl.fromString(ref);</span>
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>